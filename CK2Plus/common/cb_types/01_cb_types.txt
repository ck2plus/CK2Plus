### NEW CBs 2.8
dejure_duchy_claim = { # New1
	name = CB_NAME_DEJURECLAIM
	war_name = WAR_NAME_DEJURECLAIM
	sprite = 31
	truce_days = 3650
	sort_priority = 790

	hostile_against_others = yes
	is_permanent = yes
	check_de_jure_tier = DUKE
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no

	can_use_gui = {
		check_if_crusader_trigger = yes

		# Attacker
		ROOT = {
			show_scope_change = no

			trigger_if = {
				trigger = { tier = DUKE }
				prestige >= 250
			}
			trigger_else_if = {
				limit = { tier = KING }
				prestige >= 500
			}
			trigger_else_if = {
				limit = { tier = EMPEROR }
				prestige >= 1000
			}
		}

		can_use_cb_preamble = yes
	}

	can_use = {
		has_dlc = "Jade Dragon"

		NOT = {
			has_game_rule = {
				name = jade_dragon_cbs
				value = off
			}
		}

		# Defender
		FROM = {
			NOT = { is_liege_of = ROOT }

			# Can only De Jure claim duchies from the same religion group
			religion_group = ROOT

			# Though different sects of Muslims must Holy War each other instead
			trigger_if = {
				limit = { religion_group = muslim }
				religion = ROOT
			}

			can_attack_holy_order_trigger = yes
		}
	}

	can_use_title = {
		OR = {
			holder = ROOT
			de_jure_liege_or_above = ROOT
		}

		# Use de jure county CB for single counties
		FROM = {
			num_of_realm_counties = {
				value >= 2
				title = PREV
			}
		}

		# Check to ensure the target is not valid for a holy war
		ROOT = {
			NOT = {
				can_use_cb = {
					target = FROM
					casus_belli = holy_war
					thirdparty_title = PREV
					only_check_triggers = yes
				}
			}
		}
	}

	on_add = {
		attacker = {
			show_scope_change = no

			trigger_switch = {
				on_trigger = tier

				DUKE = { prestige = -250 }
				KING = { prestige = -500 }
				EMPEROR = { prestige = -1000 }
			}
		}

		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success_title = {
		attacker = {
			show_scope_change = no

			vassalize_or_take_under_title = {
				title = PREV
				enemy = defender
				#anti_nomad = yes # Vassalize non-nomadic rulers
				type = claim
			}

			participation_scaled_prestige = 100
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }
			hidden_effect = { participation_scaled_prestige = 100 }
		}

		hidden_effect = {
			check_war_effect = yes

			defender = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no

			prestige = -100
		}

		defender = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no
			prestige = -200
			transfer_scaled_wealth = {
				to = defender
				value = 4.0
			}
		}

		defender = {
			show_scope_change = no
			participation_scaled_prestige = 100
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 0.7 # Prefer using CB's without on_add costs

		modifier = {
			factor = 0

			FROM = {
				religion = ROOT
				is_theocracy = yes
				higher_real_tier_than = COUNT
			}
		}

		trigger = {
			attacker = {
				sufficient_treasury_for_war_trigger = yes
			}

			defender = {
				NAND = {
					religion = ROOT
					is_theocracy = yes
					higher_real_tier_than = COUNT
				}
			}

			trigger_if = {
				limit = {
					attacker = {
						has_character_flag = is_temujin
						has_landed_title = e_mongol_empire
						is_landed = yes
					}
				}

				defender = {
					NOT = { has_landed_title = e_china_west_governor }
				}
			}
		}

		coronation_factor = yes
	}
}

force_vassalization = { # New2
	name = CB_NAME_FORCE_VASSALIZATION
	war_name = WAR_NAME_FORCE_VASSALIZATION
	sprite = 32
	truce_days = 365
	sort_priority = 830

	is_permanent = no # Only by decision in CK2Plus
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	defender_unoccupied_warscore = yes
	display_on_map = no

	can_use = {
		# Attacker
		ROOT = {
			has_character_flag = trying_to_vassalize_tributary
		}
	}

	is_valid = {
		# Defender
		FROM = {
			is_landed = yes
			lower_real_tier_than = ROOT
		}
	}

	on_add = {
		# Attacker
		ROOT = {
			show_scope_change = no

			if = {
				limit = {
					FROM = { real_tier = COUNT }
				}
				prestige = -250
			}
			else_if = {
				limit = {
					FROM = { real_tier = DUKE }
				}
				prestige = -1000
			}
			else_if = {
				limit = {
					FROM = { real_tier = KING }
				}
				prestige = -2500
			}
		}

		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success = {
		any_attacker = {
			limit = { NOT = { character = attacker } }
			hidden_effect = { participation_scaled_prestige = 100 }
		}

		defender = {
			show_scope_change = no

			prestige = -100
			set_defacto_liege = ROOT
		}

		hidden_effect = {
			check_if_reconquista_finished_effect = yes

			defender = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		defender = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			transfer_scaled_wealth = {
				to = defender
				value = 2.0
			}
		}

		defender = {
			show_scope_change = no

			participation_scaled_prestige = 100
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 0
	}
}

great_realm_conflict = { # New3
	name = CB_NAME_GREATREALMCONFLICT
	war_name = WAR_NAME_GREATREALMCONFLICT
	sprite = 33
	truce_days = 3650
	sort_priority = 820

	hostile_against_others = yes
	is_permanent = yes
	check_de_jure_tier = KING
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no

	can_use_gui = {
		check_if_crusader_trigger = yes

		# Attacker
		ROOT = {
			prestige >= 3000
			piety >= 1500

			# CK2Plus
			can_use_cb_preamble = yes
		}

		# Defender
		FROM = {
			relative_power = {
				who = ROOT
				power >= 0.95
			}
		}
	}

	can_use = {
		has_dlc = "Jade Dragon"

		NOT = {
			has_game_rule = {
				name = jade_dragon_cbs
				value = off
			}
		}

		# Attacker
		ROOT = {
			independent = yes
			realm_size >= 200
			higher_real_tier_than = DUKE
			is_nomadic = no
		}

		# Defender
		FROM = {
			higher_real_tier_than = DUKE
			realm_size >= 200
			is_nomadic = no
			in_revolt = no
		}
	}

	can_use_title = {
		# The attacker needs at least one county in the target kingdom, a border or be at the most two sea zones away
		any_direct_de_jure_vassal_title = { # duchies
			any_direct_de_jure_vassal_title = { # counties
				OR = {
					holder_scope = {
						OR = {
							character = ROOT
							is_vassal_or_below_of = ROOT
						}
					}

					location = {
						any_neighbor_province = {
							trigger_if = {
								limit = { has_owner = yes } # border county

								owner = {
									OR = {
										character = ROOT
										is_vassal_or_below_of = ROOT
									}
								}
							}
							trigger_else = {
								is_land = no # first sea zone

								any_neighbor_province = {
									trigger_if = {
										limit = { has_owner = yes }

										owner = {
											OR = {
												character = ROOT
												is_vassal_or_below_of = ROOT
											}
										}
									}
									trigger_else = {
										is_land = no # second sea zone

										any_neighbor_province = {
											owner = {
												OR = {
													character = ROOT
													is_vassal_or_below_of = ROOT
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid_title = {
		any_direct_de_jure_vassal_title = { # duchies
			any_direct_de_jure_vassal_title = { # counties
				owner = {
					OR = {
						character = FROM
						is_vassal_or_below_of = FROM
					}
				}
			}
		}
	}

	on_add = {
		attacker = {
			prestige = -3000
			piety = -1500
		}

		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_invalidation = {
		attacker = {
			prestige = 3000
			piety = 1500
		}
	}

	on_success_title = {
		if = { # Claim the targeted Kingdom if it is held by the target
			limit = {
				controls_religion = no

				holder_scope = {
					OR = {
						character = defender
						is_vassal_or_below_of = defender
					}
				}
			}

			usurp_title = {
				target = attacker
				type = invasion
			}
		}

		attacker = {
			show_scope_change = no

			vassalize_or_take_under_title = {
				title = PREV
				enemy = defender
				type = invasion
			}
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }
			hidden_effect = { participation_scaled_prestige = 100 }
		}

		hidden_effect = {
			check_if_reconquista_finished_effect = yes

			defender = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no
			prestige = -1500
			piety = -750
		}

		defender = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			prestige = -3000
			piety = -1500

			transfer_scaled_wealth = {
				to = defender
				value = 10.0
			}
		}

		defender = {
			show_scope_change = no
			participation_scaled_prestige = 3000
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 1500 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		trigger = {
			# This ensures that the AI doesn't declare this type of war against someone who only holds a few counties within the targeted title
			FROM = {
				num_of_realm_counties = {
					value >= 5
					title = PREV
				}

				# Ck2Plus
				sufficient_treasury_for_war_trigger = yes
			}
		}

		coronation_factor = yes
	}
}

ducal_county_conquest = { # New4
	name = CB_NAME_DUCALCOUNTYCONQUEST
	war_name = WAR_NAME_DUCALCOUNTYCONQUEST
	sprite = 34
	truce_days = 3650
	sort_priority = 720

	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no


	can_use_gui = {
		check_if_crusader_trigger = yes

		# Attacker
		ROOT = {
			show_scope_change = no

			trigger_if = {
				limit = { real_tier = COUNT }
				piety >= 100
				scaled_wealth >= 1.0
			}
			trigger_else_if = {
				limit = { real_tier = DUKE }
				piety >= 250
				scaled_wealth >= 1.0
			}

			can_use_cb_preamble = yes
		}
	}

	can_use = {
		has_dlc = "Jade Dragon"

		NOT = {
			has_game_rule = {
				name = jade_dragon_cbs
				value = off
			}
		}

		# Attacker
		ROOT = {
			# Only Counts and Dukes can use this
			lower_real_tier_than = KING

			# These all have other ways to expand in the early game
			is_nomadic = no

			NOR = {
				religion_group = muslim
				religion_group = pagan_group
			}
		}
	}

	can_use_title = {
		real_tier = COUNT

		dejure_liege_title = {
			has_holder = no

			any_de_jure_vassal_title = {
				holder = ROOT
			}
		}

		holder_scope = {
			OR = {
				character = FROM
				is_vassal_or_below_of = FROM
			}
		}
	}

	is_valid_title = {
		holder_scope = {
			OR = {
				character = FROM
				is_vassal_or_below_of = FROM
			}
		}
	}

	on_add = {
		attacker = {
			show_scope_change = no

			if = {
				limit = { tier = COUNT }
				piety = -100
				scaled_wealth = -1.0
			}
			else_if = {
				limit = { tier = DUKE }
				piety = -250
				scaled_wealth = -1.0
			}
		}

		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success_title = {
		if = { # If the attacker is a duke, and the target is a one-county ruler, vassalize them
			limit = {
				attacker = {
					real_tier = DUKE
				}

				holder_scope = {
					real_tier = COUNT
					num_of_count_titles < 2
					lower_real_tier_than = attacker
					is_patrician = no
				}
			}

			holder_scope = {
				set_defacto_liege = ROOT
			}
		}

		if = {
			limit = {
				holder_scope = {
					OR = {
						attacker = {
							real_tier = COUNT
						}

						higher_real_tier_than = COUNT
						num_of_count_titles >= 2
						is_patrician = yes
					}
				}
			}

			usurp_title_plus_barony_if_unlanded = {
				target = attacker
				type = claim
			}

			any_de_jure_vassal_title = { # take all baronies under the one we're fighting for
				limit = {
					has_holder = yes
					NOT = { de_facto_liege = PREV }

					holder_scope = {
						OR = {
							character = FROM
							is_vassal_or_below_of = FROM
						}
					}
				}

				usurp_title_plus_barony_if_unlanded = {
					target = attacker
					type = claim
				}
			}
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }
			hidden_effect = { participation_scaled_prestige = 100 }
		}

		hidden_effect = {
			check_war_effect = yes

			defender = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail_title = {
		attacker = {
			show_scope_change = no

			prestige = -100
		}

		defender = {
			show_scope_change = no

			participation_scaled_prestige = 50
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			prestige = -200

			transfer_scaled_wealth = {
				to = defender
				value = 4.0
			}
		}

		defender = {
			show_scope_change = no

			participation_scaled_prestige = 100
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		trigger = {
			ROOT = {
				scaled_wealth = 1.25
			}
		}

		coronation_factor = yes
	}
}

hostages_cb = { # New5
	name = CB_NAME_HOSTAGES
	war_name = WAR_NAME_HOSTAGES
	sprite = 25
	truce_days = 3650
	sort_priority = 100000 # When there are hostages you can usually not declare any other war, so we want this first

	is_permanent = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	defender_unoccupied_warscore = yes
	hostages_block_cb = no

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		# Attacker
		ROOT = {
			independent = yes
		}

		# Defender
		FROM = {
			any_realm_character = {
				is_landed = no

				OR = {
					is_married = ROOT
					is_friend = ROOT
					is_close_relative = ROOT
					dynasty = ROOT
					is_consort = ROOT
				}

				OR = {
					prisoner = yes

					has_opinion_modifier = {
						name = opinion_forced_consort
						who = PREV
					}
				}
			}
		}
	}

	on_add = {
		defender = {
			character_event = {
				id = JD.2000 # Chance to execute captives
				days = 5
			}
		}

		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success = {
		attacker = {
			show_scope_change = no

			prestige = 250
		}

		defender = {
			show_scope_change = no

			prestige = -250
			save_event_target_as = character_kidnapper

			transfer_scaled_wealth = {
				to = attacker
				value = 3.0
			}

			any_realm_character = {
				limit = {
					is_landed = no

					OR = {
						is_married = attacker
						is_consort = attacker
						is_friend = attacker
						is_close_relative = attacker
						dynasty = ROOT
					}

					OR = {
						prisoner = yes

						has_opinion_modifier = {
							name = opinion_forced_consort
							who = defender
						}
					}
				}

				hidden_effect = {
					# Concubines are released...
					if = {
						limit = {
							is_consort = yes

							consort = { # ...if they are taken by someone in the same realm of your target
								same_realm = event_target:character_kidnapper
							}
						}

						consort = {
							remove_consort = PREV
						}
					}

					# Marriages are annuled
					if = {
						limit = {
							is_married = yes
							any_spouse = { same_realm = event_target:character_kidnapper }
						}

						remove_spouse = yes
					}
				}

				# Release prisoners
				if = {
					limit = { prisoner = yes }
					imprison = no
				}

				# Move to the saviour's court...
				if = {
					limit = {
						# ...unless you are a concubine to a landed character...
						trigger_if = {
							limit = { is_consort = yes }

							NOT = {
								any_consort = {
									is_landed = no
								}
							}
						}

						# ...or the wife to a landed character
						trigger_else_if = {
							limit = { is_married = no }

							NOT = {
								any_spouse = {
									is_landed = yes
								}
							}

						}
					}

					move_character = attacker
				}

				opinion = {
					name = opinion_my_saviour
					who = attacker
					years = 100
				}
			}

			custom_tooltip = {
				text = hostages_random_imprisonment_tt

				random_realm_character = {
					limit = {
						NOT = { character = PREV }
						prisoner = no
						ai = yes
						is_close_relative = PREV
					}

					imprison = attacker
				}
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no

			prestige = -250
		}

		defender = {
			show_scope_change = no

			prestige = 250
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			prestige = -250

			transfer_scaled_wealth = {
				to = defender
				value = 3.0
			}
		}

		defender = {
			show_scope_change = no

			prestige = 250
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100

		mult_modifier = {
			factor = 2
			defender = { trait = proud }
		}

		mult_modifier = {
			factor = 3
			defender = { real_tier = KING }
		}

		mult_modifier = {
			factor = 0.85

			attacker = {
				relative_power = {
					who = defender
					power >= 1.2
				}
			}
		}

		mult_modifier = {
			factor = 0.85

			attacker = {
				relative_power = {
					who = defender
					power >= 1.5
				}
			}
		}

		mult_modifier = {
			factor = 0.8

			attacker = {
				relative_power = {
					who = defender
					power >= 2.0
				}
			}
		}

		mult_modifier = {
			factor = 0.8

			attacker = {
				relative_power = {
					who = defender
					power >= 2.5
				}
			}
		}

		mult_modifier = {
			factor = 0.8

			attacker = {
				relative_power = {
					who = defender
					power >= 3
				}
			}
		}

		mult_modifier = {
			factor = 0.75

			attacker = {
				relative_power = {
					who = defender
					power >= 4
				}
			}
		}

		mult_modifier = {
			factor = 0.75

			attacker = {
				relative_power = {
					who = defender
					power >= 5
				}
			}
		}

		mult_modifier = {
			factor = 0.75

			attacker = {
				relative_power = {
					who = defender
					power >= 6
				}
			}
		}

		mult_modifier = {
			factor = 0.5

			attacker = {
				relative_power = {
					who = defender
					power >= 8
				}
			}
		}

		mult_modifier = {
			factor = 0.25

			attacker = {
				relative_power = {
					who = defender
					power >= 10
				}
			}
		}

		mult_modifier = {
			factor = 2

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 20
				}
			}
		}

		mult_modifier = {
			factor = 2

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 40
				}
			}
		}

		mult_modifier = {
			factor = 3

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 80
				}
			}
		}

		mult_modifier = {
			factor = 4

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 120
				}
			}
		}
	}

	ai_will_do = {
		factor = 0 # Player Only
	}
}

liberate_religion = { # New6
	name = CB_NAME_LIBERATE_RELIGION
	war_name = WAR_NAME_LIBERATE_RELIGION
	sprite = 35
	truce_days = 3650
	sort_priority = 4000

	is_permanent = yes
	is_holy_war = yes
	check_de_jure_tier = KING
	apply_short_occ_mod = no # Do not apply the 'recently_conquered' modifier to Holdings
	allowed_to_target_tributaries = no

	can_use_gui = {
		# CK2Plus
		# Attacker
		ROOT = {
			can_use_cb_preamble = yes
		}
	}

	can_use = {
		OR = {
			has_dlc = "Holy Fury"
			has_dlc = "Jade Dragon"
		}

		# Attacker
		ROOT = {
			independent = yes

			OR = {
				any_owned_bloodline = {
					has_bloodline_flag = bloodline_religious_liberation
					bloodline_is_active_for = PREV
				}

				trigger_if = {
					limit = { has_character_flag = had_liberate_opportunity }

					NOT = {
						has_game_rule = {
							name = jade_dragon_cbs
							value = off
						}
					}
				}
			}

			is_nomadic = no
			pacifist = no
			mercenary = no

			NOR = {
				same_realm = FROM
				religion = FROM
				has_character_flag = used_liberate_opportunity
			}
		}
	}

	can_use_title = {
		any_de_jure_vassal_title = {
			real_tier = COUNT

			holder_scope = {
				OR = {
					character = FROM
					is_vassal_or_below_of = FROM
				}

				NOT = { religion = ROOT }
			}

			location = {
				religion = ROOT
			}
		}

		# The attacker needs at least one county in the target kingdom, or a border, or be only two sea zones away from one of your counties
		any_de_jure_vassal_title = {
			OR = {
				holder_scope = { # own a county
					OR = {
						character = ROOT
						is_vassal_or_below_of = ROOT
					}
				}

				location = {
					any_neighbor_province = { # have a border
						trigger_if = {
							limit = { has_owner = yes }

							owner = {
								OR = {
									character = ROOT
									is_vassal_or_below_of = ROOT
								}
							}
						}
						trigger_else = {
							is_land = no # first sea zone

							OR = {
								ROOT = { religion_group = muslim }
								FROM = { religion_group = muslim }

								trigger_if = {
									limit = { ROOT = { religion_group = pagan_group } }
									has_global_flag = pagan_ghws_unlocked
								}
								trigger_else_if = {
									limit = { ROOT = { religion_group = christian } }
									has_global_flag = christian_crusades_unlocked
								}
								trigger_else = {
									ROOT = { religion_group = muslim }
									has_global_flag = muslim_jihads_unlocked
								}

								# CK2Plus
								has_game_rule = {
									name = crusade_rules
									value = activate_immediately
								}
							}

							any_neighbor_province = {
								trigger_if = {
									limit = { has_owner = yes }

									owner = {
										OR = {
											character = ROOT
											is_vassal_or_below_of = ROOT
										}
									}
								}
								trigger_else = {
									is_land = no # second sea zone

									any_neighbor_province = {
										owner = {
											OR = {
												character = ROOT
												is_vassal_or_below_of = ROOT
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		# Attacker
		ROOT = {
			pacifist = no

			NOR = {
				same_realm = FROM
				religion = FROM
			}

			top_liege = {
				NOT = { religion = FROM }
			}
		}
	}

	is_valid_title = {
		any_direct_de_jure_vassal_title = { # duchies
			any_direct_de_jure_vassal_title = { # counties
				holder_scope = {
					OR = {
						character = FROM
						is_vassal_or_below_of = FROM
					}
				}
			}
		}
	}

	on_add = {
		attacker = {
			hidden_effect = {
				if = {
					limit = {
						NOT = {
							any_owned_bloodline = {
								has_bloodline_flag = bloodline_religious_liberation
								bloodline_is_active_for = PREV
							}
						}
					}

					set_character_flag = used_liberate_opportunity
				}
			}
		}

		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success = {
		attacker = {
			show_scope_change = no

			participation_scaled_piety = 500
			participation_scaled_prestige = 250

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = -10
			}

			religion_authority = {
				name = won_holy_war
				years = 20
			}
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }

			hidden_effect = {
				participation_scaled_piety = 100
				participation_scaled_prestige = 50

				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -10
				}

				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}
		}

		defender = {
			show_scope_change = no

			piety = -100
			prestige = -50
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = religious_liberation_cb_succ_tip

			defender = {
				random_realm_title = {
					limit = {
						real_tier = COUNT

						kingdom = { title = PREVPREVPREV }
					}

					preferred_limit = {
						location = {
							religion = ROOT
						}
					}

					location = {
						create_character = {
							religion = attacker
							culture = THIS
							dynasty = random
							random_traits = yes
							female = no
							age = 20
							health = 7
							fertility = 0.7
							flag = is_religious_liberation_ruler

							attributes = {
								martial = 10
								diplomacy = 10
								stewardship = 10
							}
						}

						new_character = {
							remove_trait = cynical
							add_trait = zealous
							wealth = 500
							prestige = 500
							piety = 500
							save_event_target_as = new_ruler

							usurp_title = {
								target = PREVPREV
								type = invasion
							}
						}
					}
				}
			}

			if = {
				limit = {
					has_holder = yes

					holder_scope = {
						OR = {
							character = defender
							is_vassal_or_below_of = defender
						}
					}
				}

				usurp_title_only = {
					target = event_target:new_ruler
					type = invasion
				}

				make_primary_title = yes
			}
			else = {
				event_target:new_ruler = {
					create_title = {
						tier = KING
						landless = no
						temporary = no
						custom_created = yes
						culture = event_target:new_ruler
						holder = event_target:new_ruler
						name = LIBERATED_KINGDOM
						base_title = PREV
					}
				}
			}

			event_target:new_ruler = {
				vassalize_or_take_under_title = {
					title = PREV
					enemy = defender
					same_religion = yes # Only vassalize rulers of my religion
					is_religious = yes
					type = holy_war
					as_if_allied_to = attacker
				}

				set_defacto_liege = THIS
			}

			attacker = {
				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}

				make_tributary = {
					who = event_target:new_ruler
					tributary_type = permanent
				}
			}
		}

		hidden_effect = {
			check_if_reconquista_finished_effect = yes

			defender = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no

			piety = -125
			prestige = -250
		}
	}

	on_invalidation = {
		attacker = {
			clr_character_flag = used_liberate_opportunity
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			transfer_scaled_wealth = {
				to = defender
				value = 4.0
			}

			piety = -250
			prestige = -500

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = 20
			}

			religion_authority = {
				name = lost_holy_war
				years = 20
			}
		}

		any_attacker = {
			limit = {
				NOT = { character = attacker }
				uses_decadence = yes
			}

			hidden_effect = {
				participation_scaled_decadence = 20
			}
		}

		defender = {
			show_scope_change = no

			participation_scaled_piety = 200
			participation_scaled_prestige = 100

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = -10
			}

			religion_authority = {
				name = won_holy_war
				years = 20
			}

			hidden_effect = {
				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = defender } }

			hidden_effect = {
				participation_scaled_piety = 200
				participation_scaled_prestige = 100

				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -10
				}

				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		trigger = {
			ROOT = {
				sufficient_treasury_for_war_trigger = yes

				trigger_if = {
					limit = { controls_religion = yes }
					is_landed = yes
				}
			}
		}

		coronation_factor = yes
	}
}

unjust_conquest = { # New7
	name = CB_NAME_UNJUST_COUNTY_CONQUEST
	war_name = WAR_NAME_UNJUST_COUNTY_CONQUEST
	sprite = 27
	truce_days = 1825
	infamy_modifier = 2
	sort_priority = 690

	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	press_claim = yes

	can_use_gui = {
		check_if_crusader_trigger = yes

		# Attacker
		ROOT = {
			show_scope_change = no

			trigger_if = { # Pagans have a much easier time using this CB in general
				limit = { religion_group = pagan_group }
				prestige >= 100
			}
			trigger_else_if = {
				limit = { real_tier = COUNT }

				trigger_if = {
					limit = { religion = FROM }

					piety >= 50

					scaled_wealth = {
						value = 1.5
						min = 75
					}
				}
				trigger_else_if = {
					limit = { religion_group = FROM }

					piety >= 25

					scaled_wealth = {
						value = 1.0
						min = 75
					}
				}
				trigger_else = {
					piety >= 15

					scaled_wealth = {
						value = 0.5
						min = 75
					}
				}
			}
			trigger_else_if = {
				limit = { real_tier = DUKE }

				trigger_if = {
					limit = { religion = FROM }

					piety >= 100

					scaled_wealth = {
						value = 1.5
						min = 100
					}
				}
				trigger_else_if = {
					limit = { religion_group = FROM }

					piety >= 50

					scaled_wealth = {
						value = 1.0
						min = 100
					}
				}
				trigger_else = {
					piety >= 25

					scaled_wealth = {
						value = 0.5
						min = 100
					}
				}
			}
			trigger_else_if = {
				limit = { real_tier = KING }

				trigger_if = {
					limit = { religion = FROM }

					piety >= 150

					scaled_wealth = {
						value = 1.5
						min = 150
					}
				}
				trigger_else_if = {
					limit = { religion_group = FROM }

					piety >= 100

					scaled_wealth = {
						value = 1.0
						min = 150
					}
				}
				trigger_else = {
					piety >= 50

					scaled_wealth = {
						value = 0.5
						min = 150
					}
				}
			}
			trigger_else_if = {
				limit = { real_tier = EMPEROR }

				trigger_if = {
					limit = { religion = FROM }

					piety >= 300

					scaled_wealth = {
						value = 1.5
						min = 200
					}
				}
				trigger_else_if = {
					limit = { religion_group = FROM }

					piety >= 200

					scaled_wealth = {
						value = 1.0
						min = 200
					}
				}
				trigger_else = {
					piety >= 100

					scaled_wealth = {
						value = 0.5
						min = 200
					}
				}
			}

			can_use_cb_preamble = yes
		}
	}

	can_use = {
		has_dlc = "Jade Dragon"

		NOT = {
			has_game_rule = {
				name = unjustified_wars
				value = off
			}
		}

		# Attacker
		ROOT = {
			pacifist = no
			is_nomadic = no # Use 'pagan_county_conquest' instead
			mercenary = no

			NOR = {
				is_vassal_or_below_of = FROM
				religion_group = muslim	# Use 'muslim_county_conquest' instead
			}

			trigger_if = { # Use 'pagan_county_conquest' instead
				limit = { religion_group = pagan_group }
				religion = FROM
			}

			# CK2Plus
			is_republic = no
			is_theocracy = no
		}

		# If below is false, use shattered CBs instead
		trigger_if = {
			limit = { is_shattered_world = yes }

			trigger_if = {
				limit = {
					has_alternate_start_setting = {
						setting = shattered_cbs
						option = on_limited
					}
				}
				total_years_played >= 25
			}
			trigger_else_if = {
				limit = {
					has_alternate_start_setting = {
						setting = shattered_cbs
						option = on_long
					}
				}
				total_years_played >= 100
			}
			trigger_else = {
				has_alternate_start_setting = {
					setting = shattered_cbs
					option = off
				}
			}
		}

		# CK2Plus
		FROM = {
			# Must not be the last province held
			num_of_count_titles_in_realm >= 2
		}
	}

	can_use_title = {
		real_tier = COUNT

		holder_scope = {
			OR = {
				character = FROM

				AND = {
					is_vassal_or_below_of = FROM
					NOT = { same_realm = ROOT }
				}
			}
		}

		location = {
			any_neighbor_province = {
				owner = {
					OR = {
						character = ROOT
						is_vassal_or_below_of = ROOT
					}
				}
			}

			# Not an exclave, which uses unjust_conquest_exclave
			# TODO: use 'is_connected_to', to check for larger exclaves?
			any_neighbor_province = {
				owner = {
					OR = {
						character = FROM
						is_vassal_or_below_of = FROM
					}
				}
			}
		}

		# CK2Plus
		ROOT = {
			# Check to ensure the target is not valid for a holy war
			NOT = {
				can_use_cb = {
					target = FROM
					casus_belli = holy_war
					thirdparty_title = PREV
					only_check_triggers = yes
				}
			}
		}

		FROM = {
			# Can't be used on the capital province of FROM
			NOT = { is_capital = PREV }
		}
	}

	is_valid_title = {
		holder_scope = {
			OR = {
				character = FROM
				is_vassal_or_below_of = FROM
			}
		}
	}

	on_add = {
		attacker = {
			show_scope_change = no

			if = { # Pagans have a much easier time using this CB in general
				limit = { religion_group = pagan_group }
				prestige = -100
			}
			else = {
				trigger_switch = {
					on_trigger = real_tier

					COUNT = {
						if = {
							limit = { religion = defender }
							piety = -50
							scaled_wealth = { value = -1.5 min = -75 }
						}
						else_if = {
							limit = { religion_group = defender }
							piety = -25
							scaled_wealth = { value = -1.0 min = -75 }
						}
						else = {
							piety = -15
							scaled_wealth = { value = -0.5 min = -75 }
						}
					}

					DUKE = {
						if = {
							limit = { religion = defender }
							piety = -100
							scaled_wealth = { value = -1.5 min = -100 }
						}
						else_if = {
							limit = { religion_group = defender }
							piety = -50
							scaled_wealth = { value = -0.0 min = -100 }
						}
						else = {
							piety = -25
							scaled_wealth = { value = -0.5 min = -100 }
						}
					}

					KING = {
						if = {
							limit = { religion = defender }
							piety = -150
							scaled_wealth = { value = -1.5 min = -150 }
						}
						else_if = {
							limit = { religion_group = defender }
							piety = -100
							scaled_wealth = { value = -1.0 min = -150 }
						}
						else = {
							piety = -50
							scaled_wealth = { value = -0.5 min = -150 }
						}
					}

					EMPEROR = {
						if = {
							limit = { religion = defender }
							piety = -300
							scaled_wealth = { value = -1.5 min = -200 }
						}
						else_if = {
							limit = { religion_group = defender }
							piety = -200
							scaled_wealth = { value = -1.0 min = -200 }
						}
						else = {
							piety = -100
							scaled_wealth = { value = -0.5 min = -200 }
						}
					}
				}
			}

			if = { # Opinion hit for same religion
				limit = { religion = defender }

				if = {
					limit = {
						controls_religion = no
						NOT = { religion_group = pagan_group }
					}

					rightful_religious_head_scope = {
						show_scope_change = no

						opinion = {
							name = opinion_declared_unjust_conquest
							who = attacker
							years = 25
						}
					}
				}

				custom_tooltip = {
					text = custom_opinion_hit_tooltip

					any_realm_lord = {
						limit = {
							religion_group = attacker
							controls_religion = no
						}

						opinion = {
							name = opinion_declared_unjust_conquest
							who = attacker
							years = 10
						}
					}

					defender = {
						any_realm_lord = {
							limit = {
								religion_group = attacker
								controls_religion = no
							}

							opinion = {
								name = opinion_declared_unjust_conquest
								who = attacker
								years = 10
							}
						}
					}
				}
			}

			else_if = { # Opinion hit for same group
				limit = { religion_group = defender }

				custom_tooltip = {
					text = custom_opinion_hit_tooltip

					any_realm_lord = {
						limit = { religion_group = attacker }

						opinion = {
							name = opinion_declared_unjust_conquest
							who = attacker
							years = 10
						}
					}

					defender = {
						any_realm_lord = {
							limit = { religion_group = attacker }

							opinion = {
								name = opinion_declared_unjust_conquest
								who = attacker
								years = 10
							}
						}
					}
				}
			}

			else = {
				custom_tooltip = {
					text = custom_opinion_hit_tooltip_enemy

					any_realm_lord = {
						limit = { religion = defender }

						opinion = {
							name = opinion_declared_unjust_conquest
							who = attacker
							years = 10
						}
					}

					defender = {
						any_realm_lord = {
							limit = { religion = attacker }

							opinion = {
								name = opinion_declared_unjust_conquest
								who = attacker
								years = 10
							}
						}
					}
				}
			}

			custom_tooltip = {
				text = EXCLAVE_CONQUEST_OPINION_NEIGHBOURS

				any_neighbor_independent_ruler = {
					limit = { NOT = { character = defender } }

					opinion = {
						name = opinion_declared_unjust_conquest
						who = attacker
						years = 10
					}

					any_realm_lord = {
						limit = {
							shares_realm_border_with = attacker
							higher_real_tier_than = BARON
						}

						opinion = {
							name = opinion_declared_unjust_conquest
							who = attacker
							years = 10
						}
					}
				}
			}
		}

		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success_title = {
		if = { # Vassalise single county counts
			limit = {
				holder_scope = {
					real_tier = COUNT
					num_of_count_titles == 1
					lower_real_tier_than = attacker
				}
			}

			holder_scope = {
				show_scope_change = no

				set_defacto_liege = attacker
			}
		}

		else = { # Usurp target title otherwise
			usurp_title_plus_barony_if_unlanded = {
				target = attacker
				type = invasion
			}

			any_de_jure_vassal_title = { # take all baronies under the one we're fighting for
				limit = {
					has_holder = yes
					NOT = { de_facto_liege = PREV }

					holder_scope = {
						OR = {
							character = defender
							is_vassal_or_below_of = defender
						}
					}
				}

				usurp_title_plus_barony_if_unlanded = {
					target = attacker
					type = invasion
				}
			}
		}

		add_pressed_claim = FROM

		attacker = {
			show_scope_change = no

			participation_scaled_prestige = 100
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }
			hidden_effect = { participation_scaled_prestige = 100 }
		}

		hidden_effect = {
			check_war_effect = yes

			defender = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail_title = {
		attacker = {
			show_scope_change = no

			prestige = -100
		}

		defender = {
			show_scope_change = no

			participation_scaled_prestige = 50
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			prestige = -200

			transfer_scaled_wealth = {
				to = defender
				value = 4.0
			}
		}

		defender = {
			show_scope_change = no

			participation_scaled_prestige = 100
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 0.7 # Prefer using CB's without on_add costs

		trigger = {
			attacker = {
				OR = {
					trait = arbitrary
					trait = ambitious
				}

				trigger_if = {
					limit = { independent = no }
					NOT = { same_liege = defender }
				}

				trigger_if = {
					limit = { higher_real_tier_than = DUKE }
					num_of_count_titles_in_realm < 10
				}

				NOR = {
					trait = just
					trait = content
				}

				trigger_if = {
					limit = {
						has_character_flag = is_temujin
						has_landed_title = e_mongol_empire
						is_landed = yes
					}

					defender = {
						NOT = { has_landed_title = e_china_west_governor }
					}
				}

				# CK2Plus
				sufficient_treasury_for_war_trigger = yes
				NOT = { has_character_modifier = ai_austerity }
			}
		}

		coronation_factor = yes
	}
}

tributary_permanent_cb = { # New8
	name = CB_NAME_PERMANENT_TRIBUTARY
	war_name = WAR_NAME_PERMANENT_TRIBUTARY
	sprite = 37
	truce_days = 365
	is_permanent = no # Disabled in CK2Plus
	hostile_against_others = yes
	can_ask_to_join_war = no
	display_on_map = no
	allowed_to_target_tributaries = no

	defender_unoccupied_warscore = yes

	sort_priority = 810

	can_use_gui = {
		check_if_crusader_trigger = yes

		# Attacker
		ROOT = {
			relative_realm_size = {
				who = FROM
				size > 1
			}

			prestige >= 200

			trigger_if = {
				limit = {
					capital_scope = {
						region = world_europe
					}
				}
				TECH_MAJESTY >= 4
			}
			trigger_else = {
				TECH_MAJESTY >= 2
			}
		}
	}

	can_use = {
		has_dlc = "Jade Dragon"

		NOT = {
			has_game_rule = {
				name = jade_dragon_cbs
				value = off
			}
		}

		# Attacker
		ROOT = {
			independent = yes
			is_nomadic = no
			mercenary = no

			NOR = {
				is_liege_or_above_of = FROM
				is_vassal_or_below_of = FROM
				rightful_religious_head = FROM
			}

			trigger_if = {
				limit = { is_tributary = yes }

				is_tributary = {
					type = offmap
				}
			}

			trigger_if = {
				limit = { holy_order = yes }
				NOT = { religion = FROM }
			}
		}

		# Defender
		FROM = {
			independent = yes
			higher_real_tier_than = BARON
			is_nomadic = no
			NOT = { is_offmap_governor = yes }

			trigger_if = {
				limit = { is_tributary = yes }

				suzerain = {
					NOR = {
						character = ROOT
						is_vassal_or_below_of = ROOT
					}
				}
			}

			trigger_if = {
				limit = { holy_order = yes }
				NOT = { religion = ROOT }
			}
		}

		# The attacker needs a border, or be at most two sea zones away from one of the target's counties
		FROM = {
			any_realm_province = {
				any_neighbor_province = {
					trigger_if = {
						limit = { has_owner = yes }

						owner = {
							OR = {
								character = ROOT
								is_vassal_or_below_of = ROOT

								top_liege = {
									is_tributary = {
										type = permanent
										suzerain = ROOT
									}
								}
							}
						}
					}
					trigger_else = {
						is_land = no # first sea sonze

						any_neighbor_province = {
							trigger_if = {
								limit = { has_owner = yes }

								owner = {
									OR = {
										character = ROOT
										is_vassal_or_below_of = ROOT
									}
								}
							}
							trigger_else = {
								is_land = no # second sea zone

								any_neighbor_province = {
									owner = {
										OR = {
											character = ROOT
											is_vassal_or_below_of = ROOT
										}
									}
								}
							}
						}
					}
				}
			}
		}

		# The defender is not in any tributary war
		FROM = {
			NOT = {
				any_war = {
					OR = {
						using_cb = tributary_cb
						using_cb = tributary_permanent_cb
						using_cb = tributary_nomad_cb
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			NOT = { rightful_religious_head = FROM }
		}
	}

	on_add = {
		## Chance to surrender early

		attacker = { save_event_target_as = tribute_war_suzerain }

		defender = {
			show_scope_change = no

			save_event_target_as = tribute_war_target
			set_character_flag = surrender_tributary_permanent_cb

			character_event = {
				id = JD.2500
				days = 5
				tooltip = surrender_tributary_tt
			}
		}

		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success = {
		attacker = {
			show_scope_change = no

			prestige = 200

			hidden_effect = {
				defender = {
					if = {
						limit = { is_tributary = yes }

						# Used for custom tooltip further down
						set_character_flag = had_suzerain

						any_suzerain = {
							event_target:target_loser = {
								remove_tributary = PREV
							}
						}
					}
				}
			}

			make_tributary = {
				who = defender
				tributary_type = permanent
			}

			if = {
				limit = { uses_decadence = yes }
				decadence = -10
			}

			hidden_effect = {
				if = {
					limit = { is_nomadic = yes }

					clan_title = {
						ROOT = {
							any_vassal = {
								limit = { is_nomadic = yes }

								clan_title = {
									clan_opinion = {
										name = won_tributary_war
										who = PREVPREVPREV
										years = 5
									}
								}
							}
						}
					}
				}
				else_if = {
					limit = { is_tribal = yes }

					any_vassal = {
						limit = { is_tribal = yes }

						opinion = {
							name = won_tributary_war
							who = PREV
							years = 5
						}
					}
				}
			}
		}

		defender = {
			show_scope_change = no

			save_event_target_as = target_loser
			prestige = -100

			if = {
				limit = { has_character_flag = had_suzerain }

				# Set up above
				clr_character_flag = had_suzerain

				custom_tooltip = {
					text = REMOVE_PREVIOUS_SUZERAIN # actually happens above
				}
			}

			opinion = {
				name = opinion_forced_tributary
				who = attacker
				years = 15
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no
			prestige = -100
		}

		defender = {
			show_scope_change = no
			prestige = 100
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			prestige = -200

			transfer_scaled_wealth = {
				to = defender
				value = 4.0
			}
		}

		defender = {
			show_scope_change = no
			prestige = 200
		}
	}

	on_attacker_leader_death = {
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 0.5 # Low prio CB

		trigger = {
			ROOT = {
				sufficient_treasury_for_war_trigger = yes
			}
		}

		coronation_factor = yes
	}
}

tributary_nomad_cb = { # New9
	name = CB_NAME_NOMAD_TRIBUTARY
	war_name = WAR_NAME_NOMAD_TRIBUTARY
	sprite = 37
	truce_days = 365
	sort_priority = 810

	is_permanent = no # Disabled in CK2Plus
	hostile_against_others = yes
	can_ask_to_join_war = no
	display_on_map = no
	allowed_to_target_tributaries = no
	defender_unoccupied_warscore = yes

	can_use_gui = {
		check_if_crusader_trigger = yes

		# Attacker
		ROOT = {
			prestige >= 100
		}
	}

	can_use = {
		# Attacker
		ROOT = {
			is_nomadic = yes
			mercenary = no

			trigger_if = {
				limit = { is_tributary = yes }

				is_tributary = {
					type = offmap
				}
			}

			NOR = {
				is_liege_or_above_of = FROM
				is_vassal_or_below_of = FROM
				rightful_religious_head = FROM
			}

			trigger_if = {
				limit = { holy_order = yes }
				NOT = { religion = FROM }
			}
		}

		# Defender
		FROM = {
			independent = yes
			higher_real_tier_than = BARON
			NOT = { is_offmap_governor = yes }

			trigger_if = {
				limit = { is_tributary = yes }

				suzerain = {
					NOR = {
						character = ROOT
						is_vassal_or_below_of = ROOT
					}
				}
			}
		}

		# The attacker needs a border, or be at most two sea zones away from one of the target's counties
		FROM = {
			any_realm_province = {
				any_neighbor_province = {
					trigger_if = {
						limit = { has_owner = yes }

						owner = {
							OR = {
								character = ROOT
								is_vassal_or_below_of = ROOT

								top_liege = {
									is_tributary = {
										type = nomadic
										suzerain = ROOT
									}
								}
							}
						}
					}
					trigger_else = {
						is_land = no # first sea zone

						any_neighbor_province = {
							trigger_if = {
								limit = { has_owner = yes }

								owner = {
									OR = {
										character = ROOT
										is_vassal_or_below_of = ROOT
									}
								}
							}
							trigger_else = {
								is_land = no # second sea zone

								any_neighbor_province = {
									owner = {
										OR = {
											character = ROOT
											is_vassal_or_below_of = ROOT
										}
									}
								}
							}
						}
					}
				}
			}
		}

		# The defender is not in any tributary war
		FROM = {
			NOT = {
				any_war = {
					OR = {
						using_cb = tributary_cb
						using_cb = tributary_permanent_cb
						using_cb = tributary_nomad_cb
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			NOT = { rightful_religious_head = FROM }
		}
	}

	on_add = {
		## Chance to surrender early

		attacker = { save_event_target_as = tribute_war_suzerain }

		defender = {
			show_scope_change = no

			save_event_target_as = tribute_war_target
			set_character_flag = surrender_tributary_nomad_cb

			character_event = {
				id = JD.2500
				days = 5
				tooltip = surrender_tributary_tt
			}
		}

		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success = {
		attacker = {
			show_scope_change = no

			prestige = 200

			make_tributary = {
				who = defender
				tributary_type = nomadic
			}

			if = {
				limit = { uses_decadence = yes }
				decadence = -10
			}

			hidden_effect = {
				if = {
					limit = { is_nomadic = yes }

					clan_title = {
						ROOT = {
							any_vassal = {
								limit = { is_nomadic = yes }

								clan_title = {
									clan_opinion = {
										name = won_tributary_war
										who = PREVPREVPREV
										years = 20
									}
								}
							}
						}
					}
				}
				else_if = {
					limit = { is_tribal = yes }

					any_vassal = {
						limit = { is_tribal = yes }

						opinion = {
							name = won_tributary_war
							who = PREV
							years = 20
						}
					}
				}
			}
		}

		defender = {
			show_scope_change = no

			transfer_scaled_wealth = {
				to = attacker
				value = 2.0
			}

			save_event_target_as = target_loser
			prestige = -100

			custom_tooltip = {
				text = REMOVE_PREVIOUS_SUZERAIN

				any_suzerain = {
					event_target:target_loser = {
						remove_tributary = PREV
					}
				}
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no
			prestige = -100
		}

		defender = {
			show_scope_change = no
			prestige = 100
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			prestige = -200

			transfer_scaled_wealth = {
				to = defender
				value = 4.0
			}
		}

		defender = {
			show_scope_change = no
			prestige = 200
		}
	}

	on_attacker_leader_death = {
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100

		mult_modifier = {
			factor = 2
			defender = { trait = proud }
		}

		mult_modifier = {
			factor = 2
			defender = { trait = brave }
		}

		mult_modifier = {
			factor = 2
			defender = { trait = greedy}
		}

		mult_modifier = {
			factor = 3
			defender = { real_tier = KING }
		}

		mult_modifier = {
			factor = 0.85

			attacker = {
				relative_power = {
					who = defender
					power >= 1.2
				}
			}
		}

		mult_modifier = {
			factor = 0.85

			attacker = {
				relative_power = {
					who = defender
					power >= 1.5
					}
			}
		}

		mult_modifier = {
			factor = 0.8

			attacker = {
				relative_power = {
					who = defender
					power >= 2.0
				}
			}
		}

		mult_modifier = {
			factor = 0.8

			attacker = {
				relative_power = {
					who = defender
					power >= 2.5
				}
			}
		}

		mult_modifier = {
			factor = 0.8

			attacker = {
				relative_power = {
					who = defender
					power >= 3
				}
			}
		}

		mult_modifier = {
			factor = 0.75

			attacker = {
				relative_power = {
					who = defender
					power >= 4
				}
			}
		}

		mult_modifier = {
			factor = 0.75

			attacker = {
				relative_power = {
					who = defender
					power >= 5
				}
			}
		}

		mult_modifier = {
			factor = 0.75

			attacker = {
				relative_power = {
					who = defender
					power >= 6
				}
			}
		}

		mult_modifier = {
			factor = 0.5

			attacker = {
				relative_power = {
					who = defender
					power >= 8
				}
			}
		}

		mult_modifier = {
			factor = 0.25

			attacker = {
				relative_power = {
					who = defender
					power >= 10
				}
			}
		}

		mult_modifier = {
			factor = 2

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 20
				}
			}
		}

		mult_modifier = {
			factor = 2

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 40
				}
			}
		}

		mult_modifier = {
			factor = 3

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 80
				}
			}
		}

		mult_modifier = {
			factor = 4

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 120
				}
			}
		}
	}

	ai_will_do = {
		factor = 1

		trigger = {
			# The Mongol Empire just wants to take land
			attacker = {
				NOT = { has_landed_title = e_mongol_empire }
			}

			ROOT = {
				sufficient_treasury_for_war_trigger = yes
			}
		}

		# In general, Nomads only want to make smaller nomads their tributaries
		mult_modifier = {
			factor = 0.1

			attacker = {
				relative_realm_size = {
					who = defender
					size < 1.1
				}
			}

			defender = {
				is_nomadic = yes
			}
		}
	}
}

### CHINA CBs 2.8
offmap_submission = {
	name = CB_NAME_OFFMAP_SUBMISSION
	war_name = WAR_NAME_OFFMAP_SUBMISSION
	sprite = 30
	truce_days = 365

	can_ask_to_join_war = yes
	allowed_to_target_tributaries = no
	allow_whitepeace = no
	defender_unoccupied_warscore = yes

	can_use = {
		# Attacker
		ROOT = {
			independent = yes
			mercenary = no

			NOR = {
				same_realm = FROM
				is_vassal_or_below_of = FROM
			}
		}

		# Defender
		FROM = {
			in_revolt = no
			is_nomadic = no # Nomads cannot be subjugated
		}
	}

	on_success = {
		defender = {
			show_scope_change = no

			piety = -100
			prestige = -100

			if = { # Remove Raid China if active
				limit = { has_character_modifier = china_raid_active }

				remove_character_modifier = china_raid_active

				add_character_modifier = {
					name = china_raid_grace_cd
					years = 5
					hidden = yes
				}
			}

			custom_tooltip = {
				text = offmap_submission_tip

				attacker = {
					if = {
						limit = {
							num_of_count_titles_in_realm >= 0

							defender = {
								num_of_count_titles_in_realm < 2
							}
						}

						defender = {
							any_realm_province = {
								county = {
									usurp_title_plus_barony_if_unlanded = {
										target = attacker
										type = invasion
									}
								}
							}
						}
					}

					while = {
						count = 20 # We had an infinite loop at one point. It's been fixed, but safety first

						limit = {
							demesne_size_compared_to_limit < 1

							defender = {
								num_of_count_titles_in_realm > 1
							}
						}

						defender = {
							if = { # Take counties that border each other
								limit = {
									any_realm_title = {
										real_tier = COUNT

										defender = {
											capital_scope = {
												NOT = { title = PREVPREV }
											}
										}

										location = {
											any_neighbor_province = {
												owned_by = attacker
											}
										}
									}
								}

								random_realm_province = {
									limit = {
										defender = {
											NOT = { is_capital = PREV }
										}

										any_neighbor_province = {
											owned_by = attacker
										}
									}

									county = {
										usurp_title_plus_barony_if_unlanded = {
											target = attacker
											type = invasion
										}
									}
								}
							}
							else = {
								random_realm_province = {
									limit = {
										defender = {
											NOT = { is_capital = PREV }
										}
									}

									county = {
										usurp_title_plus_barony_if_unlanded = {
											target = attacker
											type = invasion
										}
									}
								}
							}
						}
					}

					if = { # China with no land calculates what to do with nomad provinces
						limit = {
							is_offmap_governor = yes
							offmap_power = { is_offmap_tag = offmap_china }
							offmap_china = { has_offmap_tmp_flag = WP_is_not_on_map }
							wealth < 2500 # unless already rich from tributes
						}

						set_variable = {
							which = WP_nomad_provinces
							value = 0
						}

						any_realm_province = {
							limit = {
								has_province_modifier = nomad_agitation
								has_settlement_construction = no
							}
							province_event = { id = JD.60100 } # increase counter for each nomad province
						}

						character_event = {
							id = JD.60101 # calculate gold sent from China for building holdings
							days = 1
						}
					}

					if = { # New Empire
						limit = { has_character_flag = is_rebel_general }
						set_global_flag = rebel_general_invasion_success

						primary_title = {
							set_title_landless = {
								title = THIS
								status = no
							}

							set_title_flag = uses_temple_names_by_script # Titles with this flag give their heirs a temple name via on_death event
							set_title_flag = pretender_chinese_empire # Blocks all grace interactions
							set_title_flag = rebel_general_title
							adjective = e_china_west_governor_adj # Use WP adj as it is "Chinese" but also gives the right one in different languages

							random_list = { #R andom Empire name that China doesn't have
								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = tang_china } } }
									set_name = "Tang Empire"
									set_title_flag = china_name_Tang
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = jin_china } } }
									set_name = "Jin Empire"
									set_title_flag = china_name_Jin
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = wei_china } } }
									set_name = "Wei Empire"
									set_title_flag = china_name_Wei
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = qi_china } } }
									set_name = "Qi Empire"
									set_title_flag = china_name_Qi
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = zhou_china } } }
									set_name = "Zhou Empire"
									set_title_flag = china_name_Zhou
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = han_china } } }
									set_name = "Han Empire"
									set_title_flag = china_name_Han
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = qin_china } } }
									set_name = "Qin Empire"
									set_title_flag = china_name_Qin
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = yan_china } } }
									set_name = "Yan Empire"
									set_title_flag = china_name_Yan
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = zhao_china } } }
									set_name = "Zhao Empire"
									set_title_flag = china_name_Zhao
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = liao_china } } }
									set_name = "Liao Empire"
									set_title_flag = china_name_Liao
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = yuan_china } } }
									set_name = "Yuan Empire"
									set_title_flag = china_name_Yuan
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = xia_china } } }
									set_name = "Xia Empire"
									set_title_flag = china_name_Xia
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = qing_china } } }
									set_name = "Qing Empire"
									set_title_flag = china_name_Qing
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = dai_china } } }
									set_name = "Dai Empire"
									set_title_flag = china_name_Dai
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = cheng_china } } }
									set_name = "Cheng Empire"
									set_title_flag = china_name_Cheng
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = liang_china } } }
									set_name = "Liang Empire"
									set_title_flag = china_name_Liang
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = song_china } } }
									set_name = "Song Empire"
									set_title_flag = china_name_Song
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = ming_china } } }
									set_name = "Ming Empire"
									set_title_flag = china_name_Ming
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = shu_china } } }
									set_name = "Shu Empire"
									set_title_flag = china_name_Shu
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = wu_china } } }
									set_name = "Wu Empire"
									set_title_flag = china_name_Wu
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = chu_china } } }
									set_name = "Chu Empire"
									set_title_flag = china_name_Chu
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = yue_china } } }
									set_name = "Yue Empire"
									set_title_flag = china_name_Yue
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = yin_china } } }
									set_name = "Yin Empire"
									set_title_flag = china_name_Yin
								}

								1 = {
									trigger = { offmap_china = { NOT = { has_offmap_name = shun_china } } }
									set_name = "Shun Empire"
									set_title_flag = china_name_Shun
								}
							}

							add_law = {
								law = succ_primogeniture
								cooldown = no
								opinion_effect = no
							}
						}

						set_government_type = chinese_imperial_government

						random_list = { # Give a temple name
							1 = { set_name = Gaozu }
							1 = { set_name = Taizu }
							1 = { set_name = Shizu }
							1 = { set_name = Zhaozu }
							1 = { set_name = Jingzu }
							1 = { set_name = Xianzu }
							1 = { set_name = Liezu }
							1 = { set_name = Chengzu }
						}

						set_character_flag = given_temple_name_by_script
						remove_special_character_title = TITLE_GENERAL

						# Some starting stuff
						wealth = 1000
						prestige = 500
						piety = 200

						offmap_china = { set_offmap_flag = no_war_news }

						any_player = {
							limit = {
								has_offmap_news_enabled = offmap_china
								is_within_diplo_range = PREV
							}

							narrative_event = {
								id = JD.60211 # News Event: Inform General won and founded Empire
								days = 1
							}
						}
					}
				}

				if = {
					limit = { lower_real_tier_than = EMPEROR }

					set_defacto_liege = ROOT

					if = {
						limit = {
							attacker = { has_character_flag = is_rebel_general }
						}

						any_demesne_title = {
							limit = { real_tier = KING }

							usurp_title_plus_barony_if_unlanded = {
								target = attacker
								type = invasion
							}

							add_law = {
								law = succ_primogeniture
								cooldown = no
								opinion_effect = no
							}
						}
					}
				}
				else = {
					any_vassal = {
						set_defacto_liege = ROOT

						if = {
							limit = { attacker = { has_character_flag = is_rebel_general } }

							opinion = {
								name  = opinion_subjugated
								multiplier = 2
								who = attacker
							}
						}
					}

					any_demesne_title = {
						limit = {
							real_tier = EMPEROR
							controls_religion = no
						}

						destroy_landed_title = THIS
					}

					if = {
						limit = { lower_real_tier_than = EMPEROR }

						set_defacto_liege = ROOT
					}
					else = {
						any_demesne_title = {
							limit = { controls_religion = no }

							attacker = {
								grant_title_no_opinion = {
									target = PREV
									type = invasion
								}
							}
						}
					}
				}
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no

			piety = -100

			if = {
				limit = { has_character_flag = is_rebel_general }

				hidden_effect = {
					any_courtier = {
						move_character = defender
						imprison = defender
					}

					primary_title = {
						activate_title = {
							title = THIS
							status = no
						}

						destroy_landed_title = THIS
					}

					move_character = defender

					attacker = {
						imprison = defender
					}
				}
			}
		}

		defender = {
			show_scope_change = no

			piety = 100
			participation_scaled_prestige = 250
			set_character_flag = defeated_china
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 250 }
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			prestige = -500

			transfer_scaled_wealth = {
				to = defender
				value = 5.0
				min = 1000
			}

			hidden_effect = {
				if = {
					limit = { has_character_flag = is_rebel_general }

					any_courtier = {
						move_character = defender
						imprison = defender
					}

					primary_title = {
						activate_title = {
							title = THIS
							status = no
						}

						destroy_landed_title = THIS
					}

					move_character = defender

					attacker = {
						imprison = defender
					}
				}

				else_if = { # Makes China have a chance of leaving Expanionist policy
					limit = {
						is_offmap_tag = offmap_china

						offmap_china = {
							has_policy = china_expansionist
						}
					}

					random = {
						chance = 99 # TODO_CD_MILLS: change to 50

						offmap_china = {
							set_policy = china_open
						}

						log = "China War Logging: China was forced out of Expansionism"

						if = {
							limit = {
								offmap_china = {
									has_status = china_stable
								}
							}

							random = {
								chance = 30

								offmap_china = {
									set_status = china_unrest
								}

								log = "China War Logging: China was forced into Unrest"
							}
						}
					}
				}

				log = "China War Logging: China lost a submission war against [From.GetBestName]"
			}
		}

		defender = {
			show_scope_change = no

			set_character_flag = defeated_china
			piety = 500
			participation_scaled_prestige = 2500
			roman_victory_triumph_effect = yes
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 1000 }
		}
	}

	on_attacker_leader_death = {
		attacker = {
			if = {
				limit = { has_character_flag = is_rebel_general }

				end_war = invalid

				any_courtier = {
					death = { death_reason = death_went_back_to_china }
				}

				primary_title = {
					activate_title = {
						title = THIS
						status = no
					}

					destroy_landed_title = THIS
				}

				death = { death_reason = death_went_back_to_china }
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 0
	}
}

tributary_offmap_cb = {
	name = CB_NAME_PERMANENT_TRIBUTARY
	war_name = WAR_NAME_PERMANENT_TRIBUTARY
	sprite = 30
	truce_days = 365
	hostile_against_others = yes
	can_ask_to_join_war = no
	display_on_map = no
	allowed_to_target_tributaries = no

	defender_unoccupied_warscore = yes

	can_use = {
		# Attacker
		ROOT = {
			independent = yes
			mercenary = no

			NOR = {
				same_realm = FROM
				is_vassal_or_below_of = FROM
			}
		}

		# Defender
		FROM = {
			independent = yes
			in_revolt = no
		}
	}

	is_valid = {
		ROOT = {
			NOT = { rightful_religious_head = FROM }
		}
	}

	on_success = {
		log = "---------------------"
		log = "China Logging:"
		log = "The [offmap_china.GetShortName] invasion of [From.GetTitledName] has ended"
		log = "The war ended in a victory for China"
		log = "[From.GetTitledName] is now tributary of China"
		log = "---------------------"

		attacker = {
			show_scope_change = no

			prestige = 200

			make_tributary = {
				who = defender
				tributary_type = offmap
			}
		}

		defender = {
			show_scope_change = no

			save_event_target_as = target_loser
			prestige = -100

			custom_tooltip = {
				text = REMOVE_PREVIOUS_SUZERAIN

				any_suzerain = {
					event_target:target_loser = {
						remove_tributary = PREV
					}
				}
			}

			if = { # Remove Raid China if active
				limit = { has_character_modifier = china_raid_active }

				remove_character_modifier = china_raid_active

				add_character_modifier = {
					name = china_raid_grace_cd
					years = 5
					hidden = yes
				}
			}
		}
	}

	on_fail = {
		log = "---------------------"
		log = "China Logging:"
		log = "The [offmap_china.GetShortName] invasion of [From.GetTitledName] has ended"
		log = "The war ended in a white peace"
		log = "---------------------"

		attacker = {
			show_scope_change = no

			prestige = -200
		}

		defender = {
			show_scope_change = no

			prestige = 200
			set_character_flag = defeated_china
		}
	}

	on_reverse_demand = {
		log = "---------------------"
		log = "China Logging:"
		log = "The [offmap_china.GetShortName] invasion of [From.GetTitledName] has ended"
		log = "The war ended in a victory for [From.GetTitledName]"
		log = "---------------------"

		attacker = {
			show_scope_change = no

			prestige = -500

			transfer_scaled_wealth = {
				to = defender
				value = 5.0
				min = 1000
			}

			hidden_effect = {
				if = { #Makes China have a chance of leaving Expansionist policy...
					limit = {
						is_offmap_tag = offmap_china

						offmap_china = {
							has_policy = china_expansionist
						}
					}

					random = {
						chance = 50

						offmap_china = {
							set_policy = china_open
						}
					}
				}

				log = "China War Logging: China lost a I'll-make-you-my-tributary war against [From.GetBestName]"
			}
		}

		defender = {
			show_scope_change = no

			prestige = 500
			participation_scaled_prestige = 2500
			set_character_flag = defeated_china
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 1000 }
		}
	}

	on_attacker_leader_death = {
		#end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 0
	}
}

dismantle_pretender_china_cb = {
	name = CB_NAME_DISMANTLE_PRETENDER_CHINA
	war_name = WAR_NAME_DISMANTLE_PRETENDER_CHINA
	sprite = 30
	truce_days = 365

	hostile_against_others = yes
	can_ask_to_join_war = yes
	allowed_to_target_tributaries = no
	allow_whitepeace = no
	defender_unoccupied_warscore = yes

	can_use = {
		# Attacker
		ROOT = {
			independent = yes
			mercenary = no

			NOR = {
				same_realm = FROM
				is_vassal_or_below_of = FROM
			}
		}

		# Defender
		FROM = {
			primary_title = { has_title_flag = rebel_general_title }
		}
	}

	on_success = {
		log = "---------------------"
		log = "China Logging:"
		log = "The [offmap_china.GetShortName] dismantle pretender on [From.GetTitledName] has ended"
		log = "The war ended in a victory for China"
		log = "[From.GetTitledName] is now dismantled of China"
		log = "---------------------"

		attacker = {
			show_scope_change = no

			prestige = 200
		}

		defender = {
			custom_tooltip = {
				text = dismantle_pretender_china_success_tt

				offmap_china = { set_offmap_flag = no_war_news }

				any_player = {
					limit = {
						OR = {
							AND = {
								has_offmap_news_enabled = offmap_china
								is_within_diplo_range = attacker
							}

							vassal_of = defender
						}

						NOT = { character = defender }
					}

					narrative_event = { id = JD.60209 } # News Event: Title invaded by China destroyed
				}

				any_courtier = {
					death = { death_reason = death_executed_by_chinese_emperor }
				}

				primary_title = {
					activate_title = {
						title = THIS
						status = no
					}

					destroy_landed_title = THIS
				}

				death = { death_reason = death_executed_by_chinese_emperor }
			}
		}
	}

	on_fail = {
		log = "---------------------"
		log = "China Logging:"
		log = "The [offmap_china.GetShortName] dismantle pretender on [From.GetTitledName] has ended"
		log = "The war ended in a white peace for China"
		log = "---------------------"

		attacker = {
			show_scope_change = no

			piety = -100
		}

		defender = {
			show_scope_change = no

			piety = 100
			participation_scaled_prestige = 250
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 250 }
		}
	}

	on_reverse_demand = {
		log = "---------------------"
		log = "China Logging:"
		log = "The [offmap_china.GetShortName] dismantle pretender on [From.GetTitledName] has ended"
		log = "The war ended in a defeat for China"
		log = "---------------------"

		attacker = {
			show_scope_change = no

			piety = -200

			transfer_scaled_wealth = {
				to = defender
				value = 5.0
				min = 500
			}

			offmap_power = {
				set_offmap_tmp_flag = pretender_chinese_empire_war_cooldown
			}
		}

		defender = {
			show_scope_change = no

			piety = 200
			participation_scaled_prestige = 1000
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 1000 }
		}
	}

	on_attacker_leader_death = {
		log = "---------------------"
		log = "China Logging:"
		log = "The [offmap_china.GetShortName] dismantle pretender on [From.GetTitledName] has ended"
		log = "The war was invalidated for China"
		log = "---------------------"
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 0
	}
}

force_open_china_cb = {
	name = CB_NAME_FORCE_OPEN_CHINA
	war_name = WAR_NAME_FORCE_OPEN_CHINA
	sprite = 30
	truce_days = 365
	max_attacker_battle_score = 100

	hostile_against_others = yes
	can_ask_to_join_war = yes
	allowed_to_target_tributaries = no
	allow_whitepeace = no
	capturing_defender_is_complete_victory = no

	can_use = {
		# Attacker
		ROOT = {
			independent = yes
			mercenary = no

			NOR = {
				same_realm = FROM
				is_vassal_or_below_of = FROM
			}
		}

		# Defender
		FROM = {
			is_offmap_governor = yes
			offmap_power = { is_offmap_tag = offmap_china }
		}
	}

	is_valid = {
		offmap_china = { has_policy = china_isolationist }
	}

	on_success = {
		attacker = {
			show_scope_change = no

			participation_scaled_prestige = 1000
			add_grace_massive_effect = yes

			add_character_modifier = {
				name = chinese_favored_in_trade
				years = 25
				inherit = yes
			}
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }
			hidden_effect = { participation_scaled_prestige = 300 }
		}

		defender = {
			show_scope_change = no

			transfer_scaled_wealth = {
				to = attacker
				value = 5.0
				min = 2000
			}

			save_event_target_as = target_governor

			offmap_power = {
				set_offmap_flag = no_policy_news
				set_policy = china_open

				log = "--------------------------------"
				log = "China Policy Logging:"
				log = "Chinas new Policy is now OPEN"
				log = "-------------------------------------"

				set_offmap_tmp_flag = china_forced_open
				set_offmap_flag = no_war_news

				custom_tooltip = {
					text = china_forced_open_tt

					any_player = {
						limit = {
							has_offmap_news_enabled = PREV
							is_within_diplo_range = PREV
						}

						narrative_event = { id = JD.60302 }
					}

					clr_offmap_flag = no_policy_news
				}

				clr_offmap_tmp_flag = china_force_open_in_progress
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no

			prestige = -150
		}

		defender = {
			show_scope_change = no

			piety = 100
			participation_scaled_prestige = 50

			hidden_effect = {
				offmap_power = { clr_offmap_tmp_flag = china_force_open_in_progress }
			}
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			prestige = -300

			transfer_scaled_wealth = {
				to = defender
				value = 5.0
				min = 500
			}

			custom_tooltip = {
				text = angered_china_tt #Scripter! Update this is you change the value below.

				add_character_modifier = {
					name = angered_china_modifier
					years = 50
					inherit = yes
				}
			}
		}

		defender = {
			show_scope_change = no

			piety = 200
			participation_scaled_prestige = 100

			hidden_effect = {
				offmap_power = {
					set_offmap_flag = no_war_news

					any_player = {
						limit = {
							has_offmap_news_enabled = PREV
							is_within_diplo_range = PREV
						}

						narrative_event = { id = JD.60303 } # News Event: Fail to force open China by war
					}

					clr_offmap_tmp_flag = china_force_open_in_progress
				}
			}
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 0
	}
}

destabilization_china_cb = {
	name = CB_NAME_DESTABILIZATION_CHINA
	war_name = WAR_NAME_DESTABILIZATION_CHINA
	sprite = 30
	truce_days = 365

	hostile_against_others = yes
	can_ask_to_join_war = yes
	allowed_to_target_tributaries = no
	allow_whitepeace = no
	defender_unoccupied_warscore = yes

	can_use = {
		# Attacker
		ROOT = {
			independent = yes
			mercenary = no

			NOR = {
				same_realm = FROM
				is_vassal_or_below_of = FROM
			}
		}
	}

	on_success = {
		attacker = {
			show_scope_change = no

			prestige = 200
		}

		defender = {
			custom_tooltip = {
				text = destabilization_china_success_tt

				offmap_china = {
					set_offmap_flag = no_war_news
				}

				any_player = {
					limit = {
						OR = {
							AND = {
								has_offmap_news_enabled = offmap_china
								is_within_diplo_range = attacker
							}

							vassal_of = defender
						}

						NOT = { character = defender }
					}

					narrative_event = { id = JD.60209 } # News Event: Title invaded by China destroyed
				}

				any_demesne_title = {
					limit = {
						higher_real_tier_than = DUKE
						controls_religion = no
						clan = no
					}

					destroy_landed_title = THIS
				}
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no

			piety = -100
		}

		defender = {
			show_scope_change = no

			piety = 100
			participation_scaled_prestige = 250
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 250 }
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			piety = -200

			transfer_scaled_wealth = {
				to = defender
				value = 5.0
				min = 1000
			}
		}

		defender = {
			show_scope_change = no

			piety = 500
			participation_scaled_prestige = 2500
			set_character_flag = defeated_china
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 1000 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 0
	}
}

invasion_of_china_cb = {
	name = CB_NAME_INVASION_OF_CHINA
	war_name = WAR_NAME_INVASION_OF_CHINA
	sprite = 30
	truce_days = 365
	battle_warscore_mult = 1.5
	max_attacker_occupation_score = 50
	max_defender_occupation_score = 50
	max_attacker_battle_score = 100
	third_party_portrait = event_target:invasion_of_china_claimant

	hostile_against_others = yes
	can_ask_to_join_war = yes
	allowed_to_target_tributaries = no
	allow_whitepeace = no
	capturing_defender_is_complete_victory = no

	# attacker_unoccupied_warscore = yes - If attacker completely unoccupied, attacker will get ticking warscore. Only works if no title is targetted
	# defender_unoccupied_warscore = yes - If defender completely unoccupied, defender will get ticking warscore. Only works if no title is targetted

	can_use = {
		# Attacker
		ROOT = {
			independent = yes
			mercenary = no

			NOR = {
				same_realm = FROM
				is_vassal_or_below_of = FROM
			}
		}

		# Defender
		FROM = {
			is_offmap_governor = yes
			offmap_power = { is_offmap_tag = offmap_china }
		}
	}

	is_valid = {
		event_target:invasion_of_china_claimant = {
			is_alive = yes
		}
	}

	on_success = {
		attacker = {
			show_scope_change = no

			custom_tooltip = {
				text = invasion_of_china_success_tt

				remove_character_modifier = china_raid_active

				event_target:invasion_of_china_claimant = {
					betrothed = { break_betrothal = PREV }

					any_spouse = {
						if = {
							limit = {
								is_ruler = no
								is_primary_heir = no
							}

							leave_court_for_china_effect = yes
						}
					}

					any_child = {
						if = {
							limit = {
								is_ruler = no
								is_primary_heir = no
							}

							leave_court_for_china_effect = yes
						}
					}

				#	abdicate = yes
				#
				#	any_claim = {
				#		remove_claim = event_target:invasion_of_china_claimant
				#	}

					clr_character_flag = no_court_invites
					remove_trait = cannot_marry
					diplomatic_immunity = no
				}

				offmap_china = {
					governor = {
						any_vassal = {
							set_defacto_liege = ROOT
						}

						any_demesne_title = {
							limit = { lower_real_tier_than = EMPEROR }
							grant_title = attacker
						}
					}

					attacker = {
						if = {
							limit = { government = chinese_imperial_government }

							offmap_china = { set_offmap_flag = rename_override }

							primary_title = {
								trigger_switch = {
									on_trigger = has_title_flag

									china_name_Tang = { offmap_china = { set_offmap_name = "tang_china" } }
									china_name_Jin = { offmap_china = { set_offmap_name = "jin_china" } }
									china_name_Wei = { offmap_china = { set_offmap_name = "wei_china" } }
									china_name_Qi = { offmap_china = { set_offmap_name = "qi_china" } }
									china_name_Zhou = { offmap_china = { set_offmap_name = "zhou_china" } }
									china_name_Han = { offmap_china = { set_offmap_name = "han_china" } }
									china_name_Qin = { offmap_china = { set_offmap_name = "qin_china" } }
									china_name_Yan = { offmap_china = { set_offmap_name = "yan_china" } }
									china_name_Zhao = { offmap_china = { set_offmap_name = "zhao_china" } }
									china_name_Liao = { offmap_china = { set_offmap_name = "liao_china" } }
									china_name_Yuan = { offmap_china = { set_offmap_name = "yuan_china" } }
									china_name_Xia = { offmap_china = { set_offmap_name = "xia_china" } }
									china_name_Qing = { offmap_china = { set_offmap_name = "qing_china" } }
									china_name_Dai = { offmap_china = { set_offmap_name = "dai_china" } }
									china_name_Cheng = { offmap_china = { set_offmap_name = "cheng_china" } }
									china_name_Liang = { offmap_china = { set_offmap_name = "liang_china" } }
									china_name_Song = { offmap_china = { set_offmap_name = "song_china" } }
									china_name_Ming = { offmap_china = { set_offmap_name = "ming_china" } }
									china_name_Shu = { offmap_china = { set_offmap_name = "shu_china" } }
									china_name_Wu = { offmap_china = { set_offmap_name = "wu_china" } }
									china_name_Chu = { offmap_china = { set_offmap_name = "chu_china" } }
									china_name_Yue = { offmap_china = { set_offmap_name = "yue_china" } }
									china_name_Yin = { offmap_china = { set_offmap_name = "yin_china" } }
									china_name_Shun = { offmap_china = { set_offmap_name = "shun_china" } }
								}

								clr_title_flag = pretender_chinese_empire
								clr_title_flag = uses_temple_names_by_script
								clear_flags_with_prefix = temple_name_
								clear_flags_with_prefix = china_name_
								set_name = "[Root.Capital.GetName] Empire"
							}

							clr_character_flag = given_temple_name_by_script
							set_name = ""

							if = {
								limit = { is_government_potential = muslim_government }
								set_government_type = muslim_government
							}
							else_if = {
								limit = { is_government_potential = theocratic_feudal_government }
								set_government_type = theocratic_feudal_government
							}
							else = {
								set_government_type = feudal_government
							}
						}
					}

					set_offmap_flag = no_succession_news
					set_offmap_flag = no_war_news
					clr_offmap_flag = china_invaded_player_dynasty
					set_offmap_flag = china_invaded_player_dynasty
					set_offmap_holder = event_target:invasion_of_china_claimant
					clr_offmap_flag = no_succession_news
					clr_offmap_flag = rename_override

				#	if = {
				#		limit = {
				#			NOR = {
				#				has_status = china_stable
				#				has_status = china_golden_age
				#			}
				#		}
				#
				#		set_offmap_flag = no_status_news
				#		set_status = china_stable
				#		clr_offmap_flag = no_status_news
				#	}
				}

				any_player = {
					limit = {
						OR = {
							AND = {
								has_offmap_news_enabled = offmap_china
								is_within_diplo_range = defender
							}

							vassal_of = attacker
						}
					}

					narrative_event = { id = JD.60401 } # News Event: Character wins invasion of China
				}
			}

			participation_scaled_prestige = 5000

			set_offmap_currency = {
				offmap = offmap_china
				value = 5000
			}

			wealth = 10000

			add_character_modifier = {
				name = chinese_favored_in_trade
				years = 50
				inherit = yes
			}

			if = {
				limit = { NOT = { has_artifact = jade_dragon } }
				add_artifact = jade_dragon
			}
			if = {
				limit = { NOT = { has_artifact = chinese_dragon_amulet } }
				add_artifact = chinese_dragon_amulet
			}
			if = {
				limit = { NOT = { has_artifact = water_clock } }
				add_artifact = water_clock
			}
			if = {
				limit = { NOT = { has_artifact = jian_sword } }
				add_artifact = jian_sword
			}

			hidden_effect = {
				add_character_modifier = {
					name = peace_deal_with_china
					inherit = yes
					years = 50
				}
			}

		#	remove_character_modifier = china_raid_active
			remove_character_modifier = war_with_china_modifier
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }
			hidden_effect = { participation_scaled_prestige = 2000 }
		}

		clear_global_event_target = invasion_of_china_claimant
	}

	on_invalidation = {
		attacker = {
			show_scope_change = no

			prestige = -2500
			remove_character_modifier = war_with_china_modifier

			custom_tooltip = {
				text = invasion_of_china_cb_fail_tt

				add_character_modifier = {
					name = failed_invasion_of_china
					duration = -1
					hidden = yes
				}
			}

			hidden_effect = {
				offmap_china = { set_offmap_flag = no_war_news }

				any_player = {
					limit = {
						OR = {
							AND = {
								has_offmap_news_enabled = offmap_china
								is_within_diplo_range = defender
							}

							vassal_of = attacker
						}
					}

					narrative_event = { id = JD.60403 } # News Event: Claimant on China dies, invasion over
				}
			}

			custom_tooltip = {
				text = angered_china_tt #Scripter! Update this is you change the value below.

				add_character_modifier = {
					name = angered_china_modifier
					years = 50
					inherit = yes
				}
			}
		}

		defender = {
			show_scope_change = no

			piety = 200
			participation_scaled_prestige = 250
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 250 }
		}

		clear_global_event_target = invasion_of_china_claimant
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			prestige = -3000

			transfer_scaled_wealth = {
				to = defender
				value = 5.0
				min = 5000
			}

			remove_character_modifier = war_with_china_modifier

			custom_tooltip = {
				text = invasion_of_china_cb_fail_tt

				add_character_modifier = {
					name = failed_invasion_of_china
					duration = -1
					hidden = yes
				}
			}

			custom_tooltip = {
				text = destabilization_china_success_tt

				offmap_china = { set_offmap_flag = no_war_news }

				any_player = {
					limit = {
						OR = {
							AND = {
								has_offmap_news_enabled = offmap_china
								is_within_diplo_range = defender
							}

							vassal_of = attacker
						}
					}

					narrative_event = { id = JD.60402 } # News Event: Character loses invasion of China
				}

				any_demesne_title = {
					limit = {
						higher_real_tier_than = DUKE
						controls_religion = no
						clan = no
					}

					destroy_landed_title = THIS
				}
			}

			custom_tooltip = {
				text = angered_china_tt #Scripter! Update this is you change the value below.

				add_character_modifier = {
					name = angered_china_modifier
					years = 50
					inherit = yes
				}
			}
		}

		defender = {
			show_scope_change = no

			piety = 200
			participation_scaled_prestige = 1000
			set_character_flag = defeated_china
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 1000 }
		}

		clear_global_event_target = invasion_of_china_claimant
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 0
	}
}

truebelievers_bid_for_independence = {
	name = CB_NAME_INDEPENDENCE
	war_name = WAR_NAME_TRIBAL_INDEPENDENCE #Faction Independence
	sprite = 12
	truce_days = 3650

	major_revolt = yes
	attacker_can_call_allies = no
	can_ask_to_join_war = no
	is_independence = yes
	is_permanent = no # Disabled in CK2Plus

	can_use = {
		# Attacker
		ROOT = {
			vassal_of = FROM
		}
	}

	is_valid = {
		# Attacker
		ROOT = {
			NOT = { religion = FROM }
			liege_before_war = { character = FROM }
		}

		# Defender
		FROM = {
			independent = yes
			in_revolt = no

			any_demesne_title = {
				NOT = { lower_real_tier_than = ROOT }
				temporary = no
			}

			liege_before_war = {
				in_revolt = no

				liege_before_war = {
					in_revolt = no
				}
			}
		}
	}

	on_success = {
		defender = {
			if = {
				limit = {
					independent = no
					liege = { religion = ROOT }
				}
				if = {
					limit = { in_revolt = yes }

					liege_before_war = {
						any_attacker = {
							set_defacto_liege = PREV
						}
					}
				}
				else = {
					liege = {
						any_attacker = {
							set_defacto_liege = PREV
						}
					}
				}
			}

			else_if = {
				limit = {
					OR = {
						independent = yes
						liege = { religion = ROOT }
					}
				}

				any_attacker = {
					set_defacto_liege = ROOT
					clr_character_flag = flag_truebelievers_revolter
				}
			}
		}

		attacker = {
			show_scope_change = no

			prestige = 100
			piety = 100
			participation_scaled_prestige = 100
			participation_scaled_piety = 100

			hidden_effect = {
				clr_character_flag = flag_truebelievers_revolter

				religion_authority = {
					name = won_holy_war
					years = 20
				}

				any_demesne_title = {
					add_pressed_claim = defender
				}
			}
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }

			hidden_effect = {
				participation_scaled_prestige = 100
				participation_scaled_piety = 100
			}
		}

		defender = {
			any_demesne_title = { # All titles
				limit = {
					higher_real_tier_than = COUNT
					NOT = {	has_law = tribal_organization_0	}
				}

				trigger_switch = { # Lower tribal organization
					on_trigger = has_law

					tribal_organization_1 = { add_law = tribal_organization_0 }
					tribal_organization_2 = { add_law = tribal_organization_1 }
					tribal_organization_3 = { add_law = tribal_organization_2 }
					tribal_organization_4 = { add_law = tribal_organization_3 }
				}
			}

			hidden_effect = {
				religion_authority = {
					name = lost_holy_war
					years = 20
				}
			}
		}

		check_if_reconquista_finished_effect = yes
	}

	on_fail = {
		hidden_effect = {
			attacker = {
				prestige = 100

				any_demesne_title = {
					add_pressed_claim = defender
				}
			}

			any_attacker = {
				clr_character_flag = flag_truebelievers_revolter
			}
		}

		defender = {
			if = {
				limit = { independent = no }

				if = {
					limit = { in_revolt = yes }

					liege_before_war = {
						attacker = {
							set_defacto_liege = PREV
						}
					}
				}
				else = {
					liege = {
						attacker = {
							set_defacto_liege = PREV
						}

						any_vassal = {
							limit = { has_character_flag = independent_joining_flag }

							set_defacto_liege = PREV
							clr_character_flag = independent_joining_flag
						}
					}
				}
			}

			else = {
				attacker = {
					set_defacto_liege = FROM
				}

				any_vassal = {
					limit = { has_character_flag = independent_joining_flag }

					set_defacto_liege = PREV
					clr_character_flag = independent_joining_flag
				}
			}
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			imprison = defender

			hidden_effect = {
				religion_authority = {
					name = lost_holy_war
					years = 20
				}
			}
		}

		any_attacker = {
			hidden_effect = {
				participation_scaled_prestige = -100
				participation_scaled_piety = -100
				clr_character_flag = flag_truebelievers_revolter
			}
		}

		defender = {
			show_scope_change = no

			prestige = 100
			piety = 100

			hidden_effect = {
				religion_authority = {
					name = won_holy_war
					years = 20
				}

				if = { # Allow free revocation of a title
					limit = {
						NOT = {
							has_opinion_modifier = {
								name = opinion_traitor
								who = attacker
							}
						}
					}

					opinion = {
						name = opinion_traitor
						who = attacker
					}
				}
			}
		}
	}

	on_invalidation = {
		any_attacker = {
			clr_character_flag = flag_truebelievers_revolter
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 #always accept
	}

	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 #always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# Event-tied cb for Papal Holy War (that is, holy war on behalf of the Papacy)
pepin_religious = {
	name = CB_NAME_PAPAL_RELIGIOUS
	war_name = WAR_NAME_PAPAL_RELIGIOUS
	sprite = 9
	truce_days = 3650
	sort_priority = 790

	is_permanent = no # Disabled in CK2Plus
	is_holy_war = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	allowed_to_target_tributaries = yes
	attacker_rel_head_is_ally = yes # The attacker can call his (main) Pope into the war

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		has_dlc = "Holy Fury"

		# Attacker
		ROOT = { # The cb is either available due to Coronation dealings, or as any King or Emperor ruler who has a Pope for Religious Head

			OR = {
				religion = catholic
				religion = fraticelli
			}

			higher_real_tier_than = DUKE
			is_feudal = yes
			independent = yes
			NOT = { same_realm = FROM }

			trigger_if = {
				limit = { religion = catholic }

				rightful_religious_head_scope = {
					has_landed_title = k_papal_state
				}
			}
			trigger_else_if = {
				limit = { religion = fraticelli }

				rightful_religious_head_scope = {
					has_landed_title = d_fraticelli
				}
			}
			trigger_else = {
				has_character_flag = flag_pepin_for_coronation
			}
		}

		# Defender
		FROM = {
			is_within_diplo_range = ROOT

			NOR = {
				has_landed_title = k_papal_state
				has_landed_title = d_fraticelli
			}

			# Target must either be a pagan or heretic of any government form, or it must be a disliked Catholic/Fraticelli who is not a bishop
			OR = {
				AND = {
					is_theocracy = no
					religion = ROOT

					ROOT = {
						religion_head = {
							opinion = {
								who = FROM
								value < -50
							}
						}
					}
				}

				excommunicated_for = ROOT
				NOT = { religion_group = ROOT }
				is_heresy_of = ROOT
			}
		}
	}

	can_use_title = {
		# The attacker needs to be within diplo range of the target, and the target title must be one of the historical Papal Duchies.
		OR = {
			title = d_latium
			title = d_spoleto
			title = d_ancona
			title = d_ferrara
			title = d_benevento

			duchy = {
				OR = {
					title = d_latium
					title = d_spoleto
					title = d_ancona
					title = d_ferrara
					title = d_benevento
				}
			}
		}

		any_de_jure_vassal_title = {
			location = {
				region = world_europe_south_italy
			}
		}
	}

	is_valid = {
		# Attacker
		ROOT = {
			OR = {
				# has_character_flag = flag_pepin_for_coronation
				AND = {
					religion = catholic

					rightful_religious_head_scope = {
						has_landed_title = k_papal_state
					}
				}

				AND = {
					religion = fraticelli

					rightful_religious_head_scope = {
						has_landed_title = d_fraticelli
					}
				}
			}

			NOR = {
				religion_group = pagan_group
				same_realm = FROM
			}

			pacifist = no
		}
	}

	on_add = {
		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success = {
		# Attackers
		attacker = {
			show_scope_change = no

			participation_scaled_piety = 150
			participation_scaled_prestige = 75

			rightful_religious_head_scope = {
				opinion = {
					name = opinion_papal_land_donation
					who = attacker
				}
			}

			religion_authority = {
				name = won_holy_war
				years = 20
			}

			hidden_effect = {
				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}

			if = {
				limit = {
					religion_head = {
						any_artifact = {
							has_artifact_flag = christian

							NOR = {
								has_artifact_flag = very_rare
								has_artifact_flag = unique # Won't give the holiest ones away
							}
						}
					}
				}

				random_list = {
					20 = {
						trigger = {
							religion_head = {
								opinion = {
									who = attacker
									value >= 30
								}
							}
						}

						mult_modifier = {
							factor = 1.5

							religion_head = {
								opinion = {
									who = attacker
									value >= 50
								}
							}
						}

						mult_modifier = {
							factor = 1.5

							religion_head = {
								opinion = {
									who = attacker
									value >= 70
								}
							}
						}

						mult_modifier = {
							factor = 1.5

							religion_head = {
								opinion = {
									who = attacker
									value >= 90
								}
							}
						}

						set_character_flag = flag_pope_gifts_artifact # Effect happens in event
					}

					80 = { } # Nothing happens
				}
			}

			character_event = { id = HF.20224 } # Congratulations! Papal Coronation may proceed if flagged
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }

			hidden_effect = {
				participation_scaled_piety = 75
				participation_scaled_prestige = 50

				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -10
				}

				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}
		}

		defender = {
			show_scope_change = no

			piety = -100
			prestige = -50

			if = {
				limit = {
					NOT = { has_character_modifier = known_satanist }
				}

				religion_authority = {
					name = lost_holy_war
					years = 20
				}
			}
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = pepin_religious_cb_succ_tip

			attacker = {
				religion_head = {
					vassalize_or_take_under_title = {
						title = PREVPREV
						enemy = defender
						same_religion = yes # Only vassalize rulers of my religion
						is_religious = yes
						type = holy_war
					}
				}
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no

			piety = -50
			prestige = -100
			clr_character_flag = flag_pepin_for_coronation
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			transfer_scaled_wealth = {
				to = defender
				value = 4.0
			}

			piety = -75
			prestige = -150

			religion_authority = {
				name = lost_holy_war
				years = 20
			}

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = 20
			}

			clr_character_flag = flag_pepin_for_coronation
		}

		any_attacker = {
			limit = {
				NOT = { character = attacker }
				uses_decadence = yes
			}

			hidden_effect = {
				participation_scaled_decadence = 20
			}
		}

		defender = {
			show_scope_change = no

			participation_scaled_piety = 100
			participation_scaled_prestige = 75

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = -10
			}

			religion_authority = {
				name = won_holy_war
				years = 20
			}

			hidden_effect = {
				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = defender } }

			hidden_effect = {
				participation_scaled_piety = 75
				participation_scaled_prestige = 50

				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -10
				}

				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}
		}
	}

	on_invalidation = {
		attacker = {
			clr_character_flag = flag_pepin_for_coronation
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		trigger = {
			ROOT = {
				sufficient_treasury_for_war_trigger = yes
			}
		}

		coronation_factor = yes

		mult_modifier = {
			factor = 2
			attacker = { has_landed_title = e_hre }
		}

		mult_modifier = {
			factor = 2
			attacker = { has_landed_title = e_france }
		}

		mult_modifier = {
			factor = 0.25

			attacker = {
				NOT = { trait = zealous }
			}
		}

		# I like the Pope and I will help him
		mult_modifier = {
			factor = 1.5

			attacker = {
				religion_head = {
					reverse_opinion = {
						who = attacker
						value >= 50
					}
				}
			}
		}

		mult_modifier = {
			factor = 1.5

			attacker = {
				religion_head = {
					reverse_opinion = {
						who = attacker
						value >= 60
					}
				}
			}
		}

		mult_modifier = {
			factor = 1.5

			attacker = {
				religion_head = {
					reverse_opinion = {
						who = attacker
						value >= 70
					}
				}
			}
		}

		mult_modifier = {
			factor = 2

			attacker = {
				religion_head = {
					reverse_opinion = {
						who = attacker
						value >= 80
					}
				}
			}
		}

		mult_modifier = {
			factor = 2

			attacker = {
				religion_head = {
					reverse_opinion = {
						who = attacker
						value >= 90
					}
				}
			}
		}

		mult_modifier = { # Heathens are holding Italy, take action!
			factor = 5

			attacker = {
				NOT = { trait = cynical }
			}

			defender = {
				NOT = { religion = attacker }
			}
		}

		mult_modifier = { # The Papacy doesn't hold Rome, take action!
			factor = 5

			d_latium = {
				OR = {
					holder_scope = {
						OR = {
							character = defender
							is_vassal_or_below_of = defender
						}
					}

					any_de_jure_vassal_title = {
						holder = defender
					}
				}
			}
		}

		mult_modifier = {
			factor = 2

			d_spoleto = {
				OR = {
					holder_scope = {
						OR = {
							character = defender
							is_vassal_or_below_of = defender
						}
					}

					any_de_jure_vassal_title = {
						holder = defender
					}
				}
			}
		}

		mult_modifier = { # Historical tweaking
			factor = 0.25

			d_benevento = {
				OR = {
					holder_scope = {
						OR = {
							character = defender
							is_vassal_or_below_of = defender
						}
					}

					any_de_jure_vassal_title = {
						holder = defender
					}
				}
			}
		}

		mult_modifier = {
			factor = 0.8

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 40
				}
			}
		}

		mult_modifier = {
			factor = 0.8

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 80
				}
			}
		}

		mult_modifier = {
			factor = 0.75

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 120
				}
			}
		}

		mult_modifier = {
			factor = 0.5

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 150
				}
			}
		}

		mult_modifier = {
			factor = 0.25

			attacker = {
				distance_from_realm = {
					who = defender
					value >= 200
				}
			}
		}
	}
}

# Romans rise up after their city's churches have been destroyed by mad Emperor.
roman_christian_revolt = {
	name = CB_NAME_HERETIC_UPRISING
	war_name = WAR_NAME_HERETIC_UPRISING
	sprite = 7
	truce_days = 365
	battle_warscore_mult = 0.5

	hostile_against_others = yes
	attacker_can_call_allies = no
	defender_can_call_allies = no
	can_ask_to_join_war = no
	check_de_jure_tier = DUKE
	is_permanent = no # Disabled in CK2Plus
	allow_whitepeace = no

	can_use = {
		# Attacker
		ROOT = { has_character_flag = roman_christian_revolter }
	}

	on_add = {
		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success = {
		attacker = {
			show_scope_change = no

			prestige = 200
			piety = 100
			occupy_minors_of_occupied_settlements = defender
			clr_character_flag = religious_revolter

			gain_all_occupied_titles = {
				who = defender
				type = revolt
			}
		}

		defender = {
			show_scope_change = no

			prestige = -500
			piety = -500
			abdicate = yes

			religion_authority = {
				name = lost_religious_revolt
			}
		}
	}

	on_success_title = {
		attacker = {
			vassalize_or_take_under_title = {
				title = PREV
				enemy = defender
				same_religion = yes # Only vassalize rulers of my religion
				is_religious = yes
				type = holy_war
			}
		}

		if = {
			limit = {
				trigger_if = {
					limit = { has_holder = yes }

					controls_religion = no

					holder_scope = {
						OR = {
							character = defender
							is_vassal_or_below_of = defender
						}
					}
				}
			}

			usurp_title = {
				target = attacker
				type = holy_war
			}
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			clear_wealth = yes
			imprison = defender
			clr_character_flag = religious_revolter

			hidden_effect = {
				add_character_modifier = {
					name = broken_spirit
					days = -1
				}
			}
		}

		defender = {
			show_scope_change = no

			prestige = 100
			piety = 200

			hidden_effect = {
				opinion = {
					name = opinion_rebel_traitor
					who = attacker
					years = 100
				}

				add_character_modifier = {
					name = crushed_revolt
					years = 10
				}
			}

			religion_authority = {
				name = won_religious_revolt
			}

			if = {
				limit = { religion_openly_hellenic_or_reformed_trigger = yes }

				333 = { # If the Emperor has already revealed his conversion, convert the province immediately
					religion = defender
				}
			}
			else = {
				333 = { # If the Emperor burning Rome is about to switch to hellenism and wins the war, Rome turns hellenic automatically
					set_province_flag = flag_rome_primed_for_conversion
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 100
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 150
	}
}

abrahamic_antihellenic_revolt = {
	name = CB_ANTIHELLENIC_WAR
	war_name = WAR_NAME_ANTIHELLENIC_WAR
	sprite = 12
	truce_days = 3650

	major_revolt = yes
	allow_whitepeace = no
	attacker_can_call_allies = no
	can_ask_to_join_war = no
	is_independence = yes
	is_permanent = no # Disabled in CK2Plus

	can_use = {
		# Attacker
		ROOT = {
			vassal_of = FROM
		}
	}

	is_valid = {
		# Attacker
		ROOT = {
			liege_before_war = { character = FROM }
		}

		# Defender
		FROM = {
			independent = yes
			in_revolt = no

			any_demesne_title = {
				NOT = { lower_real_tier_than = ROOT }
				temporary = no
			}

			liege_before_war = {
				in_revolt = no

				liege_before_war = {
					in_revolt = no
				}
			}
		}
	}

	on_add = {
		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success = {
		hidden_effect = {
			attacker = {
				clr_character_flag = flag_abrahamic_revolter
				prestige = 100
				piety = 100
				participation_scaled_prestige = 100
				participation_scaled_piety = 100

				religion_authority = {
					name = won_holy_war
					years = 20
				}

				any_demesne_title = {
					add_pressed_claim = defender
				}
			}

			any_attacker = {
				limit = { NOT = { character = attacker } }

				participation_scaled_prestige = 100
				participation_scaled_piety = 100
				clr_character_flag = flag_abrahamic_revolter
			}
		}

		defender = {

			if = {
				limit = {
					current_heir = {
						religion_group = pagan_group
					}
				}

				abdicate_to = attacker
			}
			else = {
				abdicate = yes
			}

			death = { death_reason = death_execution_burning }

			hidden_effect = {
				religion_authority = {
					name = lost_holy_war
					years = 20
				}
			}
		}
	}

	on_reverse_demand = {
		any_player = {
			narrative_event = { id = HF.23117 } # The Hellenic Emperor won, ensuring the rebirth of the faith
		}

		attacker = {
			show_scope_change = no

			imprison = defender

			hidden_effect = {
				religion_authority = {
					name = lost_holy_war
					years = 20
				}
			}
		}

		any_attacker = {
			hidden_effect = {
				participation_scaled_prestige = -100
				participation_scaled_piety = -100
				clr_character_flag = flag_abrahamic_revolter
			}
		}

		defender = {
			show_scope_change = no

			prestige = 100
			piety = 100

			hidden_effect = {
				if = { # Allow free revocation of a title
					limit = {
						NOT = {
							has_opinion_modifier = {
								name = opinion_traitor
								who = attacker
							}
						}
					}

					opinion = {
						who = attacker
						name = opinion_traitor
					}
				}

				religion_authority = {
					name = won_holy_war
					years = 20
				}

				if = {
					limit = { ai = yes }

					narrative_event = { id = HF.23117 } # The Hellenic Emperor won, ensuring the rebirth of the faith
				}
			}
		}
	}

	on_invalidation = {
		any_attacker = {
			clr_character_flag = flag_abrahamic_revolter
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 #always accept
	}

	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 #always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

flower_war_cb = {
	name = CB_NAME_FLOWER_WAR
	war_name = WAR_NAME_FLOWER_WAR
	sprite = 21
	truce_days = 3650
	sort_priority = 1000

	is_permanent = no # Disabled in CK2Plus
	can_ask_to_join_war = yes
	allowed_to_target_tributaries = no

	can_use = {
		has_dlc = "Holy Fury"

		# Attacker
		ROOT = {
			trait = bloodthirsty_gods_3

			OR = {
				has_religion_feature = religion_ritual_sacrifice
				religion_openly_aztec_or_reformed_trigger = yes
			}

			mercenary = no

			NOR = {
				has_religion_feature = religion_peaceful # Aztecs could reform as Peaceful
				same_realm = FROM
				is_vassal_or_below_of = FROM
			}
		}

		# Defender
		FROM = {
			in_revolt = no
			is_nomadic = no
			NOT = { is_offmap_governor = yes }

			NOT = {
				any_war = {
					defender = { character = PREVPREV }
					using_cb = flower_war_cb
				}
			}
		}
	}

	is_valid = {
		# Attacker
		ROOT = {
			trait = bloodthirsty_gods_3

			OR = {
				has_religion_feature = religion_ritual_sacrifice
				religion_openly_aztec_or_reformed_trigger = yes
			}
		}
	}

	on_add = {
		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success = {
		# Attackers
		attacker = {
			show_scope_change = no
			participation_scaled_piety = 100
			participation_scaled_prestige = 100

			hidden_effect = {
				change_variable = {
					which = burned_hearts_points
					value = 5
				}
			}

			religion_authority = {
				name = won_flower_war
				years = 30
			}
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }
			hidden_effect = { participation_scaled_piety = 50 }
		}

		defender = {
			show_scope_change = no

			piety = -100
			prestige = -100

			if = {
				limit = {
					is_reformed_religion = attacker
					controls_religion = no
				}

				religion = attacker # Reformed pagans are forced to convert back
			}

			custom_tooltip = {
				text = flower_war_cb_tooltip

				any_courtier = { # Sacrifice part of the court
					limit = { is_ruler = no }

					random = {
						chance = 25

						mult_modifier = {
							factor = 3
							is_unimportant_trigger = yes
						}

						mult_modifier = {
							factor = 3
							has_minor_title = title_commander
						}

						mult_modifier = { # Less likely to be in battle
							factor = 0.5
							is_adult = no
						}

						mult_modifier = { # Less likely to be in battle
							factor = 0.5

							is_child_of = defender
							is_adult = no
						}

						death = {
							death_reason = death_execution_aztec_sacrifice
							killer = attacker
						}
					}
				}

				opinion = {
					name = opinion_abducted_peasants
					who = attacker
				}

				any_vassal = {
					opinion = {
						name = opinion_abducted_peasants
						who = attacker
					}
				}

				any_demesne_province = {
					add_province_modifier = {
						name = bloodthirsty_flower_war_province
						years = 10
						stacking = yes
					}

					change_variable = {
						which = prosperity_value
						value = -40
					}

					if = {
						limit = {
							check_variable = {
								which = prosperity_value
								value < 0
							}
						}

						set_variable = {
							which = prosperity_value
							value = 0
						}
					}
				}

				any_vassal = {
					limit = { higher_real_tier_than = BARON }

					any_demesne_province = {
						add_province_modifier = {
							name = bloodthirsty_flower_war_province
							years = 10
							stacking = yes
						}

						change_variable = {
							which = prosperity_value
							value = -40
						}

						if = {
							limit = {
								check_variable = {
									which = prosperity_value
									value < 0
								}
							}

							set_variable = {
								which = prosperity_value
								value = 0
							}
						}
					}
				}
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no

			piety = -100
		}

		defender = {
			show_scope_change = no

			piety = 50
			participation_scaled_prestige = 50
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			piety = -200

			transfer_scaled_wealth = {
				to = defender
				value = 2.0
			}

			religion_authority = {
				name = lost_flower_war
				years = 30
			}
		}

		defender = {
			show_scope_change = no

			piety = 100
			participation_scaled_prestige = 100
			roman_victory_triumph_effect = yes
		}

		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_effect = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		trigger = {
			ROOT = {
				sufficient_treasury_for_war_trigger = yes
			}
		}

		coronation_factor = yes
	}
}

childrens_crusade = {
	name = CB_NAME_CRUSADE
	war_name = WAR_NAME_CRUSADE
	sprite = 9
	truce_days = 3650
	battle_warscore_mult = 0.5
	max_defender_occupation_score = 85

	is_permanent = no # Disabled in CK2Plus
	is_holy_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	allow_whitepeace = no
	capturing_defender_is_complete_victory = no
	allowed_to_target_tributaries = no

	can_use_gui = {
		# Attacker
		ROOT = {
			religion = catholic
			has_character_flag = flag_childrens_crusade_leader # Only available for the child crusader
			has_global_flag = christian_crusades_unlocked
		}
	}

	can_use = {
		# Attacker
		ROOT = {
			religion = catholic
			has_character_flag = flag_childrens_crusade_leader # Only available for the child crusader
			has_global_flag = christian_crusades_unlocked
		}

		# Defender
		FROM = {
			OR = {
				NOT = { religion_group = ROOT }

				# One is a heresy of the other
				is_heresy_of = ROOT
				is_parent_religion = ROOT

				trigger_if = {
					limit = { religion_group = pagan_group }
					NOT = { religion = ROOT }
				}
			}
		}
	}

	is_valid = {
		# Attacker
		ROOT = {
			has_character_flag = flag_childrens_crusade_leader # Only available for the child crusader
		}

		# Defender
		FROM = {
			OR = {
				NOT = { religion_group = ROOT }

				# One is a heresy of the other
				is_heresy_of = ROOT
				is_parent_religion = ROOT

				AND = {
					religion_group = pagan_group
					NOT = { religion = ROOT }
				}
			}
		}
	}

	is_valid_title = {
		any_direct_de_jure_vassal_title = { # duchies
			any_direct_de_jure_vassal_title = { # counties
				holder_scope = {
					OR = {
						character = FROM
						is_vassal_or_below_of = FROM
					}
				}
			}
		}
	}

	on_invalidation = {
		attacker = {
			clr_character_flag = flag_childrens_crusade_leader
			remove_character_modifier = children_crusade_morale_0
			remove_character_modifier = children_crusade_morale_1
			remove_character_modifier = children_crusade_morale_2
			remove_character_modifier = children_crusade_morale_3
			remove_character_modifier = children_crusade_morale_4

			any_courtier = {
				limit = {
					is_ruler = no
					is_landed = no
					vassal_of = attacker
				}

				death = { death_reason = death_slavery }
			}

			primary_title = {
				activate_title = {
					title = THIS
					status = no
				}

				destroy_landed_title = THIS
			}

			death = { death_reason = death_slavery }
		}

		any_player = {
			limit = {
				religion_group = christian
				NOT = { character = attacker }
			}

			narrative_event = {
				id = HF.25823 # Notify everyone that the crusade has flopped
				days = 7
			}
		}
	}

	on_add = {
		attacker = {
			show_scope_change = no

			add_trait = crusader
			diplomatic_immunity = no
		}

		any_player = {
			limit = {
				religion_group = defender
				NOT = { character = attacker }
			}

			narrative_event = { id = HF.25824 } # Notify infidels that the children have arrived
		}

		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success_title = {
		k_jerusalem = {
			show_scope_change = no

			if = {
				limit = { has_holder = no }

				grant_title = attacker
				hidden_effect = { make_primary_title = yes }
				add_law = succ_primogeniture
				add_law = cognatic_succession
			}

			else_if = {
				limit = {
					holder_scope = {
						NOT = { religion = attacker }
					}
				}

				usurp_title_plus_barony_if_unlanded = {
					target = attacker
					type = holy_war
				}
			}
		}

		c_jerusalem = {
			show_scope_change = no

			if = {
				limit = {
					holder_scope = {
						NOT = { religion = attacker }
					}
				}
			}

			usurp_title_plus_barony_if_unlanded = {
				target = attacker
				type = holy_war
			}

			religion = attacker
		}

		attacker = {
			show_scope_change = no

			participation_scaled_prestige = 500
			participation_scaled_piety = 1000

			religion_authority = {
				name = won_crusade
				years = 20
			}

			hidden_effect = {
				clr_character_flag = flag_childrens_crusade_leader
				remove_character_modifier = children_crusade_morale_0
				remove_character_modifier = children_crusade_morale_1
				remove_character_modifier = children_crusade_morale_2
				remove_character_modifier = children_crusade_morale_3
				remove_character_modifier = children_crusade_morale_4
				remove_character_modifier = voice_of_jesus # Your work here is dones

				if = {
					limit = { is_female = no }

					create_bloodline = {
						type = crusader_kid_bloodline
					}
				}
				else = {
					create_bloodline = {
						type = crusader_kid_bloodline
						inheritance = matrilineal
					}
				}

				set_bloodline_founder_religion_flag_effect = yes

				any_player = {
					limit = {
						religion_group = christian
						NOT = { character = attacker }
					}

					narrative_event = { id = HF.25828 } # Notify everyone that the crusade has succeeded
				}

				# Vassalize and convert all infidels under the title
				vassalize_or_take_under_title = {
					title = PREV
					enemy = defender
					is_religious = yes
					type = holy_war
				}

				if = {
					limit = {
						primary_title = { is_primary_type_title = no } # Mercs, the Pope, Holy Orders, etc

						PREV = {
							OR = {
								has_holder = no

								holder_scope = {
									top_liege = { character = defender }
								}
							}
						}

						NOT = { character = attacker }

						OR = {
							independent = yes

							liege = {
								real_tier = EMPEROR
							}
						}
					}

					usurp_title_only = {
						target = PREV
						type = holy_war
					}

					if = {
						limit = {
							NOT = { culture = PREV }
						}

						save_event_target_as = winning_crusader
						PREV = { conquest_culture = event_target:winning_crusader }
					}
				}

				remove_trait = disinherited

				any_courtier = {
					remove_trait = disinherited
					clr_character_flag = no_court_invites
				}

				if = {
					limit = { is_female = no }

					remove_trait = crusader
					add_trait = crusader_king
				}

				else = {
					remove_trait = crusader
					add_trait = crusader_queen
				}

				if = {
					limit = { this_has_super_cool_nickname_trigger = no }

					random_list = {
						20 = { give_nickname = nick_the_angel_of_location }
						15 = { give_nickname = nick_the_chosen_of_gabriel }

						15 = {
							trigger = { is_female = no }
							give_nickname = nick_the_page_of_lord
						}

						15 = {
							trigger = { is_female = yes }
							give_nickname = nick_the_maid_of_virgin
						}

						15 = { give_nickname = nick_the_messenger_of_christ }
						5 = { give_nickname = nick_the_sword_of_god }
					}
				}
			}

			any_playable_ruler = {
				limit = {
					religion_group = defender
					is_within_diplo_range = defender
					NOT = { character = attacker }
				}

				narrative_event = { id = HF.25827 } # Notify all infidels that the crusade has succeeded. Offer chance of conversion/vassalization if within k_jerusalem
			}
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }

			hidden_effect = {
				participation_scaled_prestige = 500
				participation_scaled_piety = 1000

				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -100
				}
			}
		}

		any_attacker = {
			limit = {
				ai = no
				is_ironman = yes
				NOT = { has_character_flag = achievement_crusader }
			}

			set_character_flag = achievement_crusader
		}

		defender = {
			show_scope_change = no

			piety = -100

			religion_authority = {
				name = lost_crusade
				years = 20
			}
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			piety = -200

			transfer_scaled_wealth = {
				to = defender
				value = 4.0
			}

			if = {
				limit = {
					uses_decadence = yes

					NOT = {
						any_liege = {
							dynasty = PREV
						}
					}
				}

				participation_scaled_decadence = 35
			}

			religion_authority = {
				name = lost_crusade
				years = 20
			}

			any_courtier = {
				limit = {
					is_ruler = no
					is_landed = no
					vassal_of = attacker
				}

				death = { death_reason = death_slavery }
			}

			primary_title = {
				activate_title = {
					title = THIS
					status = no
				}

				destroy_landed_title = THIS
			}

			death = { death_reason = death_slavery }

			hidden_effect = {
				clr_character_flag = flag_childrens_crusade_leader
				remove_character_modifier = children_crusade_morale_0
				remove_character_modifier = children_crusade_morale_1
				remove_character_modifier = children_crusade_morale_2
				remove_character_modifier = children_crusade_morale_3
				remove_character_modifier = children_crusade_morale_4
			}
		}

		any_attacker = {
			limit = {
				uses_decadence = yes

				NOR = {
					any_liege = {
						dynasty = PREV
					}

					character = attacker
				}
			}

			hidden_effect = {
				participation_scaled_decadence = 35
			}
		}

		defender = {
			show_scope_change = no

			piety = 100
			participation_scaled_piety = 300
			participation_scaled_prestige = 150

			religion_authority = {
				name = won_crusade
				years = 20
			}

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = -100
			}

			roman_victory_triumph_effect = yes
		}

		any_defender = {
			limit = { NOT = { character = defender } }

			hidden_effect = {
				participation_scaled_piety = 300
				participation_scaled_prestige = 150

				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -100
				}
			}
		}

		any_player = {
			limit = {
				religion_group = christian
				NOT = { character = attacker }
			}

			narrative_event = { id = HF.25825 } # Notify everyone that the crusade has failed
		}

		any_player = {
			limit = {
				religion_group = defender
				NOT = { character = attacker }
			}

			narrative_event = { id = HF.25826 } # Notify every pagan that the crusade has failed
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# Warmongering + Matriarchy = Sex Deposition cb
# Matriarchal version
matriarchal_deposition_war = {
	name = CB_NAME_MATRIARCHAL_DEPOSITION
	war_name = WAR_NAME_SEX_DEPOSITION
	sprite = 35
	truce_days = 3650
	sort_priority = 4000

	is_permanent = no # Disabled in CK2Plus
	can_ask_to_join_war = yes
	is_holy_war = yes
	allowed_to_target_tributaries = no

	can_use = {
		has_dlc = "Holy Fury"

		ROOT = {
			has_religion_feature = religion_matriarchal
			has_religion_feature = religion_warlike
			higher_real_tier_than = DUKE
			shares_realm_border_with = FROM
			religion = top_liege
			is_female = yes
			is_landed = yes
			is_nomadic = no
			mercenary = no
			NOT = { same_realm = FROM }
		}

		FROM = {
			is_nomadic = no
			is_merchant_republic = no
			is_theocracy = no
			is_female = no
			independent = yes
		}
	}

	is_valid = {
		# Attacker
		ROOT = {
			has_religion_feature = religion_matriarchal
			has_religion_feature = religion_warlike
			higher_real_tier_than = DUKE
			is_female = yes
			NOT = { same_realm = FROM }
		}

		FROM = {
			independent = yes
			is_female = no
			is_nomadic = no
			is_merchant_republic = no
			is_theocracy = no
		}
	}

	on_add = {
		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	on_success = {
		attacker = {
			show_scope_change = no

			participation_scaled_piety = 100
			participation_scaled_prestige = 150

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = -10
			}

			religion_authority = {
				name = won_holy_war
				years = 20
			}
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }

			hidden_effect = {
				participation_scaled_piety = 50
				participation_scaled_prestige = 25

				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -10
				}

				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}
		}

		defender = {
			show_scope_change = no
			piety = -100
			prestige = -50

			custom_tooltip = {
				text = sex_deposition_cb_succ_tip

				# If dynasty member of proper sex exists, abdicate to it
				# Else lose main title to vassal
				# Else lose main title to spawned character

				# Then, if religious dogma allows it, switch status of Women
				# Then, if title passed on a spawned character, change succession laws
				# Finally, if owning Jade Dragon set up permanent Tributary, if Horse Lords set up temporary tributary, else set up non-aggression pact

				primary_title = { save_event_target_as = title_usurped }
				save_event_target_as = scoped_loser

				if = {
					limit = {
						any_dynasty_member = {
							is_female = yes
							is_incapable = no
							NOT = { has_religion_feature = religion_patriarchal }
						}
					}

					random_dynasty_member = {
						limit = {
							is_female = yes
							is_incapable = no
							NOT = { has_religion_feature = religion_patriarchal }
						}

						preferred_limit = {
							is_child_of = PREV
							is_adult = yes
							religion = attacker
						}

						preferred_limit = {
							is_close_relative = PREV
							is_adult = yes
							religion = attacker
						}

						preferred_limit = {
							is_adult = yes
							religion = attacker
						}

						preferred_limit = {
							is_close_relative = PREV
							is_adult = yes
						}

						preferred_limit = {
							is_adult = yes
						}

						save_event_target_as = new_swapped_ruler

						usurp_title = {
							target = event_target:title_usurped
							type = invasion
						}

						event_target:scoped_loser = {
							any_demesne_title = {
								limit = { real_tier = PREVPREV }

								event_target:new_swapped_ruler = {
									usurp_title = {
										target = PREV
										type = invasion
									}
								}

								add_pressed_claim = PREV
							}
						}

						event_target:scoped_loser = {
							set_defacto_liege = event_target:new_swapped_ruler
						}
					}
				}
				else_if = {
					limit = {
						any_vassal = {
							is_female = yes
							is_incapable = no
							NOT = { has_religion_feature = religion_patriarchal }
						}
					}

					random_vassal = {
						limit = {
							is_female = yes
							is_incapable = no
							NOT = { has_religion_feature = religion_patriarchal }
						}

						preferred_limit = {
							religion = attacker
							is_adult = yes
							practical_age < 30
							trait = zealous
						}

						preferred_limit = {
							religion = attacker
							is_adult = yes
							trait = zealous
						}

						preferred_limit = {
							religion = attacker
							is_adult = yes
						}

						preferred_limit = {
							is_adult = yes
							has_religion_feature = religion_matriarchal
						}

						preferred_limit = {
							is_adult = yes
						}

						save_event_target_as = new_swapped_ruler

						usurp_title = {
							target = event_target:title_usurped
							type = invasion
						}

						event_target:scoped_loser = {
							any_demesne_title = {
								limit = { real_tier = PREVPREV }

								event_target:new_swapped_ruler = {
									usurp_title = {
										target = PREV
										type = invasion
									}
								}

								add_pressed_claim = PREV
							}
						}

						event_target:scoped_loser = {
							set_defacto_liege = event_target:new_swapped_ruler
						}
					}
				}
				else = {
					location = {
						create_character = {
							religion = attacker
							culture = event_target:scoped_loser
							dynasty = random
							random_traits = yes
							female = yes
							age = 23
							health = 7
							fertility = 0.7

							attributes = {
								martial = 8
								diplomacy = 8
								stewardship = 8
							}
						}

						new_character = {
							remove_trait = cynical
							wealth = 250
							prestige = 300
							piety = 100
							save_event_target_as = new_swapped_ruler

							usurp_title = {
								target = event_target:title_usurped
								type = invasion
							}

							event_target:scoped_loser = {
								any_demesne_title = {
									limit = { real_tier = PREVPREV }

									event_target:new_swapped_ruler = {
										usurp_title = {
											target = PREV
											type = invasion
										}
									}

									add_pressed_claim = PREV
								}
							}

							event_target:scoped_loser = {
								set_defacto_liege = event_target:new_swapped_ruler
							}
						}
					}
				}

				# Titles assigned, now onto laws
				if = {
					limit = {
						attacker = {
							has_religion_feature = religion_matriarchal
						}

						event_target:new_swapped_ruler = {
							NOR = {
								has_religion_feature = religion_patriarchal
								has_religion_feature = religion_equal
								has_religion_feature = religion_feature_bon
							}
						}
					}

					event_target:new_swapped_ruler = {
						any_demesne_title = {
							add_law = {
								law = enatic_succession
								cooldown = no
								opinion_effect = no
							}

							add_law = {
								law = status_of_women_4
								cooldown = no
								opinion_effect = no
							}
						}

						recalc_succession = yes
					}
				}

				# Laws set, now onto pacts
				if = {
					limit = {
						has_dlc = "Jade Dragon"
						is_tributary = no
					}

					attacker = {
						make_tributary = {
							who = event_target:new_swapped_ruler
							tributary_type = permanent
						}
					}
				}
				else_if = {
					limit = {
						has_dlc = "Horse Lords"
						is_tributary = no
					}

					attacker = {
						make_tributary = {
							who = event_target:new_swapped_ruler
							percentage = 0.3
						}
					}
				}
				else = {
					attacker = {
						opinion = {
							name = in_non_aggression_pact
							years = 50
							who = event_target:new_swapped_ruler
						}
					}
				}
			}
		}

		if = {
			limit = {
				OR = {
					has_dlc = "Horse Lords"
					has_dlc = "Jade Dragon"
				}

				is_tributary = no
			}

			custom_tooltip = {
				text = sex_deposition_cb_succ_tip_2
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no

			piety = -125
			prestige = -250
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			transfer_scaled_wealth = {
				to = defender
				value = 4.0
			}

			piety = -250
			prestige = -500

			religion_authority = {
				name = lost_holy_war
				years = 20
			}

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = 20
			}
		}
		any_attacker = {
			limit = {
				NOT = { character = attacker}
				uses_decadence = yes
			}

			hidden_effect = {
				participation_scaled_decadence = 20
			}
		}

		defender = {
			show_scope_change = no

			participation_scaled_piety = 200
			participation_scaled_prestige = 100

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = -10
			}

			if = {
				limit = { NOT = { has_religion_feature = religion_matriarchal } }

				religion_authority = {
					name = won_holy_war
					years = 20
				}
			}

			hidden_effect = {
				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = defender } }

			hidden_effect = {
				participation_scaled_piety = 200
				participation_scaled_prestige = 100

				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -10
				}

				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		trigger = {
			ROOT = {
				sufficient_treasury_for_war_trigger = yes
			}
		}

		coronation_factor = yes

		mult_modifier = {
			factor = 10
			attacker = { religion = defender } # Intolerable circumstances
		}

		mult_modifier = {
			factor = 5

			attacker = { has_religion_feature = religion_patriarchal }
			defender = { has_religion_feature = religion_matriarchal }
		}

		mult_modifier = {
			factor = 5

			attacker = { has_religion_feature = religion_matriarchal }
			defender = { has_religion_feature = religion_patriarchal }
		}
	}
}

# Patriarchal version
patriarchal_deposition_war = {
	name = CB_NAME_PATRIARCHAL_DEPOSITION
	war_name = WAR_NAME_SEX_DEPOSITION
	sprite = 35
	truce_days = 3650
	sort_priority = 4000

	is_permanent = no # Disabled in CK2Plus
	can_ask_to_join_war = yes
	is_holy_war = yes
	allowed_to_target_tributaries = no

	on_add = {
		fire_haruspicy_event_effect = yes
		anger_china_effect = yes
	}

	can_use = {
		has_dlc = "Holy Fury"

		# Attacker
		ROOT = {
			has_religion_feature = religion_patriarchal
			has_religion_feature = religion_warlike
			higher_real_tier_than = DUKE
			shares_realm_border_with = FROM
			religion = top_liege
			is_female = no
			is_landed = yes
			is_nomadic = no
			mercenary = no
			NOT = { same_realm = FROM }
		}

		# Defender
		FROM = {
			independent = yes
			is_female = yes
			is_nomadic = no
			is_merchant_republic = no
			is_theocracy = no
		}
	}

	is_valid = {
		# Attacker
		ROOT = {
			has_religion_feature = religion_patriarchal
			has_religion_feature = religion_warlike
			higher_real_tier_than = DUKE
			is_female = no
			NOT = { same_realm = FROM }
		}

		# Defender
		FROM = {
			independent = yes
			is_female = yes
			is_nomadic = no
			is_merchant_republic = no
			is_theocracy = no
		}
	}

	on_success = {
		attacker = {
			show_scope_change = no

			participation_scaled_piety = 100
			participation_scaled_prestige = 150

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = -10
			}

			religion_authority = {
				name = won_holy_war
				years = 20
			}
		}

		any_attacker = {
			limit = { NOT = { character = attacker } }

			hidden_effect = {
				participation_scaled_piety = 50
				participation_scaled_prestige = 25

				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -10
				}

				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}
		}

		defender = {
			show_scope_change = no
			piety = -100
			prestige = -50

			custom_tooltip = {
				text = sex_deposition_cb_succ_tip

				# If dynasty member of proper sex exists, abdicate to it
				# Else lose main title to vassal
				# Else lose main title to spawned character

				# Then, if religious dogma allows it, switch status of Women
				# Then, if title passed on a spawned character, change succession laws
				# Finally, if owning Jade Dragon set up permanent Tributary, if Horse Lords set up temporary tributary, else set up non-aggression pact

				primary_title = { save_event_target_as = title_usurped }
				save_event_target_as = scoped_loser

				if = {
					limit = {
						any_dynasty_member = {
							is_female = no
							is_incapable = no
							NOT = { has_religion_feature = religion_matriarchal }
						}
					}

					random_dynasty_member = {
						limit = {
							is_female = no
							is_incapable = no
							NOT = { has_religion_feature = religion_matriarchal }
						}

						preferred_limit = {
							is_child_of = PREV
							is_adult = yes
							religion = attacker
						}

						preferred_limit = {
							is_close_relative = PREV
							is_adult = yes
							religion = attacker
						}

						preferred_limit = {
							is_adult = yes
							religion = attacker
						}

						preferred_limit = {
							is_close_relative = PREV
							is_adult = yes
						}

						preferred_limit = {
							is_adult = yes
						}

						save_event_target_as = new_swapped_ruler

						usurp_title = {
							target = event_target:title_usurped
							type = invasion
						}

						event_target:scoped_loser = {
							any_demesne_title = {
								limit = { real_tier = PREVPREV }

								event_target:new_swapped_ruler = {
									usurp_title = {
										target = PREV
										type = invasion
									}
								}

								add_pressed_claim = PREV
							}
						}

						event_target:scoped_loser = {
							set_defacto_liege = event_target:new_swapped_ruler
						}
					}
				}

				else_if = {
					limit = {
						any_vassal = {
							is_female = no
							is_incapable = no
							NOT = { has_religion_feature = religion_matriarchal }
						}
					}

					random_vassal = {
						limit = {
							is_female = no
							is_incapable = no
							NOT = { has_religion_feature = religion_matriarchal }
						}

						preferred_limit = {
							religion = attacker
							is_adult = yes
							practical_age < 30
							trait = zealous
						}

						preferred_limit = {
							religion = attacker
							is_adult = yes
							trait = zealous
						}

						preferred_limit = {
							religion = attacker
							is_adult = yes
						}

						preferred_limit = {
							is_adult = yes
							has_religion_feature = religion_patriarchal
						}

						preferred_limit = {
							is_adult = yes
						}

						save_event_target_as = new_swapped_ruler

						usurp_title = {
							target = event_target:title_usurped
							type = invasion
						}

						event_target:scoped_loser = {
							any_demesne_title = {
								limit = { real_tier = PREVPREV }

								event_target:new_swapped_ruler = {
									usurp_title = {
										target = PREV
										type = invasion
									}
								}

								add_pressed_claim = PREV
							}
						}

						event_target:scoped_loser = {
							set_defacto_liege = event_target:new_swapped_ruler
						}
					}
				}

				else = {
					location = {
						create_character = {
							religion = attacker
							culture = event_target:scoped_loser
							dynasty = random
							random_traits = yes
							female = no
							age = 23
							health = 7
							fertility = 0.7

							attributes = {
								martial = 8
								diplomacy = 8
								stewardship = 8
							}
						}

						new_character = {
							remove_trait = cynical
							wealth = 250
							prestige = 300
							piety = 100
							save_event_target_as = new_swapped_ruler

							usurp_title = {
								target = event_target:title_usurped
								type = invasion
							}

							event_target:scoped_loser = {
								any_demesne_title = {
									limit = { real_tier = PREVPREV }

									event_target:new_swapped_ruler = {
										usurp_title = {
											target = PREV
											type = invasion
										}
									}

									add_pressed_claim = PREV
								}
							}

							event_target:scoped_loser = {
								set_defacto_liege = event_target:new_swapped_ruler
							}
						}
					}
				}

				# Titles assigned, now onto laws
				if = {
					limit = {
						attacker = {
							has_religion_feature = religion_patriarchal
						}

						event_target:new_swapped_ruler = {
							NOR = {
								has_religion_feature = religion_matriarchal
								has_religion_feature = religion_equal
								has_religion_feature = religion_feature_bon
							}
						}
					}

					event_target:new_swapped_ruler = {
						any_demesne_title = {
							add_law = {
								law = agnatic_succession
								cooldown = no
								opinion_effect = no
							}

							add_law = {
								law = status_of_women_0
								cooldown = no
								opinion_effect = no
							}
						}

						recalc_succession = yes
					}
				}

				# Laws set, now onto pacts
				if = {
					limit = {
						has_dlc = "Jade Dragon"
						is_tributary = no
					}

					attacker = {
						make_tributary = {
							who = event_target:new_swapped_ruler
							tributary_type = permanent
						}
					}
				}
				else_if = {
					limit = {
						has_dlc = "Horse Lords"
						is_tributary = no
					}

					attacker = {
						make_tributary = {
							who = event_target:new_swapped_ruler
							percentage = 0.3
						}
					}
				}
				else = {
					attacker = {
						opinion = {
							name = in_non_aggression_pact
							years = 50
							who = event_target:new_swapped_ruler
						}
					}
				}
			}
		}

		if = {
			limit = {
				OR = {
					has_dlc = "Horse Lords"
					has_dlc = "Jade Dragon"
				}

				is_tributary = no
			}

			custom_tooltip = {
				text = sex_deposition_cb_succ_tip_2
			}
		}
	}

	on_fail = {
		attacker = {
			show_scope_change = no

			piety = -125
			prestige = -250
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no

			transfer_scaled_wealth = {
				to = defender
				value = 4.0
			}

			piety = -250
			prestige = -500

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = 20
			}

			religion_authority = {
				name = lost_holy_war
				years = 20
			}
		}

		any_attacker = {
			limit = {
				uses_decadence = yes
				NOT = { character = attacker }
			}

			hidden_effect = {
				participation_scaled_decadence = 20
			}
		}

		defender = {
			show_scope_change = no

			participation_scaled_piety = 200
			participation_scaled_prestige = 100

			if = {
				limit = { uses_decadence = yes }
				participation_scaled_decadence = -10
			}
		}
		any_defender = {
			limit = { NOT = { character = defender } }

			hidden_effect = {
				participation_scaled_piety = 200
				participation_scaled_prestige = 100

				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -10
				}

				if = {
					limit = { has_ambition = obj_strengthen_religion }

					change_variable = {
						which = strengthen_religion
						value = 1
					}
				}
			}

			if = {
				limit = { NOT = { has_religion_feature = religion_patriarchal } }

				religion_authority = {
					name = won_holy_war
					years = 20
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		trigger = {
			ROOT = {
				sufficient_treasury_for_war_trigger = yes
			}
		}

		coronation_factor = yes

		mult_modifier = {
			factor = 10
			attacker = { religion = defender } # Intolerable circumstances
		}

		mult_modifier = {
			factor = 5

			attacker = { has_religion_feature = religion_patriarchal }
			defender = { has_religion_feature = religion_matriarchal }
		}

		mult_modifier = {
			factor = 5

			attacker = { has_religion_feature = religion_matriarchal }
			defender = { has_religion_feature = religion_patriarchal }
		}
	}
}

# Impious Saint induced Catholic Civil War
depose_impious_pope = {
	name = CB_NAME_DEPOSE_IMPIOUS_POPE
	war_name = WAR_NAME_DEPOSE_IMPIOUS_POPE
	sprite = 29
	truce_days = 0
	sort_priority = 750

	is_permanent = no
	allow_whitepeace = no
	defender_unoccupied_warscore = yes
	allowed_to_target_tributaries = no

	can_use = {
		always = no # Can only be initiated through special means
	}

	is_valid = {
		always = no # Disabled in CK2Plus

		# Defender
		FROM = {
			has_landed_title = k_papal_state
			trait = bad_priest_christian
			independent = yes
			religion = catholic
		}
	}

	on_success = {
		custom_tooltip = {
			text = depose_impious_pope_cb_win_TT

			any_attacker = {
				piety = 100
			}
		}

		defender = {
			show_scope_change = no

			abdicate = yes

			religion_authority = {
				name = depose_impious_pope_modifier
			}
		}

		hidden_effect = {
			any_defender = {
				set_character_flag = impious_papal_defender
			}

			any_playable_ruler = {
				limit = { religion = catholic }
				narrative_event = { id = HF.40094 } # The Pope loses and has to abdicate
			}

			attacker = {
				narrative_event = { id = HF.40094 } # The Pope loses and has to abdicate
			}

			k_papal_state = {
				owner = {
					save_event_target_as = current_pope
					reverse_imprison = defender
				}
			}

			any_attacker = {
				reverse_opinion = {
					name = opinion_grateful
					who = event_target:current_pope
					years = 10
				}
			}
		}
	}

	on_reverse_demand = {
		custom_tooltip = {
			text = depose_impious_pope_cb_lose_TT

			any_attacker = {
				add_trait = excommunicated
				piety = -100
			}
		}

		defender = {
			show_scope_change = no

			religion_authority = {
				name = failed_to_depose_impious_pope_modifier
			}
		}

		hidden_effect = {
			any_defender = {
				set_character_flag = impious_papal_defender
			}

			any_playable_ruler = {
				limit = { religion = catholic }
				narrative_event = { id = HF.40095 } # The Pope wins
			}

			attacker = {
				narrative_event = { id = HF.40095 } # The Pope wins
			}
		}

	}

	on_attacker_leader_death = {
		if = {
			limit = { has_global_flag = pre_catholic_civil_war }
			end_war = invalid
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# Shepherds' Crusade
shepherds_crusade_invasion = {
	name = CB_NAME_SHEPHERDS_CRUSADE
	war_name = WAR_NAME_SHEPHERDS_CRUSADE
	sprite = 9
	truce_days = 0

	check_de_jure_tier = KING
	is_permanent = no
	allow_whitepeace = no
	can_ask_to_join_war = yes
	is_holy_war = yes
	defender_unoccupied_warscore = yes
	allowed_to_target_tributaries = yes

	can_use = {
		always = no # Can only be initiated through special means
	}

	is_valid = {
		# Defender
		defender = {
			NOT = { religion = ROOT }
		}
	}

	on_attacker_leader_death = {
		any_playable_ruler = {
			narrative_event = { id = HFP.42310 }
		}
	}

	on_success_title = {
		save_event_target_as = shepherds_kingdom

		if = {
			limit = {
				OR = {
					has_holder = no
					holder = defender

					holder_scope = {
						top_liege = {
							character = defender
						}
					}
				}
			}

			gain_title = attacker
		}
		else = {
			create_title = {
				tier = KING
				name = KINGDOM_OF_THE_SHEPHERDS
				holder = attacker
				culture = attacker
				base_title = event_target:shepherds_kingdom
			}

			add_claim = attacker
		}

		attacker = {
			gain_settlements_under_title = {
				title = PREV
				enemy = defender
				is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
				type = holy_war
			}

			clr_character_flag = shepherds_leader
			set_defacto_liege = attacker

			hidden_effect = {
				dynasty = father_bastard

				if = {
					limit = { is_female = no }

					add_trait = crusader_king

					create_bloodline = {
						type = crusader_commander
					}
				}
				else = {
					add_trait = crusader_queen

					create_bloodline = {
						type = crusader_commander
						inheritance = matrilineal
					}
				}

				set_bloodline_founder_religion_flag_effect = yes

				event_target:shepherds_kingdom = {
					capital_scope = {
						attacker = {
							capital = PREV
						}

					#	save_event_target_as = shepherds_capital

						duchy = {
							save_event_target_as = shepherds_duchy
						}
					}
				}

				primary_title = {
					add_law = {
						law = succ_primogeniture
						cooldown = no
						opinion_effect = no
					}

					add_law = {
						law = centralization_2
						cooldown = no
						opinion_effect = no
					}

					add_law = {
						law = cognatic_succession
						cooldown = no
						opinion_effect = no
					}

					if = {
						limit = { has_dlc = "Conclave" }

						add_law = {
							law = ze_administration_laws_1
							cooldown = no
							opinion_effect = no
						}

						add_law = {
							law = out_of_realm_inheritance_law_1
							cooldown = no
							opinion_effect = no
						}
					}
					else = {
						add_law = {
							law = crown_authority_3
							cooldown = no
							opinion_effect = no
						}
					}
				}

				character_event = { id = HFP.41090 days = 1 } # Refill the levy, and remove the negative modifiers
				character_event = { id = HFP.41090 days = 3 } # Refill the levy, and remove the negative modifiers

				if = {
					limit = { wealth < 200 }

					clear_wealth = yes
					wealth = 200
				}

				any_demesne_title = {
					limit = {
						OR = {
							location = {
								duchy = {
									NOT = { title = event_target:shepherds_duchy }
								}
							}

							holding_type = city
							holding_type = temple
						}
					}

					if = {
						limit = { holding_type = city }

						create_random_steward = {
							random_traits = yes
							dynasty = random
						}
					}
					else_if = {
						limit = { holding_type = temple }

						create_random_priest = {
							random_traits = yes
							dynasty = random
						}
					}
					else_if = {
						limit = { holding_type = castle }

						create_random_soldier = {
							random_traits = yes
							dynasty = random
						}
					}

					grant_title_no_opinion = new_character

					new_character = {
						add_trait = crusader
						add_trait = brave

						attacker = {
							set_truce = {
								who = PREV
								years = 10
							}
						}
					}
				}

				event_target:shepherds_kingdom = {
					any_direct_de_jure_vassal_title = {
						random_direct_de_jure_vassal_title = {
							limit = {
								holder_scope = {
									top_liege = {
										character = attacker
									}
								}
							}

							holder_scope = {
								gain_title = PREVPREV

								primary_title = {
									any_direct_de_jure_vassal_title = {
										limit = {
											holder_scope = {
												top_liege = {
													character = attacker
												}
											}
										}

										holder_scope = {
											set_defacto_liege = PREVPREVPREV
										}
									}
								}

								set_defacto_liege = attacker
							}
						}
					}
				}

				any_claim = {
					remove_claim = PREV
				}
			}

			if = {
				limit = { can_apply_average_nickname_trigger = yes }

				random_list = {
					10 = { give_nickname = nick_the_crusader }
					10 = { give_nickname = nick_the_holy }
					10 = { give_nickname = nick_the_pilgrim }
					10 = { give_nickname = nick_the_protector }
					10 = { give_nickname = nick_the_guardian }
					40 = { give_nickname = nick_the_sword_of_god }
				}
			}

			check_if_reconquista_finished_effect = yes
		}

		any_playable_ruler = {
			narrative_event = { id = HFP.42309 } # Victorious Shepherds' Crusade
		}
	}

	on_reverse_demand = {
		# Attackers
		any_attacker = {
			show_scope_change = no

			transfer_scaled_wealth = {
				to = defender
				value = 1.0
			}
			piety = -100
		}

		defender = {
			show_scope_change = no

			piety = 200
			reverse_imprison = attacker
		}

		any_playable_ruler = {
			narrative_event = { id = HFP.42308 } # Failed Shepherds' Crusade
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# Northern Crusade
northern_crusade_war = {
	name = CB_NAME_NORTHERN_CRUSADE
	war_name = WAR_NAME_NORTHERN_CRUSADE
	sprite = 9
	truce_days = 1825

	is_permanent = no # Disabled in CK2Plus
	is_holy_war = yes
	check_de_jure_tier = DUKE
	allow_whitepeace = no
	can_ask_to_join_war = yes
	defender_unoccupied_warscore = yes
	allowed_to_target_tributaries = yes

	can_use_gui = {
		# Attacker
		ROOT = {
			prisoner = no
			is_adult = yes
		}
	}

	can_use = {
		# Attacker
		ROOT = {
			OR = {
				has_landed_title = d_teutonic_order
				has_landed_title = k_teutonic_state
			}
		}

		# Defender
		FROM = {
			NOT = { religion_group = ROOT }
		}
	}

	can_use_title = {
		kingdom = {
			has_title_flag = northern_crusade_active_target
		}
	}

	is_valid = {
		# Defender
		FROM = {
			NOT = { religion = ROOT }
		}
	}

	on_success = {
		any_attacker = {
			limit = {
				NOR = {
					has_landed_title = d_teutonic_order
					has_landed_title = k_teutonic_state
				}
			}

			piety = 150
		}

		any_defender = {
			piety = -100
		}
	}

	on_success_title = {
		save_event_target_as = northern_crusade_title

		# Attacker
		attacker = {
			show_scope_change = no

			vassalize_or_take_under_title = {
				title = PREV
				enemy = defender
				same_religion = yes # Only vassalize rulers of my religion
				is_religious = yes
				type = holy_war
			}

			hidden_effect = {
				# If the Teutonic Order don't have a base to work out from, get one
				if = {
					limit = {
						capital_scope = {
							duchy = {
								title = PREVPREVPREV
							}
						}
					}

					teutonic_order_upgrade_capital_effect = yes
					holy_order_distribute_titles_effect = yes
					character_event = { id = HFP.41090 days = 1 } # Refill the levy, and remove the negative modifiers
					character_event = { id = HFP.41090 days = 3 } # Refill the levy, and remove the negative modifiers
				}

				# Become the Teutonic State, if they aren't already
				if = {
					limit = {
						NOT = { has_landed_title = k_teutonic_state }
					}

					k_teutonic_state = {
						copy_title_history = d_teutonic_order
						copy_title_laws = d_teutonic_order
					}

					grant_title_no_opinion = k_teutonic_state
					unsafe_destroy_landed_title = d_teutonic_order

					activate_title = {
						title = d_teutonic_order
						status = no
					}
				}

				## Rewards
				# Check who to give artifacts
				any_attacker = {
					limit = {
						NOT = { character = attacker }

						any_war = {
							using_cb = northern_crusade_war

							war_participation = {
								who = PREV
								score > 40
							}
						}
					}

					set_character_flag = northern_crusade_artifact_reward
				}

				# Check who to give money
				any_attacker = {
					limit = {
						NOT = { character = attacker }

						any_war = {
							using_cb = northern_crusade_war

							war_participation = {
								who = PREV
								score > 20
							}
						}
					}

					set_character_flag = northern_crusade_gold_reward
				}

				# Check who to give artifacts
				any_attacker = {
					limit = {
						NOT = { character = attacker }

						any_war = {
							using_cb = northern_crusade_war

							war_participation = {
								who = PREV
								score > 0.01
							}
						}
					}

					letter_event = {
						id = HF.49112 # Reward letter from Teutons after the war
						days = 1
					}
				}

				# Checking for Bloodline
				most_participating_attacker = {
					if = {
						limit = {
							NOT = { character = attacker }
						}

						if = {
							limit = {
								check_variable = {
									which = northern_crusade_ally
									value == 1
								}
							}

							set_variable = {
								which = northern_crusade_ally
								value = 2
							}
						}
						else_if = {
							limit = {
								check_variable = {
									which = northern_crusade_ally
									value >= 2
								}
							}

							character_event = { id = HF.49114 } # Northern Crusade Bloodline
						}
						else = {
							set_variable = {
								which = northern_crusade_ally
								value = 1
							}
						}
					}
				}

				## Misc
				# Check if the Northern Crusade is over
				if = {
					limit = {
						PREV = {
							kingdom = {
								has_title_flag = northern_crusade_active_target

								NOT = {
									any_direct_de_jure_vassal_title = {
										any_direct_de_jure_vassal_title = {
											holder_scope = {
												NOT = { religion_group = christian }
											}
										}
									}
								}
							}
						}
					}

					PREV = {
						kingdom = {
							save_event_target_as = northern_crusade_kingdom
							clr_title_flag = northern_crusade_active_target
						}
					}

					religion_authority = {
						name = northern_crusade_won
					}

					attacker = {
						narrative_event = { id = HF.49115 } # Northern Crusade Successful
					}

					any_playable_ruler = {
						narrative_event = { id = HF.49115 } # Northern Crusade Successful
					}

					set_global_flag = northern_crusade_success
					clr_global_flag = northern_crusades_active
				}
			}
		}
	}

	on_reverse_demand = {
		# Attacker
		attacker = {
			show_scope_change = no

			hidden_effect = {
				if = {
					limit = {
						check_variable = {
							which = northernCrusadeValue
							value == 1
						}
					}

					set_variable = {
						which = northernCrusadeValue
						value = 2
					}
				}
				else_if = {
					limit = {
						check_variable = {
							which = northernCrusadeValue
							value >= 2
						}
					}

					attacker = {
						narrative_event = { id = HF.49113 } # The Northern Crusades has failed
					}

					defender = {
						narrative_event = { id = HF.49113 } # The Northern Crusades has failed
					}

					any_playable_ruler = {
						narrative_event = { id = HF.49113 } # The Northern Crusades has failed
					}
				}
				else = {
					set_variable = {
						which = northernCrusadeValue
						value = 1
					}
				}
			}
		}

		any_attacker = {
			piety = -100
		}

		any_defender = {
			piety = 150
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}