###########################################
#
# Society decisions for secret religious societies
#
###########################################

society_decisions = {
	secret_religions_falsely_confess_faith = {
		only_playable = yes
		
		potential = {
			OR = {
				liege = {
					NOT = {
						religion = ROOT
					}
				}
				top_liege = {
					NOT = {
						religion = ROOT
					}
				}
			}
		}
		allow = {
			piety = 100
		}
		effect = {
			piety = -100
			trigger_switch = {
				on_trigger = religion
				catholic = { add_trait = secretly_catholic }
				cathar = { add_trait = secretly_cathar }
				fraticelli = { add_trait = secretly_fraticelli }
				waldensian = { add_trait = secretly_waldensian }
				lollard = { add_trait = secretly_lollard }
				orthodox = { add_trait = secretly_orthodox }
				bogomilist = { add_trait = secretly_bogomilist }
				monothelite = { add_trait = secretly_monothelite }
				iconoclast = { add_trait = secretly_iconoclast }
				paulician = { add_trait = secretly_paulician }
				miaphysite = { add_trait = secretly_miaphysite }
				monophysite = { add_trait = secretly_monophysite }
				nestorian = { add_trait = secretly_nestorian }
				messalian = { add_trait = secretly_messalian }
				sunni = { add_trait = secretly_sunni }
				zikri = { add_trait = secretly_zikri }
				yazidi = { add_trait = secretly_yazidi }
				shiite = { add_trait = secretly_shiite }
				druze = { add_trait = secretly_druze }
				hurufi = { add_trait = secretly_hurufi }
				ibadi = { add_trait = secretly_ibadi }
				kharijite = { add_trait = secretly_kharijite }
				jewish = { add_trait = secretly_jewish }
				samaritan = { add_trait = secretly_samaritan }
				karaite = { add_trait = secretly_karaite }
				zoroastrian = { add_trait = secretly_zoroastrian }
				mazdaki = { add_trait = secretly_mazdaki }
				manichean = { add_trait = secretly_manichean }
				hindu = { add_trait = secretly_hinduism }
				buddhist = { add_trait = secretly_buddhism }
				jain = { add_trait = secretly_jain }
				norse_pagan = { add_trait = secretly_norse_pagan }
				norse_pagan_reformed = { add_trait = secretly_norse_pagan_reformed }
				baltic_pagan = { add_trait = secretly_baltic_pagan }
				baltic_pagan_reformed = { add_trait = secretly_baltic_pagan_reformed }
				finnish_pagan = { add_trait = secretly_finnish_pagan }
				finnish_pagan_reformed = { add_trait = secretly_finnish_pagan_reformed }
				slavic_pagan = { add_trait = secretly_slavic_pagan }
				slavic_pagan_reformed = { add_trait = secretly_slavic_pagan_reformed }
				tengri_pagan = { add_trait = secretly_tengri_pagan }
				tengri_pagan_reformed = { add_trait = secretly_tengri_pagan_reformed }
				aztec = { add_trait = secretly_aztec }
				aztec_reformed = { add_trait = secretly_aztec_reformed }
				west_african_pagan = { add_trait = secretly_west_african_pagan }
				west_african_pagan_reformed = { add_trait = secretly_west_african_pagan_reformed }
				zun_pagan = { add_trait = secretly_zun_pagan }
				zun_pagan_reformed = { add_trait = secretly_zun_pagan_reformed }
				hellenic_pagan = { add_trait = secretly_hellenic_pagan }
				pagan = { add_trait = secretly_pagan }
			}
			custom_tooltip = {
				text = confess_faith_decision_tooltip
				hidden_effect = {
					if = {
						limit = {
							liege = {
								NOT = {
									religion = ROOT
								}
							}
						}
						liege = {
							ROOT = {
								religion = PREV
								break = yes
							}
						}
					}
					if = {
						limit = {
							top_liege = {
								NOT = {
									religion = ROOT
								}
							}
						}
						top_liege = {
							ROOT = {
								religion = PREV
								break = yes
							}
						}
					}
				}
			}
		}
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	secret_religions_found_secret_religious_society = {
		only_playable = yes
		
		is_high_prio = yes
	
		potential = {
			OR = {
				AND = {
					trait = secretly_catholic
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_catholic
						}
					}
				}
				AND = {
					trait = secretly_orthodox
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_orthodox
						}
					}
				}
				AND = {
					trait = secretly_sunni
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_sunni
						}
					}
				}
				AND = {
					trait = secretly_shiite
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_shiite
						}
					}
				}
				AND = {
					trait = secretly_jewish
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_jewish
						}
					}
				}
				AND = {
					trait = secretly_zoroastrian
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_zoroastrian
						}
					}
				}
				AND = {
					trait = secretly_hinduism
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_hinduism
						}
					}
				}
				AND = {
					trait = secretly_buddhism
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_buddhism
						}
					}
				}
				AND = {
					trait = secretly_jain
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_jain
						}
					}
				}
				AND = {
					trait = secretly_norse_pagan_reformed
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_norse_pagan_reformed
						}
					}
				}
				AND = {
					trait = secretly_baltic_pagan_reformed
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_baltic_pagan_reformed
						}
					}
				}
				AND = {
					trait = secretly_finnish_pagan_reformed
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_finnish_pagan_reformed
						}
					}
				}
				AND = {
					trait = secretly_slavic_pagan_reformed
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_slavic_pagan_reformed
						}
					}
				}
				AND = {
					trait = secretly_tengri_pagan_reformed
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_tengri_pagan_reformed
						}
					}
				}
				AND = {
					trait = secretly_west_african_pagan_reformed
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_west_african_pagan_reformed
						}
					}
				}
				AND = {
					trait = secretly_zun_pagan_reformed
					NOT = {
						any_society_member = {
							society_member_of = secret_religious_society_zun_pagan_reformed
						}
					}
				}
			}
		}
		
		allow = {
			prestige = 250
			NOT = { is_in_society = yes }
		}
		
		effect = {
			prestige = -250
			trigger_switch = {
				on_trigger = trait # Found society depending on your secret religion
				secretly_catholic = { join_society = secret_religious_society_catholic }
				secretly_orthodox = { join_society = secret_religious_society_orthodox }
				secretly_sunni = { join_society = secret_religious_society_sunni }
				secretly_shiite = { join_society = secret_religious_society_shiite }
				secretly_jewish = { join_society = secret_religious_society_jewish }
				secretly_zoroastrian = { join_society = secret_religious_society_zoroastrian }
				secretly_hinduism = { join_society = secret_religious_society_hinduism }
				secretly_buddhism = { join_society = secret_religious_society_buddhism }
				secretly_jain = { join_society = secret_religious_society_jain }
				secretly_norse_pagan_reformed = { join_society = secret_religious_society_norse_pagan_reformed }
				secretly_baltic_pagan_reformed = { join_society = secret_religious_society_baltic_pagan_reformed }
				secretly_finnish_pagan_reformed = { join_society = secret_religious_society_finnish_pagan_reformed }
				secretly_slavic_pagan_reformed = { join_society = secret_religious_society_slavic_pagan_reformed }
				secretly_tengri_pagan_reformed = { join_society = secret_religious_society_tengri_pagan_reformed }
				secretly_west_african_pagan_reformed = { join_society = secret_religious_society_west_african_pagan_reformed }
				secretly_zun_pagan_reformed = { join_society = secret_religious_society_zun_pagan_reformed }
			}
			
			society_rank_up = 3 # Rank up character
			set_society_grandmaster = yes # Set character as Grand Master
			add_society_currency_massive_effect = yes # Give the Grand Master a start-up capital to induct members
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	secret_religions_openly_adopt_faith = {
		
		potential = {
			OR = {
				society_member_of = secret_religious_society_catholic
				society_member_of = secret_religious_society_orthodox
				society_member_of = secret_religious_society_sunni
				society_member_of = secret_religious_society_shiite
				society_member_of = secret_religious_society_jewish
				society_member_of = secret_religious_society_zoroastrian
				society_member_of = secret_religious_society_hinduism
				society_member_of = secret_religious_society_buddhism
				society_member_of = secret_religious_society_jain
				society_member_of = secret_religious_society_norse_pagan_reformed
				society_member_of = secret_religious_society_baltic_pagan_reformed
				society_member_of = secret_religious_society_finnish_pagan_reformed
				society_member_of = secret_religious_society_slavic_pagan_reformed
				society_member_of = secret_religious_society_tengri_pagan_reformed
				society_member_of = secret_religious_society_west_african_pagan_reformed
				society_member_of = secret_religious_society_zun_pagan_reformed
			}

			society_rank == 4
		}
	
		allow = {
			has_society_currency_major_trigger = yes
			custom_tooltip = {
				text = openly_adopt_faith_trigger_tooltip
				hidden_trigger = {
					OR = {
						realm_character_percent = { # xxx should we make a realm_ruler_percent trigger?
							target = 0.3
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
						AND = {
							realm_character_percent = {
								target = 0.25
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
							liege = {
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
						}
						AND = {
							realm_character_percent = {
								target = 0.20
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
							top_liege = {
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
							liege = {
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
						}
						AND = {
							realm_character_percent = {
								target = 0.15
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
							any_vassal = {
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
							top_liege = {
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
							liege = {
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
						}
					}
				}
			}
		}
		
		effect = {
			detract_society_currency_major_effect = yes
			custom_tooltip = {
				text = openly_adopt_faith_effect_tooltip
				hidden_effect = {
					any_realm_character = {
						if = {
							limit = {
								same_society_as = ROOT
							}
							character_event = { id = MNM.3800 } # Convert cultists
						}
						
						if = {
							limit = {
								NOT = {
									same_society_as = ROOT
								}
								OR = {
									has_prevs_secret_religion_truly_trigger = yes
									has_sympathy_for_true_religion_of_prev_trigger = yes
								}
							}
							character_event = { id = MNM.3810 } # Allow sympathisers the chance to flip
						}
						
						if = {
							limit = {
								is_ruler = yes
								any_demesne_province = {
									OR = {
										AND = {
											has_province_modifier = secret_catholic_community
											ROOT = {
												society_member_of = secret_religious_society_catholic
											}
										}
										
										AND = {
											has_province_modifier = secret_orthodox_community
											ROOT = {
												society_member_of = secret_religious_society_orthodox
											}
										}
										
										AND = {
											has_province_modifier = secret_sunni_community
											ROOT = {
												society_member_of = secret_religious_society_sunni
											}
										}
										
										AND = {
											has_province_modifier = secret_shiite_community
											ROOT = {
												society_member_of = secret_religious_society_shiite
											}
										}
										
										AND = {
											has_province_modifier = secret_jewish_community
											ROOT = {
												society_member_of = secret_religious_society_jewish
											}
										}
										
										AND = {
											has_province_modifier = secret_zoroastrian_community
											ROOT = {
												society_member_of = secret_religious_society_zoroastrian
											}
										}
										
										AND = {
											has_province_modifier = secret_hinduism_community
											ROOT = {
												society_member_of = secret_religious_society_hinduism
											}
										}
										
										AND = {
											has_province_modifier = secret_buddhism_community
											ROOT = {
												society_member_of = secret_religious_society_buddhism
											}
										}
										
										AND = {
											has_province_modifier = secret_jain_community
											ROOT = {
												society_member_of = secret_religious_society_jain
											}
										}
										
										AND = {
											has_province_modifier = secret_norse_pagan_reformed_community
											ROOT = {
												society_member_of = secret_religious_society_norse_pagan_reformed
											}
										}
										
										AND = {
											has_province_modifier = secret_baltic_pagan_reformed_community
											ROOT = {
												society_member_of = secret_religious_society_baltic_pagan_reformed
											}
										}
										
										AND = {
											has_province_modifier = secret_finnish_pagan_reformed_community
											ROOT = {
												society_member_of = secret_religious_society_finnish_pagan_reformed
											}
										}
										
										AND = {
											has_province_modifier = secret_slavic_pagan_reformed_community
											ROOT = {
												society_member_of = secret_religious_society_slavic_pagan_reformed
											}
										}
										
										AND = {
											has_province_modifier = secret_tengri_pagan_reformed_community
											ROOT = {
												society_member_of = secret_religious_society_tengri_pagan_reformed
											}
										}
										
										AND = {
											has_province_modifier = secret_west_african_pagan_reformed_community
											ROOT = {
												society_member_of = secret_religious_society_west_african_pagan_reformed
											}
										}
										
										AND = {
											has_province_modifier = secret_zun_pagan_reformed_community
											ROOT = {
												society_member_of = secret_religious_society_zun_pagan_reformed
											}
										}
									}
								}
							}
							character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
						}
					}
					flip_to_secret_religion_effect = yes
					
					any_realm_lord = {
						character_event = { id = MNM.3830 } # Inform lieges unless they're part of the cult flipping, save a flag on previous events.
					}
					
					any_realm_character = {
						limit = {
							same_society_as = ROOT
						}
						leave_society = yes
					}
					
					leave_society = yes
				}
			}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.001 # Slow down
			}
			modifier = {
				factor = 0
				any_society_member = {
					same_realm = ROOT
					ai = no
					society_rank > 2
				}
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.15
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}				
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.25
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}				
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.35
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}				
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.5
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}				
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.65
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}				
			}
		}
	}

	secret_religions_blend_in = {
		
		potential = {
			has_dlc = "Mystics"
			is_secret_religious_society_member_trigger = yes
			has_quest = quest_secret_religions_societies_blend_in
			NOT = { has_character_modifier = attempting_to_blend_in }
		}
		allow = {
			has_quest = quest_secret_religions_societies_blend_in
			is_inaccessible_trigger = no
			prisoner = no
			custom_tooltip = {
				text = quest_secret_religions_societies_blend_in_allow_tt
				OR = {
					NOT = { has_character_flag = blending_in_timer }
					had_character_flag = { flag = blending_in_timer days = 1000 }
				}
			}
		}

		effect = {
			add_character_modifier = {
				name = attempting_to_blend_in
				duration = -1
			}
			hidden_effect = { character_event = { id = MNM.3399 } }
		}

		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0.1

			modifier = {
				factor = 0.01
				war = yes
			}
			modifier = {
				factor = 1.1
				OR = {
					trait = gregarious
					trait = socializer
				}
			}
			modifier = {
				factor = 0.1
				trait = shy
			}
			modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
		}
	}
}

targeted_decisions = {
	secret_religions_recruit = {
		is_in_society = yes
		
		filter = realm 
		ai_target_filter = realm

		from_potential = {
			is_secret_religious_society_member_trigger = yes
			has_dlc = "Mystics"
			is_inaccessible_trigger = no
		}

		potential = {
			same_realm = FROM
			is_adult = yes
			prisoner = no
			is_inaccessible_trigger = no
			FROM = { shares_prevs_secret_religion_trigger = yes	}
			NOT = {
				character = FROM
				society = {
					FROM = {
						society = {
							society_type = prevprev
						}
					}
				}
			}

			#AI can't invite when the society is full
			NAND = {
				ai = yes
				FROM = { ai = yes }
				NOT = {
					FROM = {
						society = {
							ROOT = {
								can_join_society = PREV
							}
						}
					}
				}
			}
		}

		allow = {
			custom_tooltip = {
				text = secret_religions_recruit_allow_tt
				FROM = { shares_prevs_secret_religion_trigger = yes }
			}
			custom_tooltip = {
				text = secret_religions_recruit_cd_tt
				NOT = { has_character_modifier = secret_religions_recruitment_timer }
			}
		}

		effect = {
			custom_tooltip = { 	
				text = secret_religions_recruit_effect_tt
				FROM = { save_event_target_as = secret_religions_recruiter } 
				character_event = { id = MNM.3420 days = 14 }

				add_character_modifier = {
					name = secret_religions_recruitment_timer
					years = 5
					hidden = yes
				}
			}
		}

		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0.01
			modifier = {
				is_ruler = yes
				factor = 10
			}
			modifier = {
				diplomacy = 12
    			factor = 3
			}
			modifier = {
				diplomacy = 15
    			factor = 3
			}
			modifier = {
				trait = paranoid
    			factor = 0.1
			}
			modifier = {
				trait = craven
    			factor = 0.1
			}
		}
	}


	secret_religions_evoke_sympathy = {
		is_in_society = yes
		
		filter = realm 
		ai_target_filter = realm

		from_potential = {
			is_secret_religious_society_member_trigger = yes
			has_dlc = "Mystics"
			is_inaccessible_trigger = no
		}

		potential = {
			same_realm = FROM
			is_adult = yes
			prisoner = no
			is_inaccessible_trigger = no
			NOT = { same_society_as = FROM }
			FROM = { 
				ROOT = { 
					has_sympathy_for_true_religion_of_prev_trigger = no
					is_openly_of_prevs_true_religion_group = no
					shares_prevs_secret_religion_trigger = no
				}
			}
			NOT = { 
				character = FROM
				society = {
					FROM = {
						society = {
							society_type = PREVPREV
						}
					}
				}
			}
		}

		allow = {
			custom_tooltip = {
				text = secret_religions_evoke_sympathy_cd_tt
				OR = {
					NOT = { has_character_modifier = secret_religion_sympathy_timer }
					AND = {
						has_quest = quest_secret_religious_societies_sympathy_ruler
						ROOT = { is_quest_target_of = FROM }
					}
				}
			}
			OR = {
				AND = {
					has_quest = quest_secret_religious_societies_sympathy_ruler
					ROOT = { is_quest_target_of = FROM }
				}
				FROM = { has_society_currency_minor_trigger = yes }	
			}
		}

		effect = {
			if = {
				limit = {
					NOT = {
						AND = {
							has_quest = quest_secret_religious_societies_sympathy_ruler
							ROOT = { is_quest_target_of = FROM }
						}
					}
				}
				FROM = { detract_society_currency_minor_effect = yes }
			}

			hidden_effect = {
				add_character_modifier = {
					name = secret_religion_sympathy_timer
					years = 5
					hidden = yes
				}
			}

			custom_tooltip = {
				text = secret_religions_evoke_sympathy_tt
				FROM = { character_event = { id = MNM.3404 days = 7 } }
			}
		}

		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0.01
			modifier = {
				FROM = { has_quest = quest_secret_religious_soceities_sympathy_ruler }
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				FROM = { has_quest = quest_secret_religious_soceities_induct_ruler } #to complete this mission, sympathy is needed first
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				is_ruler = yes
				factor = 0.1 #to save targets for missions
			}
			modifier = {
				trait = zealous
				factor = 0.0001
			}
			modifier = {
				is_close_relative = FROM
				factor = 10
			}
			modifier = {
				is_lover = FROM
				factor = 10
			}
			modifier = {
				is_friend = FROM
				factor = 10
			}
			modifier = {
				trait = kind
				factor = 5
			}
			modifier = {
				trait = trusting
				factor = 5
			}
		}
	}


	secret_religions_induct_character = {
		is_in_society = yes
		
		filter = realm
		ai_target_filter = realm
		
		from_potential = {
			is_secret_religious_society_member_trigger = yes
			has_dlc = "Mystics"
			society_rank >= 2
			is_inaccessible_trigger = no
		}
		
		potential = {
			is_adult = yes
			prisoner = no
			is_inaccessible_trigger = no
			FROM = { ROOT = { is_openly_of_prevs_secret_religion_trigger = no } }
			FROM = { 
				ROOT = { 
					OR = {
						has_sympathy_for_true_religion_of_prev_trigger = yes
						is_openly_of_prevs_true_religion_group = yes 
					}
				}
			}
		}

		allow = {
			custom_tooltip = {
				text = secret_religions_induct_character_cd_tt
				OR = {
					NOT = { has_character_modifier = secret_religion_induction_timer }
					has_quest = quest_secret_religious_soceities_induct_ruler
				}
			}
			OR = {
				AND = {
					is_ruler = no
					FROM = { has_society_currency_minor_trigger = yes }
				}
				AND = {
					is_ruler = yes
					FROM = { has_society_currency_medium_trigger = yes }
				}
			}
		}

		effect = {
			if = {
				limit = { is_ruler = no  }
				FROM = { detract_society_currency_minor_effect = yes }
			}
			if = {
				limit = { is_ruler = yes  }
				FROM = { detract_society_currency_medium_effect = yes }
			}

			hidden_effect = {
				add_character_modifier = {
					name = secret_religion_induction_timer
					years = 5
					hidden = yes
				}
			}

			custom_tooltip = {
				text = secret_religions_induct_character_effect_tt
				FROM = { character_event = { id = MNM.3408 days = 10 } }
			}
		}

		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0.01
			modifier = {
				FROM = { has_quest = quest_secret_religious_soceities_induct_ruler }
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				is_ruler = yes
				factor = 0.1 #to save targets for missions
			}
			modifier = {
				is_close_relative = FROM
				factor = 10
			}
			modifier = {
				is_lover = FROM
				factor = 10
			}
			modifier = {
				is_friend = FROM
				factor = 10
			}
			modifier = {
				trait = trusting
				factor = 5
			}
		}
	}

	secret_religions_induct_child = {
		is_in_society = yes
		
		filter = court
		ai_target_filter = court

		from_potential = {
			is_secret_religious_society_member_trigger = yes
			has_dlc = "Mystics"
			is_inaccessible_trigger = no
		}

		potential = {
			is_adult = no
			age = 10
			OR = {
				mother = { character = FROM }
				father = { character = FROM }
				educator = { character = FROM }
				guardian = { character = FROM }
			}
			has_secret_religion_trait_trigger = no
		}

		allow = {
			custom_tooltip = {
				text = secret_religions_induct_child_allow_tt
				FROM = { shares_prevs_secret_religion_trigger = no }
			}
			custom_tooltip = {
				text = secret_religions_induct_character_cd_tt
				NOT = { has_character_modifier = secret_religions_induct_child_timer }
			}
		}

		effect = {
			custom_tooltip = {
				text = secret_religions_induct_child_effect

				FROM = { character_event = { id = MNM.3438 } }

				hidden_effect = {
					add_character_modifier = {
						name = secret_religions_induct_child_timer
						years = 6
					}
				}
			}
		}

		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0.01
			modifier = {
				FROM = { has_quest = quest_secret_religious_soceities_induct_ruler }
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				OR = {
					mother = { character = FROM }
					father = { character = FROM }
				}
				factor = 10
			}
			modifier = {
				FROM = { current_heir = { character = ROOT } }
				factor = 10
			}
			modifier = {
				is_friend = FROM
				factor = 10
			}
			modifier = {
				trait = trusting
				factor = 5
			}
		}
	}
	
	secret_religions_renounce_secret_religion = {
		only_playable = yes
		
		filter = self
		ai_target_filter = self
		
		potential = {
			character = FROM
			OR = {
				trait = secretly_catholic
				trait = secretly_cathar
				trait = secretly_fraticelli
				trait = secretly_waldensian
				trait = secretly_lollard
				trait = secretly_orthodox
				trait = secretly_bogomilist
				trait = secretly_monothelite
				trait = secretly_iconoclast
				trait = secretly_paulician
				trait = secretly_miaphysite
				trait = secretly_monophysite
				trait = secretly_nestorian
				trait = secretly_messalian
				trait = secretly_sunni
				trait = secretly_zikri
				trait = secretly_yazidi
				trait = secretly_shiite
				trait = secretly_druze
				trait = secretly_hurufi
				trait = secretly_ibadi
				trait = secretly_kharijite
				trait = secretly_jewish
				trait = secretly_samaritan
				trait = secretly_karaite
				trait = secretly_zoroastrian
				trait = secretly_mazdaki
				trait = secretly_manichean
				trait = secretly_hinduism
				trait = secretly_buddhism
				trait = secretly_jain
				trait = secretly_norse_pagan
				trait = secretly_norse_pagan_reformed
				trait = secretly_baltic_pagan
				trait = secretly_baltic_pagan_reformed
				trait = secretly_finnish_pagan
				trait = secretly_finnish_pagan_reformed
				trait = secretly_slavic_pagan
				trait = secretly_slavic_pagan_reformed
				trait = secretly_tengri_pagan
				trait = secretly_tengri_pagan_reformed
				trait = secretly_aztec
				trait = secretly_aztec_reformed
				trait = secretly_west_african_pagan
				trait = secretly_west_african_pagan_reformed
				trait = secretly_zun_pagan
				trait = secretly_zun_pagan_reformed
				trait = secretly_hellenic_pagan
				trait = secretly_pagan
			}
		}
		
		allow = {
			
		}
		
		effect = {
			trigger_switch = {
				on_trigger = trait
				secretly_catholic = { remove_trait = secretly_catholic }
				secretly_cathar = { remove_trait = secretly_cathar }
				secretly_fraticelli = { remove_trait = secretly_fraticelli }
				secretly_waldensian = { remove_trait = secretly_waldensian }
				secretly_lollard = { remove_trait = secretly_lollard }
				secretly_orthodox = { remove_trait = secretly_orthodox }
				secretly_bogomilist = { remove_trait = secretly_bogomilist }
				secretly_monothelite = { remove_trait = secretly_monothelite }
				secretly_iconoclast = { remove_trait = secretly_iconoclast }
				secretly_paulician = { remove_trait = secretly_paulician }
				secretly_miaphysite = { remove_trait = secretly_miaphysite }
				secretly_monophysite = { remove_trait = secretly_monophysite }
				secretly_nestorian = { remove_trait = secretly_nestorian }
				secretly_messalian = { remove_trait = secretly_messalian }
				secretly_sunni = { remove_trait = secretly_sunni }
				secretly_zikri = { remove_trait = secretly_zikri }
				secretly_yazidi = { remove_trait = secretly_yazidi }
				secretly_shiite = { remove_trait = secretly_shiite }
				secretly_druze = { remove_trait = secretly_druze }
				secretly_hurufi = { remove_trait = secretly_hurufi }
				secretly_ibadi = { remove_trait = secretly_ibadi }
				secretly_kharijite = { remove_trait = secretly_kharijite }
				secretly_jewish = { remove_trait = secretly_jewish }
				secretly_samaritan = { remove_trait = secretly_samaritan }
				secretly_karaite = { remove_trait = secretly_karaite }
				secretly_zoroastrian = { remove_trait = secretly_zoroastrian }
				secretly_mazdaki = { remove_trait = secretly_mazdaki }
				secretly_manichean = { remove_trait = secretly_manichean }
				secretly_hinduism = { remove_trait = secretly_hinduism }
				secretly_buddhism = { remove_trait = secretly_buddhism }
				secretly_jain = { remove_trait = secretly_jain }
				secretly_norse_pagan = { remove_trait = secretly_norse_pagan }
				secretly_norse_pagan_reformed = { remove_trait = secretly_norse_pagan_reformed }
				secretly_baltic_pagan = { remove_trait = secretly_baltic_pagan }
				secretly_baltic_pagan_reformed = { remove_trait = secretly_baltic_pagan_reformed }
				secretly_finnish_pagan = { remove_trait = secretly_finnish_pagan }
				secretly_finnish_pagan_reformed = { remove_trait = secretly_finnish_pagan_reformed }
				secretly_slavic_pagan = { remove_trait = secretly_slavic_pagan }
				secretly_slavic_pagan_reformed = { remove_trait = secretly_slavic_pagan_reformed }
				secretly_tengri_pagan = { remove_trait = secretly_tengri_pagan }
				secretly_tengri_pagan_reformed = { remove_trait = secretly_tengri_pagan_reformed }
				secretly_aztec = { remove_trait = secretly_aztec }
				secretly_aztec_reformed = { remove_trait = secretly_aztec_reformed }
				secretly_west_african_pagan = { remove_trait = secretly_west_african_pagan }
				secretly_west_african_pagan_reformed = { remove_trait = secretly_west_african_pagan_reformed }
				secretly_zun_pagan = { remove_trait = secretly_zun_pagan }
				secretly_zun_pagan_reformed = { remove_trait = secretly_zun_pagan_reformed }
				secretly_hellenic_pagan = { remove_trait = secretly_hellenic_pagan }
				secretly_pagan = { remove_trait = secretly_pagan }
			}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	secret_religions_personally_adopt_secret_religion = {
		only_playable = yes
		
		filter = self
		ai_target_filter = self
		
		potential = {
			character = FROM
			OR = {
				trait = secretly_catholic
				trait = secretly_cathar
				trait = secretly_fraticelli
				trait = secretly_waldensian
				trait = secretly_lollard
				trait = secretly_orthodox
				trait = secretly_bogomilist
				trait = secretly_monothelite
				trait = secretly_iconoclast
				trait = secretly_paulician
				trait = secretly_miaphysite
				trait = secretly_monophysite
				trait = secretly_nestorian
				trait = secretly_messalian
				trait = secretly_sunni
				trait = secretly_zikri
				trait = secretly_yazidi
				trait = secretly_shiite
				trait = secretly_druze
				trait = secretly_hurufi
				trait = secretly_ibadi
				trait = secretly_kharijite
				trait = secretly_jewish
				trait = secretly_samaritan
				trait = secretly_karaite
				trait = secretly_zoroastrian
				trait = secretly_mazdaki
				trait = secretly_manichean
				trait = secretly_hinduism
				trait = secretly_buddhism
				trait = secretly_jain
				trait = secretly_norse_pagan
				trait = secretly_norse_pagan_reformed
				trait = secretly_baltic_pagan
				trait = secretly_baltic_pagan_reformed
				trait = secretly_finnish_pagan
				trait = secretly_finnish_pagan_reformed
				trait = secretly_slavic_pagan
				trait = secretly_slavic_pagan_reformed
				trait = secretly_tengri_pagan
				trait = secretly_tengri_pagan_reformed
				trait = secretly_aztec
				trait = secretly_aztec_reformed
				trait = secretly_west_african_pagan
				trait = secretly_west_african_pagan_reformed
				trait = secretly_zun_pagan
				trait = secretly_zun_pagan_reformed
				trait = secretly_hellenic_pagan
				trait = secretly_pagan
			}
		}
		
		allow = {
			
		}
		
		effect = {
			flip_to_secret_religion_effect = yes
			trigger_switch = {
				on_trigger = religion
				catholic = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_catholic_community } religion = catholic
					}
				}
				orthodox = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_orthodox_community } religion = orthodox
					}
				}
				sunni = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_sunni_community } religion = sunni
					}
				}
				shiite = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_shiite_community } religion = shiite
					}
				}
				jewish = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_jewish_community } religion = jewish
					}
				}
				hindu = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_hinduism_community } religion = hindu
					}
				}
				buddhist = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_buddhism_community } religion = buddhist
					}
				}
				jain = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_jain_community } religion = jain
					}
				}
				norse_pagan_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_norse_pagan_reformed_community } 
						religion = norse_pagan_reformed
					}
				}
				baltic_pagan_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_baltic_pagan_reformed_community } 
						religion = baltic_pagan_reformed
					}
				}
				finnish_pagan_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_finnish_pagan_reformed_community } 
						religion = finnish_pagan_reformed
					}
				}
				slavic_pagan_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_slavic_pagan_reformed_community } 
						religion = slavic_pagan_reformed
					}
				}
				tengri_pagan_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_tengri_pagan_reformed_community } 
						religion = tengri_pagan_reformed
					}
				}
				west_african_pagan_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_west_african_pagan_reformed_community } 
						religion = west_african_pagan_reformed
					}
				}
				zun_pagan_reformed = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_zun_pagan_reformed_community } 
						religion = zun_pagan_reformed
					}
				}
			}
			liege = {
				character_event = { id = MNM.3840 }
			}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}

	secret_religions_conduct_secret_ceremony = {
		is_in_society = yes
		
		filter = self
		ai_target_filter = self
		
		potential = {
			has_dlc = "Mystics"
			is_secret_religious_society_member_trigger = yes
			has_quest = quest_secret_religions_conduct_secret_ceremony 
		}
		allow = {
			has_quest = quest_secret_religions_conduct_secret_ceremony
			is_inaccessible_trigger = no
			prisoner = no
			custom_tooltip = {
				text = quest_secret_religions_conduct_secret_ceremony_allow_tt
				OR = {
					NOT = { has_character_flag = conduct_secret_ceremony_timer }
					had_character_flag = { flag = conduct_secret_ceremony_timer days = 1000 }
				}
			}
		}

		effect = {
			set_character_flag = conduct_secret_ceremony_timer
			hidden_effect = { character_event = { id = MNM.3235 days = 2 } }
		}

		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0.01
			modifier = {
				is_ruler = yes
				factor = 10
			}
			modifier = {
				diplomacy = 12
    			factor = 3
			}
			modifier = {
				diplomacy = 15
    			factor = 3
			}
			modifier = {
				trait = paranoid
    			factor = 0.1
			}
			modifier = {
				trait = craven
    			factor = 0.1
			}
		}
	}

}
#########################################################################################################
################ Secret society title decisions
#########################################################################################################
title_decisions = {
	secret_religions_prepare_grounds = {
		only_playable = yes
		
		ai_target_filter = realm_owned
		filter = realm_owned
		
		from_potential = {
			society_rank > 2
			OR = {
				society_member_of = secret_religious_society_catholic
				society_member_of = secret_religious_society_orthodox
				society_member_of = secret_religious_society_sunni
				society_member_of = secret_religious_society_shiite
				society_member_of = secret_religious_society_jewish
				society_member_of = secret_religious_society_zoroastrian
				society_member_of = secret_religious_society_hinduism
				society_member_of = secret_religious_society_buddhism
				society_member_of = secret_religious_society_jain
				society_member_of = secret_religious_society_norse_pagan_reformed
				society_member_of = secret_religious_society_slavic_pagan_reformed
				society_member_of = secret_religious_society_tengri_pagan_reformed
				society_member_of = secret_religious_society_baltic_pagan_reformed
				society_member_of = secret_religious_society_finnish_pagan_reformed
				society_member_of = secret_religious_society_west_african_pagan_reformed
				society_member_of = secret_religious_society_zun_pagan_reformed
			}
		}
		
		potential = {
			tier = COUNT
			holder_scope = {
				same_realm = FROM
			}
			OR = {
				AND = {
					FROM = {
						society_member_of = secret_religious_society_catholic
					}
					NOT = { location = { religion = catholic } }
					NOT = { location = { has_province_modifier = secret_catholic_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_orthodox
					}
					NOT = { location = { religion = orthodox } }
					NOT = { location = { has_province_modifier = secret_orthodox_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_sunni
					}
					NOT = { location = { religion = sunni } }
					NOT = { location = { has_province_modifier = secret_sunni_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_shiite
					}
					NOT = { location = { religion = shiite } }
					NOT = { location = { has_province_modifier = secret_shiite_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_jewish
					}
					NOT = { location = { religion = jewish } }
					NOT = { location = { has_province_modifier = secret_jewish_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_zoroastrian
					}
					NOT = { location = { religion = zoroastrian } }
					NOT = { location = { has_province_modifier = secret_zoroastrian_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_hinduism
					}
					NOT = { location = { religion = hindu } }
					NOT = { location = { has_province_modifier = secret_hinduism_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_buddhism
					}
					NOT = { location = { religion = buddhist } }
					NOT = { location = { has_province_modifier = secret_buddhism_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_jain
					}
					NOT = { location = { religion = jain } }
					NOT = { location = { has_province_modifier = secret_jain_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_norse_pagan_reformed
					}
					NOT = { location = { religion = norse_pagan_reformed } }
					NOT = { location = { has_province_modifier = secret_norse_pagan_reformed_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_slavic_pagan_reformed
					}
					NOT = { location = { religion = slavic_pagan_reformed } }
					NOT = { location = { has_province_modifier = secret_slavic_pagan_reformed_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_tengri_pagan_reformed
					}
					NOT = { location = { religion = tengri_pagan_reformed } }
					NOT = { location = { has_province_modifier = secret_tengri_pagan_reformed_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_baltic_pagan_reformed
					}
					NOT = { location = { religion = baltic_pagan_reformed } }
					NOT = { location = { has_province_modifier = secret_baltic_pagan_reformed_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_finnish_pagan_reformed
					}
					NOT = { location = { religion = finnish_pagan_reformed } }
					NOT = { location = { has_province_modifier = secret_finnish_pagan_reformed_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_west_african_pagan_reformed
					}
					NOT = { location = { religion = west_african_pagan_reformed } }
					NOT = { location = { has_province_modifier = secret_west_african_pagan_reformed_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_zun_pagan_reformed
					}
					NOT = { location = { religion = zun_pagan_reformed } }
					NOT = { location = { has_province_modifier = secret_zun_pagan_reformed_community } }
				}
			}
		}
		
		allow = {
			FROM = {
				has_society_currency_medium_trigger = yes
			}
		}
		
		effect = {
			location = {
				save_event_target_as = target_province
			}
			FROM = {
				society = {
					save_event_target_as = original_society
				}
				detract_society_currency_medium_effect = yes
				custom_tooltip = {
					text = secret_religions_prepare_grounds_effect_tooltip
					character_event = { id = MNM.3850 days = 2 }
				}
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
			}
		}
	}
}