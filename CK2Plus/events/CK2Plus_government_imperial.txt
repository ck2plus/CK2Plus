namespace = Plus

#reserved: Plus.3300 to Plus.3399

#######################################
# MORE IMPERIAL EVENTS
# Written by Rylock
#######################################

# Relative wants to go to the imperial capital to serve
character_event = {
	id = Plus.3300

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	min_age = 16
	max_age = 40
	only_capable = yes
	prisoner = no
	ai = yes

	trigger = {
		is_ruler = no
		is_close_relative = liege
		religion = liege
		religion = top_liege

		liege = {
			higher_real_tier_than = COUNT
			is_feudal = yes
			has_regent = no
			war = no
		}

		top_liege = {
			real_tier = EMPEROR
			is_feudal = yes
			free_court_slots > 0
			war = no
		}

		trigger_if = {
			limit = { is_female = yes }

			liege = {
				OR = {
					has_law = true_cognatic_succession
					has_law = enatic_cognatic_succession
					has_law = enatic_succession
				}
			}

			top_liege = {
				OR = {
					has_law = true_cognatic_succession
					has_law = enatic_cognatic_succession
					has_law = enatic_succession
				}
			}
		}

		OR = {
			trait = ambitious
			trait = diligent
			trait = proud
			martial >= 8
			diplomacy >= 8
			stewardship >= 8
			intrigue >= 8
		}

		is_ill = no
		is_voter = no
		in_command_trigger = no
		is_inaccessible_trigger = no

		NOR = {
			vassal_of = top_liege
			trait = slothful
			trait = content
			trait = stressed
			trait = depressed
			trait = monk
			trait = nun
			trait = desert_mother
			trait = desert_father

			any_spouse = {
				trait = pregnant
				father_of_unborn = { character = ROOT }
			}

			any_child = {
				is_adult = no
				has_inheritance_blocker = no
			}

			any_liege = { holy_order = yes }
			any_liege = { mercenary = yes }
			has_minor_title = title_appointed_regent
			has_minor_title = title_commander
			has_character_modifier = planning_claimant_adventure
			has_character_modifier = planning_new_temple
			has_character_flag = serving_tirnanog
			has_character_flag = serving_gwydion
			has_character_flag = serving_varangian
			has_character_flag = served_empire
			has_character_flag = serving_empire
			has_character_flag = denied_serving_empire
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 2
			top_liege = { has_imperial_government_trigger = yes }
		}

		mult_modifier = {
			factor = 1.33

			OR = {
				martial >= 12
				diplomacy >= 12
				stewardship >= 12
				intrigue >= 12
			}
		}

		mult_modifier = {
			factor = 2
			trait = ambitious
		}

		mult_modifier = {
			factor = 2
			trait = diligent
		}

		mult_modifier = {
			factor = 2

			OR = {
				trait = administrator
				trait = socializer
				trait = master_schemer
			}
		}

		mult_modifier = {
			factor = 2
			NOT = { any_heir_title = { always = yes } }
		}

		mult_modifier = {
			factor = 0.67
			trait = humble
		}

		mult_modifier = {
			factor = 0.67
			trait = shy
		}

		mult_modifier = {
			factor = 0.67
			any_heir_title = { always = yes }
		}
	}

	immediate = {
		liege = { character_event = { id = Plus.3301 } }
	}
}

# Liege is asked to let them go to the capital
character_event = {
	id = Plus.3301
	desc = EVTDESC_Plus_3301
	picture = GFX_evt_emissary

	is_triggered_only = yes

	option = {
		name = EVTOPTA_Plus_3301 # Refuse

		FROM = {
			show_scope_change = no

			prestige = -50
			set_character_flag = denied_serving_empire

			opinion = {
				name = opinion_very_disappointed
				years = 10
				who = ROOT
			}
		}

		ai_chance = {
			factor = 25

			mult_modifier = {
				factor = 3
				trait = cruel
			}

			mult_modifier = {
				factor = 3
				trait = paranoid
			}

			mult_modifier = {
				factor = 2
				trait = slothful
			}

			mult_modifier = {
				factor = 0.5
				trait = diligent
			}

			mult_modifier = {
				factor = 0.5
				trait = kind
			}

			mult_modifier = {
				factor = 0.5
				trait = trusting
			}

			mult_modifier = {
				factor = 3
				current_heir = { character = FROM }
			}

			mult_modifier = {
				factor = 2
				FROM = { is_female = yes }
			}

			mult_modifier = {
				factor = 0.5
				FROM = { is_married = no }
			}

			mult_modifier = {
				factor = 1.5
				FROM = { is_married = yes }
			}

			mult_modifier = {
				factor = 1.5
				FROM = {
					any_child = {
						has_inheritance_blocker = no
					}
				}
			}

			mult_modifier = {
				factor = 0.5
				top_liege = { has_imperial_government_trigger = yes }
			}
		}
	}

	option = {
		name = EVTOPTB_Plus_3301 # Permit it

		FROM = {
			show_scope_change = no

			prestige = 50
			set_character_flag = serving_empire

			opinion = {
				name = allowed_to_serve_empire
				years = 100
				who = ROOT
			}


			move_character = top_liege
		}

		ai_chance = { factor = 75 }
	}
}

# Relative remains where they are
character_event = {
	id = Plus.3302

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		is_ruler = no
		liege = { real_tier = EMPEROR }

		OR = {
			is_voter = yes
			has_minor_title = title_appointed_regent
			has_minor_title = title_commander
		}

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			letter_event = { id = Plus.3303 }
		}
	}
}

# Inform liege
letter_event = {
	id = Plus.3303
	desc = EVTDESC_Plus_3303

	is_triggered_only = yes

	ai = no

	option = {
		name = SO_BE_IT
	}
}

# Relative has become a ruler
character_event = {
	id = Plus.3304

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	only_rulers = yes
	min_age = 16
	prisoner = no

	trigger = {
		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire
	}
}

# Relative has become incapable
character_event = {
	id = Plus.3305

	is_triggered_only = yes
	hide_window = yes

	has_character_flag = serving_empire
	min_age = 16
	prisoner = no

	trigger = {
		trait = incapable
		is_ruler = no

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3306 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3306
	desc = EVTDESC_Plus_3306
	picture = GFX_evt_emissary

	is_triggered_only = yes

	option = {
		name = I_SEE

		return_home_effect = yes
	}
}

# Relative returns - increased education
character_event = {
	id = Plus.3307

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		is_ruler = no
		has_top_tier_education_trait_trigger = no

		trigger_if = {
			limit = { liege = { real_tier = EMPEROR } }

			is_voter = no

			NOR = {
				has_minor_title = title_appointed_regent
				has_minor_title = title_commander
			}
		}

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 2
			is_smart_trigger = yes
		}

		mult_modifier = {
			factor = 0.5
			is_dumb_trigger = yes
		}

		mult_modifier = {
			factor = 1.33
			trait = diligent
		}

		mult_modifier = {
			factor = 0.8
			trait = slothful
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3308 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3308
	desc = EVTDESC_Plus_3308
	picture = GFX_evt_emissary

	is_triggered_only = yes

	option = {
		name = EXCELLENT

		FROM = {
			show_scope_change = no

			upgrade_education_effect = yes
		}

		return_home_effect = yes
	}
}

# Relative returns = increased stat
character_event = {
	id = Plus.3309

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		is_ruler = no

		trigger_if = {
			limit = { liege = { real_tier = EMPEROR } }

			is_voter = no

			NOR = {
				has_minor_title = title_appointed_regent
				has_minor_title = title_commander
			}
		}

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 2
			is_smart_trigger = yes
		}

		mult_modifier = {
			factor = 0.5
			is_dumb_trigger = yes
		}

		mult_modifier = {
			factor = 1.33
			trait = diligent
		}

		mult_modifier = {
			factor = 0.8
			trait = slothful
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3310 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3310
	desc = EVTDESC_Plus_3308
	picture = GFX_evt_emissary

	is_triggered_only = yes

	option = {
		name = EXCELLENT

		FROM = {
			show_scope_change = no

			if = {
				limit = { has_education_diplomacy_trigger = yes }
				change_diplomacy = 2
			}
			else_if = {
				limit = { has_education_martial_trigger = yes }
				change_martial = 2
			}
			else_if = {
				limit = { has_education_stewardship_trigger = yes }
				change_stewardship = 2
			}
			else_if = {
				limit = { has_education_intrigue_trigger = yes }
				change_intrigue = 2
			}
			else_if = {
				limit = { has_education_learning_trigger = yes }
				change_learning = 2
			}
		}

		return_home_effect = yes
	}
}

# Relative returns with a lifestyle trait
character_event = {
	id = Plus.3311

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		lifestyle_traits < 1
		is_ruler = no

		trigger_if = {
			limit = { liege = { real_tier = EMPEROR } }

			is_voter = no

			NOR = {
				has_minor_title = title_appointed_regent
				has_minor_title = title_commander
			}
		}

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 1.33
			trait = diligent
		}

		mult_modifier = {
			factor = 0.8
			trait = slothful
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3312 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3312
	desc = EVTDESC_Plus_3308
	picture = GFX_evt_emissary

	is_triggered_only = yes

	option = {
		name = EXCELLENT

		FROM = {
			show_scope_change = no

			if = {
				limit = { has_education_diplomacy_trigger = yes }
				add_trait = socializer
			}
			else_if = {
				limit = { has_education_martial_trigger = yes }
				add_trait = duelist
			}
			else_if = {
				limit = { has_education_stewardship_trigger = yes }
				add_trait = administrator
			}
			else_if = {
				limit = { has_education_intrigue_trigger = yes }
				add_trait = master_schemer
			}
			else_if = {
				limit = { has_education_learning_trigger = yes }
				add_trait = theologian
			}
		}

		return_home_effect = yes
	}
}

# Relative returns with a wife
character_event = {
	id = Plus.3313

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	only_men = yes
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		can_marry = yes
		NOT = { trait = homosexual }
		is_ruler = no

		trigger_if = {
			limit = { liege = { real_tier = EMPEROR } }

			is_voter = no

			NOR = {
				has_minor_title = title_appointed_regent
				has_minor_title = title_commander
			}
		}

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3314 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3314
	desc = EVTDESC_Plus_3314
	picture = GFX_evt_emissary

	is_triggered_only = yes

	immediate = {
		top_liege = {
			create_character = {
				random_traits = yes
				culture = THIS
				religion = THIS
				female = yes
				age = 17
			}
		}
	}

	option = {
		name = I_SEE

		FROM = {
			show_scope_change = no
			add_spouse = new_character
		}

		return_home_effect = yes
	}
}

# Relative returns with a bastard child
character_event = {
	id = Plus.3315

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	only_men = yes
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		is_married = no
		is_ruler = no
		fertility >= 0.25
		NOT = { trait = homosexual }

		trigger_if = {
			limit = { liege = { real_tier = EMPEROR } }

			is_voter = no

			NOR = {
				has_minor_title = title_appointed_regent
				has_minor_title = title_commander
			}
		}

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3316 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3316
	picture = GFX_evt_emissary

	desc = {
		text = EVTDESC_Plus_3316_male
		trigger = { FROM = { is_female = no } }
	}
	desc = {
		text = EVTDESC_Plus_3316_female
		trigger = { FROM = { is_female = yes } }
	}

	is_triggered_only = yes

	immediate = {
		create_character = {
			age = 0
			female = no
			trait = bastard
			culture = FROM
			religion = FROM
		}

		new_character = {
			if = {
				limit = { FROM = { is_female = no } }
				set_father = FROM
			}
			else = {
				set_mother = FROM
			}
		}
	}

	option = {
		name = I_SEE

		hidden_effect = {
			recalc_succession = yes
		}

		return_home_effect = yes
	}
}

# Relative returns depressed
character_event = {
	id = Plus.3317

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		trigger_if = {
			limit = { liege = { real_tier = EMPEROR } }

			is_voter = no

			NOR = {
				has_minor_title = title_appointed_regent
				has_minor_title = title_commander
			}
		}

		is_ruler = no
		NOT = { trait = depressed }

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 0.8
			trait = diligent
		}

		mult_modifier = {
			factor = 1.33
			trait = slothful
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3318 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3318
	desc = EVTDESC_Plus_3318
	picture = GFX_evt_emissary

	is_triggered_only = yes

	option = {
		name = I_SEE

		FROM = {
			show_scope_change = no

			add_trait = depressed
		}

		return_home_effect = yes
	}
}

# Relative returns a drunkard
character_event = {
	id = Plus.3319

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		trigger_if = {
			limit = { liege = { real_tier = EMPEROR } }

			is_voter = no

			NOR = {
				has_minor_title = title_appointed_regent
				has_minor_title = title_commander
			}
		}

		NOR = {
			trait = drunkard
			trait = temperate
		}

		is_ruler = no

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 1.33
			trait = gluttonous
		}

		mult_modifier = {
			factor = 1.33
			trait = gregarious
		}

		mult_modifier = {
			factor = 0.67
			trait = shy
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3320 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3320
	desc = EVTDESC_Plus_3320
	picture = GFX_evt_emissary

	is_triggered_only = yes

	option = {
		name = I_SEE

		FROM = {
			show_scope_change = no

			add_trait = drunkard
		}

		return_home_effect = yes
	}
}

# Relative returns more diligent
character_event = {
	id = Plus.3321

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		trigger_if = {
			limit = { liege = { real_tier = EMPEROR } }

			is_voter = no

			NOR = {
				has_minor_title = title_appointed_regent
				has_minor_title = title_commander
			}
		}

		NOR = {
			trait = diligent
			trait = slothful
		}

		is_ruler = no

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3322 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3322
	desc = EVTDESC_Plus_3322
	picture = GFX_evt_emissary

	is_triggered_only = yes

	option = {
		name = EXCELLENT

		FROM = {
			show_scope_change = no

			add_trait = diligent
		}

		return_home_effect = yes
	}
}

# Relative returns slothful
character_event = {
	id = Plus.3323

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		trigger_if = {
			limit = { liege = { real_tier = EMPEROR } }

			is_voter = no

			NOR = {
				has_minor_title = title_appointed_regent
				has_minor_title = title_commander
			}
		}

		NOR = {
			trait = diligent
			trait = slothful
		}

		is_ruler = no

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3324 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3324
	desc = EVTDESC_Plus_3324
	picture = GFX_evt_emissary

	is_triggered_only = yes

	option = {
		name = I_SEE

		FROM = {
			show_scope_change = no

			add_trait = slothful
		}

		return_home_effect = yes
	}
}

# Relative returns a zealot
character_event = {
	id = Plus.3325

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		NOR = {
			trait = zealous
			trait = cynical
		}

		trigger_if = {
			limit = { liege = { real_tier = EMPEROR } }

			is_voter = no

			NOR = {
				has_minor_title = title_appointed_regent
				has_minor_title = title_commander
			}
		}

		is_ruler = no

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3326 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3326
	desc = EVTDESC_Plus_3326
	picture = GFX_evt_emissary

	is_triggered_only = yes

	option = {
		name = I_SEE

		FROM = {
			show_scope_change = no

			add_trait = zealous
		}

		return_home_effect = yes
	}
}

# Relative returns a cynic
character_event = {
	id = Plus.3327

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = serving_empire
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		NOR = {
			trait = zealous
			trait = cynical
		}

		trigger_if = {
			limit = { liege = { real_tier = EMPEROR } }

			is_voter = no

			NOR = {
				has_minor_title = title_appointed_regent
				has_minor_title = title_commander
			}
		}

		is_ruler = no

		had_character_flag = {
			flag = serving_empire
			years >= 4
		}
	}

	immediate = {
		clr_character_flag = serving_empire
		set_character_flag = served_empire

		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			character_event = { id = Plus.3328 }
		}
	}
}

# Inform liege
character_event = {
	id = Plus.3328
	desc = EVTDESC_Plus_3328
	picture = GFX_evt_emissary

	is_triggered_only = yes

	option = {
		name = I_SEE

		FROM = {
			show_scope_change = no

			add_trait = cynical
		}

		return_home_effect = yes
	}
}

# Ruler dies while a relative is away at the capital
character_event = {
	id = Plus.3329

	is_triggered_only = yes # on_death
	hide_window = yes

	trigger = {
		any_close_relative = {
			has_character_flag = serving_empire

			has_opinion_modifier = {
				name = allowed_to_serve_empire
				who = ROOT
			}
		}
	}

	immediate = {
		any_close_relative = {
			limit = {
				has_character_flag = serving_empire

				has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			clr_character_flag = serving_empire

			if = {
				limit = {
					prisoner = no
					is_ruler = no

					trigger_if = {
						limit = { liege = { real_tier = EMPEROR } }

						is_voter = no

						NOR = {
							has_minor_title = title_appointed_regent
							has_minor_title = title_commander
						}
					}
				}

				move_character = ROOT
			}
		}
	}
}

# Ruler is unlanded while a relative is away at the capital
character_event = {
	id = Plus.3330

	is_triggered_only = yes # on_unlanded
	hide_window = yes

	trigger = {
		any_close_relative = {
			has_character_flag = serving_empire

			has_opinion_modifier = {
				name = allowed_to_serve_empire
				who = ROOT
			}
		}
	}

	immediate = {
		any_close_relative = {
			limit = {
				has_character_flag = serving_empire

				has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			clr_character_flag = serving_empire

			remove_opinion = {
				name = allowed_to_serve_empire
				who = ROOT
			}

			if = {
				limit = {
					prisoner = no
					is_ruler = no

					trigger_if = {
						limit = { liege = { real_tier = EMPEROR } }

						is_voter = no

						NOR = {
							has_minor_title = title_appointed_regent
							has_minor_title = title_commander
						}
					}
				}

				random_dynasty_member = {
					limit = { is_ruler = yes }
					preferred_limit = { higher_real_tier_than = COUNT }
					reverse_banish = PREV
				}
			}
		}
	}
}

# Relative's liege is no longer the emperor
# TODO: Use on_new_holder?
character_event = {
	id = Plus.3331

	is_triggered_only = yes # on_yearly_pulse
	hide_window = yes

	has_character_flag = serving_empire
	only_men = yes
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		is_ruler = no
		is_voter = no
		liege = { lower_real_tier_than = EMPEROR }
	}

	immediate = {
		# Find original liege
		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					name = allowed_to_serve_empire
					who = ROOT
				}
			}

			save_event_target_as = original_liege
		}

		# Move the relative to the new emperor, if they're not their original liege
		if = {
			limit = {
				top_liege = {
					real_tier = EMPEROR
					same_realm = event_target:original_liege
					NOT = { character = event_target:original_liege }
				}
			}

			move_character = top_liege
		}
		else = {
			# Otherwise, return home immediately
			clr_character_flag = serving_empire
			move_character = event_target:original_liege
		}
	}
}

### IMPERIAL COUP EVENTS

# Opportunity to begin coup arises
character_event = {
	id = Plus.3340
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue

	desc = {
		text = EVTDESC_Plus_3340_low_home
		trigger = { has_character_flag = chance_low_home }
	}
	desc = {
		text = EVTDESC_Plus_3340_med_home
		trigger = { has_character_flag = chance_med_home }
	}
	desc = {
		text = EVTDESC_Plus_3340_high_home
		trigger = { has_character_flag = chance_high_home }
	}
	desc = {
		text = EVTDESC_Plus_3340_low_not_home
		trigger = { has_character_flag = chance_low_not_home }
	}
	desc = {
		text = EVTDESC_Plus_3340_med_not_home
		trigger = { has_character_flag = chance_med_not_home }
	}
	desc = {
		text = EVTDESC_Plus_3340_high_not_home
		trigger = { has_character_flag = chance_high_not_home }
	}

	is_part_of_plot = yes
	min_age = 16
	only_capable = yes
	prisoner = no

	trigger = {
		has_plot = plot_overthrow_empire
		num_of_plot_backers >= 1
		plot_power >= 0.75
		is_plot_active = no

		plot_target_char = {
			real_tier = EMPEROR
			is_liege_of = ROOT
			has_imperial_government_trigger = yes
		}
	}

	mean_time_to_happen = {
		months = 200

		mult_modifier = {
			factor = 0.75
			has_character_modifier = plot_assisted_spying
		}

		mult_modifier = {
			factor = 0.60
			has_character_modifier = plot_assisted_spying2
		}

		mult_modifier = {
			factor = 0.45
			has_character_modifier = plot_assisted_spying3
		}

		mult_modifier = {
			factor = 0.30
			has_character_modifier = plot_assisted_spying4
		}

		mult_modifier = {
			factor = 0.15
			has_character_modifier = plot_assisted_spying5
		}

		mult_modifier = {
			factor = 1.2
			plot_target_char = { check_variable = { which = personal_spy_network value >= 10 } }
		}

		mult_modifier = {
			factor = 1.2
			plot_target_char = { check_variable = { which = personal_spy_network value >= 20 } }
		}

		mult_modifier = {
			factor = 1.2
			plot_target_char = { check_variable = { which = personal_spy_network value >= 30 } }
		}

		mult_modifier = {
			factor = 1.2
			plot_target_char = { check_variable = { which = personal_spy_network value >= 40 } }
		}

		mult_modifier = {
			factor = 1.2
			plot_target_char = { check_variable = { which = personal_spy_network value >= 50 } }
		}

		mult_modifier = {
			factor = 0.75

			plot_target_char = {
				NOT = { at_location = capital_scope }
			}
		}

		mult_modifier = {
			factor = 0.5
			trait = genius
		}

		mult_modifier = {
			factor = 0.75

			OR = {
				trait = quick
				trait = shrewd
			}
		}

		mult_modifier = {
			factor = 0.75
			plot_target_char = { trait = trusting }
		}

		mult_modifier = {
			factor = 1.25
			plot_target_char = { trait = paranoid }
		}

		mult_modifier = {
			factor = 0.75

			plot_target_char = {
				OR = {
					is_ill = yes
					trait = infirm
					is_dumb_trigger = yes
				}
			}
		}

		mult_modifier = {
			factor = 0.75
			plot_power >= 1.0
		}

		mult_modifier = {
			factor = 0.75
			plot_power >= 1.25
		}

		mult_modifier = {
			factor = 0.75
			plot_power >= 1.50
		}

		mult_modifier = {
			factor = 0.75
			plot_power >= 1.75
		}

		mult_modifier = {
			factor = 0.75
			plot_power >= 2.0
		}
	}

	immediate = {
		clr_character_flag = lost_plotter
		clr_character_flag = chance_low_home
		clr_character_flag = chance_med_home
		clr_character_flag = chance_high_home
		clr_character_flag = chance_low_not_home
		clr_character_flag = chance_med_not_home
		clr_character_flag = chance_high_not_home
		clr_character_flag = killed_during_coup
		clr_character_flag = captured_during_coup
		clr_character_flag = coup_succeeds

		if = {
			limit = {
				plot_target_char = {
					has_character_modifier = away_from_court
				}
			}

			if = {
				limit = { plot_power >= 2.0 }
				set_character_flag = chance_high_not_home
			}
			else_if = {
				limit = { plot_power >= 1.0 }
				set_character_flag = chance_med_not_home
			}
			else = {
				set_character_flag = chance_low_not_home
			}
		}
		else = {
			if = {
				limit = { plot_power >= 2.0 }
				set_character_flag = chance_high_home
			}
			else_if = {
				limit = { plot_power >= 1.0 }
				set_character_flag = chance_med_home
			}
			else = {
				set_character_flag = chance_low_home
			}
		}
	}

	option = {
		name = EVTOPTA_Plus_3340 # Get ready

		activate_plot = yes

		custom_tooltip = {
			text = TELL_PLOTTERS_GET_READY

			# Notify backers
			any_plot_backer = { character_event = { id = Plus.3341 } }

			# Double-check
			character_event = {
				id = Plus.3344
				days = 7
			}
		}

		ai_chance = {
			factor = 50

			trigger = { plot_power >= 1.0 }

			mult_modifier = {
				factor = 0.5
				plot_power < 1.5
			}

			mult_modifier = {
				factor = 0.5
				plot_target_char = { has_character_modifier = away_from_court }
			}

			mult_modifier = {
				factor = 3
				trait = lunatic
			}

			mult_modifier = {
				factor = 3
				trait = possessed
			}

			mult_modifier = {
				factor = 1.5
				trait = brave
			}

			mult_modifier = {
				factor = 1.5
				trait = wroth
			}
		}
	}

	option = {
		name = EVTOPTB_Plus_3340 # We should wait

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 2.0

				trait = craven
				plot_power < 2.0
			}

			mult_modifier = {
				factor = 1.5

				trait = patient
				plot_power < 1.5
			}
		}
	}
}

# Co-conspirators informed; remain or drop out?
character_event = {
	id = Plus.3341
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue

	desc = {
		text = EVTDESC_Plus_3341_low_home
		trigger = { FROM = { has_character_flag = chance_low_home } }
	}
	desc = {
		text = EVTDESC_Plus_3341_med_home
		trigger = { FROM = { has_character_flag = chance_med_home } }
	}
	desc = {
		text = EVTDESC_Plus_3341_high_home
		trigger = { FROM = { has_character_flag = chance_high_home } }
	}
	desc = {
		text = EVTDESC_Plus_3341_low_not_home
		trigger = { FROM = { has_character_flag = chance_low_not_home } }
	}
	desc = {
		text = EVTDESC_Plus_3341_med_not_home
		trigger = { FROM = { has_character_flag = chance_med_not_home } }
	}
	desc = {
		text = EVTDESC_Plus_3341_high_not_home
		trigger = { FROM = { has_character_flag = chance_high_not_home } }
	}

	is_triggered_only = yes

	only_capable = yes
	prisoner = no

	trigger = {
		FROM = {
			has_plot = plot_overthrow_empire

			plot_target_char = {
				real_tier = EMPEROR
				is_liege_of = ROOT
				has_imperial_government_trigger = yes
			}
		}
	}

	immediate = {
		clr_character_flag = informed_liege
	}

	option = {
		name = EVTOPTA_Plus_3341 # I'm still in

		ai_chance = {
			factor = 70

			trigger = {
				FROM = {
					plot_target_char = {
						reverse_opinion = {
							who = ROOT
							value < 40
						}

						NOR = {
							current_heir = { character = ROOT }

							AND = {
								is_married = ROOT
								ROOT = { is_ruler = no }
							}
						}
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTB_Plus_3341 # No, this is too risky

		tooltip = { leave_plot = FROM }


		FROM = {
			character_event = {
				id = Plus.3342
				days = 1
				random = 5
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 0.1

				is_ruler = yes
				is_voter = no
			}

			mult_modifier = {
				factor = 0.1

				OR = {
					trait = lunatic
					trait = possessed
				}
			}

			mult_modifier = {
				factor = 0.5
				trait = brave
			}

			mult_modifier = {
				factor = 2
				trait = craven
			}
		}
	}

	option = {
		name = EVTOPTC_Plus_3341 # Inform the liege
		tooltip_info = intrigue

		trigger = { intrigue >= 10 }

		tooltip = { leave_plot = FROM }

		FROM = {
			show_scope_change = no

			plot_target_char = {
				show_scope_change = no

				letter_event = {
					id = Plus.3343
					days = 5
					tooltip = INFORM_LIEGE_PLOT
				}
			}
		}

		random_list = {
			50 = {
				custom_tooltip = {
					text = PLOT_LEADER_FINDS_OUT

					set_character_flag = informed_liege

					FROM = {
						character_event = {
							id = Plus.3342
							days = 1
							random = 5
						}
					}
				}
			}

			50 = {
				custom_tooltip = { text = PLOT_LEADER_DOESNT_FIND_OUT }
			}
		}

		if = {
			limit = { trait = honest }
			remove_trait = honest
		}
		else_if = {
			limit = { NOT = { trait = deceitful } }

			random = {
				chance = 50
				add_trait_deceitful_effect = yes
			}
		}

		ai_chance = {
			factor = 5

			mult_modifier = {
				factor = 2
				trait = deceitful
			}

			mult_modifier = {
				factor = 2
				intrigue >= 14
			}

			mult_modifier = {
				factor = 2
				intrigue >= 16
			}

			mult_modifier = {
				factor = 2
				intrigue >= 18
			}

			mult_modifier = {
				factor = 2
				intrigue >= 20
			}

			mult_modifier = {
				factor = 0.01

				FROM = {
					plot_target_char = {
						reverse_opinion = {
							who = ROOT
							value < 25
						}
					}
				}
			}

			mult_modifier = {
				factor = 0.01

				OR = {
					trait = honest
					trait = craven
					is_close_relative = ROOT
					opinion = { who = FROM value >= 0 }
				}
			}

			mult_modifier = {
				factor = 0.01

				NOR = {
					trait = ambitious
					trait = deceitful
					FROM = { plot_target_char = { is_close_relative = ROOT } }
				}
			}
		}
	}
}

# Coup leader informed that co-conspirator has dropped out
character_event = {
	id = Plus.3342
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue

	desc = {
		text = EVTDESC_Plus_3342
		trigger = {
			FROM = { NOT = { has_character_flag = informed_liege } }
		}
	}
	desc = {
		text = EVTDESC_Plus_3342_informed
		trigger = {
			FROM = { has_character_flag = informed_liege }
		}
	}

	is_triggered_only = yes

	is_part_of_plot = yes
	only_capable = yes
	prisoner = no

	trigger = {
		has_plot = plot_overthrow_empire

		plot_target_char = {
			real_tier = EMPEROR
			is_liege_of = ROOT
			has_imperial_government_trigger = yes
		}
	}

	option = {
		name = CURSES

		set_character_flag = lost_plotter
		reverse_leave_plot = FROM

		if = {
			limit = { FROM = { has_character_flag = informed_liege } }

			opinion = {
				name = grievously_offended
				who = FROM
				years = 5
			}
		}
		else = {
			hidden_effect = {
				opinion = {
					name = grievously_offended
					who = FROM
					years = 5
				}
			}
		}

		hidden_effect = {
			reverse_opinion = {
				name = opinion_left_plot
				who = FROM
				years = 5
			}
		}
	}
}

# Ruler given advance notice of coup plan
letter_event = {
	id = Plus.3343
	desc = EVTDESC_Plus_3343
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	only_capable = yes
	prisoner = no

	option = {
		name = EVTOPTA_Plus_3343

		set_character_flag = on_guard_coup

		opinion = {
			name = opinion_very_grateful
			who = FROM
			years = 5
		}
	}
}

# Coup is ready to begin: proceed?
character_event = {
	id = Plus.3344
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue

	desc = {
		text = EVTDESC_Plus_3344_low
		trigger = {
			plot_power < 1.0
			NOT = { has_character_flag = lost_plotter }
		}
	}
	desc = {
		text = EVTDESC_Plus_3344_med
		trigger = {
			plot_power >= 1.0
			plot_power < 2.0
			NOT = { has_character_flag = lost_plotter }
		}
	}
	desc = {
		text = EVTDESC_Plus_3344_high
		trigger = {
			plot_power >= 2.0
			NOT = { has_character_flag = lost_plotter }
		}
	}
	desc = {
		text = EVTDESC_Plus_3344_low_lost
		trigger = {
			plot_power < 1.0
			has_character_flag = lost_plotter
		}
	}
	desc = {
		text = EVTDESC_Plus_3344_med_lost
		trigger = {
			plot_power >= 1.0
			plot_power < 2.0
			has_character_flag = lost_plotter
		}
	}
	desc = {
		text = EVTDESC_Plus_3344_high_lost
		trigger = {
			plot_power >= 2.0
			has_character_flag = lost_plotter
		}
	}

	is_triggered_only = yes

	is_part_of_plot = yes
	only_capable = yes
	prisoner = no

	trigger = {
		has_plot = plot_overthrow_empire

		plot_target_char = {
			real_tier = EMPEROR
			is_liege_of = ROOT
			has_imperial_government_trigger = yes
		}
	}

	option = {
		name = EVTOPTA_Plus_3344 # Begin!

		ai_chance = {
			factor = 70

			trigger = { plot_power >= 1.0 }

			mult_modifier = {
				factor = 2
				plot_power >= 1.5
			}
		}

		hidden_effect = {
			diplomatic_immunity = yes
			any_plot_backer = { diplomatic_immunity = yes }

			plot_target_char = {
				clr_character_flag = captured_during_coup
				clr_character_flag = killed_during_coup
				clr_character_flag = coup_not_in_capital
				save_event_target_as = coup_target

				if = {
					limit = { NOT = { has_character_modifier = away_from_court } }
					character_event = { id = Plus.3348 } # Notification of coup start
				}

				any_courtier = {
					limit = {
						prisoner = no

						OR = {
							in_command = no
							event_target:coup_target = { war = no }
						}

						NOT = {
							any_backed_character = {
								character = ROOT
							}
						}
					}

					character_event = { id = Plus.3348 } # Notification of coup start
				}
			}
		}

		random_list = {
			50 = {
				custom_tooltip = {
					text = COUP_SUCCESSFUL

					set_character_flag = coup_succeeds

					event_target:coup_target = {
						primary_title = { save_event_target_as = usurped_title }
						clr_character_flag = on_guard_coup

						if = {
							limit = { has_character_modifier = away_from_court }
							# Ruler is not in the capital during successful coup (days = 2)
							character_event = { id = Plus.3358 days = 2 }
						}
						else = {
							random = {
								chance = 50
								# Ruler is injured/maimed/killed/captured in successful coup (days = 2)
								character_event = { id = Plus.3359 days = 2 }
							}
						}
					}

					random = {
						chance = 25
						# Coup leader is injured/maimed in successful coup (days = 2)
						character_event = { id = Plus.3357 days = 2 }
					}

					# Notification of coup success
					narrative_event = { id = Plus.3361 days = 3 }
					character_event = { id = Plus.3362 days = 3 }
				}

				mult_modifier = {
					factor = 0.5
					plot_target_char = { has_character_flag = on_guard_coup }
				}

				mult_modifier = {
					factor = 1.5
					trait = genius
				}

				mult_modifier = {
					factor = 1.2

					OR = {
						trait = quick
						trait = shrewd
					}
				}

				mult_modifier = {
					factor = 0.5
					trait = imbecile
				}

				mult_modifier = {
					factor = 0.8

					OR = {
						trait = dull
						trait = slow
					}
				}

				mult_modifier = {
					factor = 1.1

					OR = {
						has_job_title = job_marshal
						any_plot_backer = { has_job_title = job_marshal }
					}
				}

				mult_modifier = {
					factor = 1.2

					OR = {
						has_job_title = job_spymaster
						any_plot_backer = { has_job_title = job_spymaster }
					}
				}

				mult_modifier = {
					factor = 0.9
					plot_power < 0.7
				}

				mult_modifier = {
					factor = 0.9
					plot_power < 0.8
				}

				mult_modifier = {
					factor = 0.9
					plot_power < 0.9
				}

				mult_modifier = {
					factor = 0.9
					plot_power < 1.0
				}

				mult_modifier = {
					factor = 0.9
					plot_power < 1.1
				}

				mult_modifier = {
					factor = 0.9
					plot_power < 1.2
				}

				mult_modifier = {
					factor = 0.9
					plot_power < 1.3
				}

				mult_modifier = {
					factor = 0.9
					plot_power < 1.4
				}

				mult_modifier = {
					factor = 0.9
					plot_power < 1.5
				}

				mult_modifier = {
					factor = 1.1
					plot_power >= 1.6
				}

				mult_modifier = {
					factor = 1.1
					plot_power >= 1.7
				}

				mult_modifier = {
					factor = 1.1
					plot_power >= 1.8
				}

				mult_modifier = {
					factor = 1.1
					plot_power >= 1.9
				}

				mult_modifier = {
					factor = 1.1
					plot_power >= 2.0
				}

				mult_modifier = {
					factor = 1.1
					plot_power >= 2.1
				}

				mult_modifier = {
					factor = 1.1
					plot_power >= 2.2
				}

				mult_modifier = {
					factor = 1.1
					plot_power >= 2.3
				}

				mult_modifier = {
					factor = 1.1
					plot_power >= 2.4
				}

				mult_modifier = {
					factor = 1.1
					plot_power >= 2.5
				}
			}

			50 = {
				mult_modifier = {
					factor = 1.5
					plot_target_char = { demesne_garrison_size >= 500 }
				}

				mult_modifier = {
					factor = 1.5
					plot_target_char = { trait = genius }
				}

				mult_modifier = {
					factor = 1.2

					plot_target_char = {
						OR = {
							trait = quick
							trait = shrewd
							trait = paranoid
						}
					}
				}

				mult_modifier = {
					factor = 0.5

					plot_target_char = {
						OR = {
							trait = imbecile
							is_incapable = no
							is_adult = no
						}
					}
				}

				mult_modifier = {
					factor = 0.8

					plot_target_char = {
						OR = {
							trait = dull
							trait = slow
							trait = trusting
						}
					}
				}

				mult_modifier = {
					factor = 0.8

					plot_target_char = {
						has_character_modifier = away_from_court
					}
				}

				custom_tooltip = {
					text = COUP_FAILS

					event_target:coup_target = {
						clr_character_flag = on_guard_coup

						if = {
							limit = { has_character_modifier = away_from_court }
							# Ruler is not in the capital during failed coup (days = 2)
							character_event = { id = Plus.3356 days = 2 }
						}
						else = {
							random = {
								chance = 25
								# Ruler is injured/maimed/killed in failed coup (days = 2)
								character_event = { id = Plus.3355 days = 2 }
							}
						}
					}

					random = {
						chance = 50
						# Coup leader is injured/maimed/killed/captured in failed coup (days = 2)
						character_event = { id = Plus.3354 days = 2 }
					}

					# Notification of coup failure
					narrative_event = { id = Plus.3360 days = 3 }
				}
			}
		}

		hidden_effect = {
			any_plot_backer = {
				limit = {
					OR = {
						is_voter = yes

						AND = {
							host = { character = event_target:coup_target }

							OR = {
								in_command = no
								event_target:coup_target = { war = no }
							}
						}
					}
				}

				character_event = {
					id = Plus.3346 # Assigning events during coup
					days = 1
				}
			}

			event_target:coup_target = {
				any_courtier = {
					limit = {
						prisoner = no

						OR = {
							in_command = no
							event_target:coup_target = { war = no }
						}

						NOT = {
							any_backed_character = {
								character = ROOT
							}
						}
					}

					character_event = {
						id = Plus.3347 # Assigning events during coup
						days = 1
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTB_Plus_3344 # Wait for a better time

		activate_plot = no

		hidden_effect = {
			plot_target_char = { clr_character_flag = on_guard_coup }

			any_plot_backer = {
				letter_event = { id = Plus.3345 }
			}
		}

		ai_chance = { factor = 30 }
	}

	option = {
		name = EVTOPTC_Plus_3344 # Scrap all plans

		cancel_plot = yes

		hidden_effect = {
			plot_target_char = { clr_character_flag = on_guard_coup }
		}

		ai_chance = { factor = 0 }
	}
}

# Plot leader has called off the coup
letter_event = {
	id = Plus.3345
	desc = EVTDESC_Plus_3345
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	ai = no

	option = {
		name = I_SEE
	}
}

# Bounce event (for assigning results to co-conspirators)
character_event = {
	id = Plus.3346

	is_triggered_only = yes
	hide_window = yes

	immediate = {
		random_list = {
			20 = {
				mult_modifier = {
					factor = 0.5
					FROM = { has_character_flag = coup_succeeds }
				}

				# Co-conspirator injured/maimed/killed during coup
				character_event = { id = Plus.3349 }
			}

			20 = {
				trigger = {
					FROM = {
						NOT = { has_character_flag = coup_succeeds }
					}

					event_target:coup_target = {
						NOT = { has_character_modifier = away_from_court }
					}
				}

				# Co-conspirator comes to ruler's attention in failed coup
				character_event = { id = Plus.3353 }
			}

			3 = {
				trigger = {
					is_adult = yes
					is_female = no
					is_incapable = no
					is_inaccessible_trigger = no
					martial >= 10
					NOT = { trait = infirm }
				}

				# Co-conspirator saves the coup leader's life
				character_event = { id = Plus.3351 }
			}

			40 = { } # Nothing
		}
	}
}

# Bounce event (for assigning results to courtiers)
character_event = {
	id = Plus.3347

	is_triggered_only = yes
	hide_window = yes

	immediate = {
		random_list = {
			20 = {
				mult_modifier = {
					factor = 0.5
					FROM = { has_character_flag = coup_succeeds }
				}

				# Courtier injured/maimed/killed during coup
				character_event = { id = Plus.3350 }
			}

			3 = {
				trigger = {
					event_target:coup_target = {
						NOT = { has_character_modifier = away_from_court }
					}

					is_adult = yes
					is_female = no
					is_inaccessible_trigger = no
					is_incapable = no
					martial >= 10
					NOT = { trait = infirm }
				}

				# Courtier saves the ruler's life
				character_event = { id = Plus.3352 }
			}

			40 = { } # Nothing
		}
	}
}

# Notification to ruler & courtiers that coup has begun
character_event = {
	id = Plus.3348
	desc = EVTDESC_Plus_3348
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	ai = no

	option = {
		name = EVTOPTA_Plus_3348
	}
}

# Co-conspirator injured/maimed/killed during coup
character_event = {
	id = Plus.3349
	desc = EVTDESC_Plus_3349
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	only_capable = yes
	prisoner = no

	option = {
		name = EVTOPTA_Plus_3349

		random_list = {
			20 = {
				trigger  = {
					is_maimed_trigger = no
					NOT = { trait = wounded }
				}

				add_trait_wounded_effect = yes
			}

			10 = {
				trigger = { is_maimed_trigger = no }
				add_maimed_trait_effect = yes
			}

			5 = {
				death = { death_reason = death_battle } # TODO: Add 'failed coup' death reason?
			}
		}
	}
}

# Courtier injured/maimed/killed during coup
character_event = {
	id = Plus.3350
	desc = EVTDESC_Plus_3350
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	only_capable = yes
	prisoner = no

	option = {
		name = EVTOPTA_Plus_3350

		random_list = {
			20 = {
				trigger = {
					is_maimed_trigger = no
					NOT = { trait = wounded }
				}

				add_trait_wounded_effect = yes
			}

			10 = {
				trigger = { is_maimed_trigger = yes }
				add_maimed_trait_effect = yes
			}

			5 = {
				death = { death_reason = death_battle }
			}
		}
	}
}

# Co-conspirator saves the coup leader's life
character_event = {
	id = Plus.3351
	desc = EVTDESC_Plus_3351
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	major = yes

	only_capable = yes
	prisoner = no

	major_trigger = {
		OR = {
			character = FROM
			character = FROMFROM
		}
	}

	option = {
		name = EVTOPTA_Plus_3351

		trigger = { character = FROM }

		add_friend = FROMFROM
	}

	option = {
		name = EVTOPTB_Plus_3351

		trigger = { character = FROMFROM }

		tooltip = { add_friend = FROM }
	}
}

# Courtier saves the ruler's life
character_event = {
	id = Plus.3352
	desc = EVTDESC_Plus_3352
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	major = yes

	only_capable = yes
	prisoner = no

	major_trigger = {
		OR = {
			character = FROM
			character = event_target:coup_target
		}
	}

	option = {
		name = EVTOPTA_Plus_3351

		trigger = { character = FROM }

		add_friend = event_target:coup_target
	}

	option = {
		name = EVTOPTB_Plus_3351

		trigger = { character = event_target:coup_target }

		tooltip = { add_friend = FROM }
	}
}

# Co-conspirator comes to ruler's attention in failed coup
character_event = {
	id = Plus.3353
	desc = EVTDESC_Plus_3353
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	major = yes

	only_capable = yes
	prisoner = no

	major_trigger = {
		OR = {
			character = FROM
			character = event_target:coup_target
		}
	}

	option = {
		name = CURSES

		trigger = { character = FROM }

		tooltip = {
			reverse_opinion = {
				name = opinion_traitor
				who = event_target:coup_target
				years = 5
			}
		}
	}

	option = {
		name = EVTOPTB_Plus_3353

		trigger = { character = event_target:coup_target }

		opinion = {
			name = opinion_traitor
			who = FROM
			years = 5
		}
	}
}

# Coup leader is injured/maimed/killed/captured in failed coup
character_event = {
	id = Plus.3354
	desc = EVTDESC_Plus_3354
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	only_capable = yes
	prisoner = no

	option = {
		name = EVTOPTA_Plus_3354

		random_list = {
			10 = {
				custom_tooltip = {
					text = CAPTURED_DURING_COUP
					set_character_flag = captured_during_coup
				}
			}

			20 = {
				trigger = {
					is_maimed_trigger = no
					NOT = { trait = wounded }
				}

				custom_tooltip = {
					text = WOUNDED_MAYBE_CAPTURED

					add_trait_wounded_effect = yes

					random = {
						chance = 25
						set_character_flag = captured_during_coup
					}
				}
			}

			10 = {
				trigger = { is_maimed_trigger = yes }

				custom_tooltip = {
					text = MAIMED_MAYBE_CAPTURED

					add_maimed_trait_effect = yes

					random = {
						chance = 50
						set_character_flag = captured_during_coup
					}
				}
			}

			5 = {
				set_character_flag = killed_during_coup
				custom_tooltip = { text = DIES_DURING_COUP }
			}
		}
	}
}

# Ruler is injured/maimed/killed in failed coup
character_event = {
	id = Plus.3355
	desc = EVTDESC_Plus_3355
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	only_capable = yes
	prisoner = no

	option = {
		name = EVTOPTA_Plus_3355

		random_list = {
			40 = {
				trigger = {
					is_maimed_trigger = yes
					NOT = { trait = wounded }
				}

				add_trait_wounded_effect = yes
			}

			10 = {
				trigger = { is_maimed_trigger = yes }
				add_maimed_trait_effect = yes
			}

			5 = {
				custom_tooltip = {
					text = DIES_DURING_COUP
					set_character_flag = killed_during_coup
				}
			}
		}
	}
}

# Ruler is not in the capital during failed coup
character_event = {
	id = Plus.3356
	desc = EVTDESC_Plus_3356
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	only_capable = yes
	prisoner = no

	option = {
		name = EVTOPTA_Plus_3356

		set_character_flag = coup_not_in_capital
	}
}

# Coup leader is injured/maimed in successful coup
character_event = {
	id = Plus.3357
	desc = EVTDESC_Plus_3357
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	only_capable = yes
	prisoner = no

	trigger = {
		can_be_maimed_trigger = yes
	}

	option = {
		name = CURSES

		random_list = {
			20 = {
				trigger = {
					is_maimed_trigger = yes
					NOT = { trait = wounded }
				}

				add_trait_wounded_effect = yes
			}

			5 = {
				trigger = { is_maimed_trigger = yes }
				add_maimed_trait_effect = yes
			}
		}
	}
}

# Ruler is not in the capital during successful coup
character_event = {
	id = Plus.3358
	desc = EVTDESC_Plus_3358
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	only_capable = yes
	prisoner = no

	option = {
		name = EVTOPTA_Plus_3358

		set_character_flag = coup_not_in_capital
	}
}

# Ruler is injured/maimed/killed/captured in successful coup
character_event = {
	id = Plus.3359
	desc = EVTDESC_Plus_3359
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	only_capable = yes
	prisoner = no

	option = {
		name = EVTOPTA_Plus_3359

		random_list = {
			10 = {
				custom_tooltip = {
					text = CAPTURED_DURING_COUP
					set_character_flag = captured_during_coup
				}
			}

			20 = {
				trigger = {
					is_maimed_trigger = yes
					NOT = { trait = wounded }
				}

				custom_tooltip = {
					text = WOUNDED_MAYBE_CAPTURED

					add_trait_wounded_effect = yes

					random = {
						chance = 25
						set_character_flag = captured_during_coup
					}
				}
			}

			10 = {
				trigger = { is_maimed_trigger = yes }

				custom_tooltip = {
					text = MAIMED_MAYBE_CAPTURED

					add_maimed_trait_effect = yes

					random = {
						chance = 50
						set_character_flag = captured_during_coup
					}
				}
			}

			5 = {
				custom_tooltip = {
					text = DIES_DURING_COUP
					set_character_flag = killed_during_coup
				}
			}
		}
	}
}

# News of failed coup
narrative_event = {
	id = Plus.3360
	title = EVTNAME_Plus_3360
	picture = GFX_evt_siege
	border = GFX_event_narrative_frame_intrigue

	desc = {
		text = EVTDESC_Plus_3360_1
		trigger = {
			event_target:coup_target = { has_character_flag = coup_not_in_capital }
			ROOT = {
				NOR = {
					has_character_flag = captured_during_coup
					has_character_flag = killed_during_coup
				}
			}
		}
	}
	desc = {
		text = EVTDESC_Plus_3360_2
		trigger = {
			event_target:coup_target = { has_character_flag = coup_not_in_capital }
			ROOT = { has_character_flag = captured_during_coup }
		}
	}
	desc = {
		text = EVTDESC_Plus_3360_3
		trigger = {
			event_target:coup_target = { has_character_flag = coup_not_in_capital }
			ROOT = { has_character_flag = killed_during_coup }
		}
	}
	desc = {
		text = EVTDESC_Plus_3360_4
		trigger = {
			event_target:coup_target = {
				NOR = {
					has_character_flag = coup_not_in_capital
					has_character_flag = captured_during_coup
					has_character_flag = killed_during_coup
				}
			}

			ROOT = {
				NOR = {
					has_character_flag = captured_during_coup
					has_character_flag = killed_during_coup
				}
			}
		}
	}
	desc = {
		text = EVTDESC_Plus_3360_5
		trigger = {
			event_target:coup_target = {
				has_character_flag = killed_during_coup
				NOT = { has_character_flag = coup_not_in_capital }
			}
			ROOT = {
				NOR = {
					has_character_flag = captured_during_coup
					has_character_flag = killed_during_coup
				}
			}
		}
	}
	desc = {
		text = EVTDESC_Plus_3360_6
		trigger = {
			event_target:coup_target = {
				NOR = {
					has_character_flag = coup_not_in_capital
					has_character_flag = captured_during_coup
					has_character_flag = killed_during_coup
				}
			}
			ROOT = { has_character_flag = captured_during_coup }
		}
	}
	desc = {
		text = EVTDESC_Plus_3360_7
		trigger = {
			event_target:coup_target = {
				has_character_flag = killed_during_coup
				NOT = { has_character_flag = coup_not_in_capital }
			}
			ROOT = { has_character_flag = captured_during_coup }
		}
	}
	desc = {
		text = EVTDESC_Plus_3360_8
		trigger = {
			event_target:coup_target = {
				NOR = {
					has_character_flag = coup_not_in_capital
					has_character_flag = captured_during_coup
					has_character_flag = killed_during_coup
				}
			}
			ROOT = { has_character_flag = killed_during_coup }
		}
	}
	desc = {
		text = EVTDESC_Plus_3360_9
		trigger = {
			event_target:coup_target = {
				has_character_flag = killed_during_coup
				NOT = { has_character_flag = coup_not_in_capital }
			}
			ROOT = { has_character_flag = killed_during_coup }
		}
	}

	is_triggered_only = yes
	major = yes

	only_capable = yes
	prisoner = no

	major_trigger = {
		OR = {
			character = ROOT
			character = event_target:coup_target
			same_realm = event_target:coup_target
		}
	}

	option = {
		name = CURSES # Coup Leader

		trigger = { character = ROOT }

		prestige = -200

		if = {
			limit = { has_character_flag = captured_during_coup }
			imprison = event_target:coup_target
		}

		hidden_effect = {
			diplomatic_immunity = no
			any_plot_backer = { diplomatic_immunity = no }

			if = {
				limit = { event_target:coup_target = { has_character_flag = killed_during_coup } }

				event_target:coup_target = {
					save_event_target_as = target_victim

					current_heir = {
						if = {
							limit = { NOT = { character = ROOT } }

							opinion = {
								name = opinion_traitor
								who = ROOT
								years = 10
							}
						}
					}

					death = {
						death_reason = death_murder
						killer = ROOT
					}
				}

				character_event = { id = 10 } # Consequences of discovery
				clear_event_target = target_victim
			}
		}

		if = {
			limit = { has_character_flag = killed_during_coup }
			death = { death_reason = death_battle }
		}

		cancel_plot = yes
	}

	option = {
		name = EVTOPTB_Plus_3360 # Ruler

		trigger = { character = event_target:coup_target }

		prestige = 200
		imperial_decadence_minus_1_effect = yes

		opinion = {
			name = opinion_traitor
			who = ROOT
			years = 10
		}

		if = {
			limit = { has_character_flag = killed_during_coup }
			tooltip = { death = { death_reason = death_battle } }
		}
	}

	option = {
		name = I_SEE # Everyone else

		trigger = {
			NOR = {
				character = ROOT
				character = event_target:coup_target
			}
		}
	}
}

# News of successful coup
narrative_event = {
	id = Plus.3361
	title = EVTNAME_Plus_3361
	picture = GFX_evt_siege
	border = GFX_event_narrative_frame_intrigue

	desc = {
		text = EVTDESC_Plus_3361_1
		trigger = {
			event_target:coup_target = { has_character_flag = coup_not_in_capital }
		}
	}
	desc = {
		text = EVTDESC_Plus_3361_2
		trigger = {
			event_target:coup_target = {
				NOR = {
					has_character_flag = coup_not_in_capital
					has_character_flag = captured_during_coup
					has_character_flag = killed_during_coup
				}
			}
		}
	}
	desc = {
		text = EVTDESC_Plus_3361_3
		trigger = {
			event_target:coup_target = {
				has_character_flag = captured_during_coup
				NOT = { has_character_flag = coup_not_in_capital }
			}
		}
	}
	desc = {
		text = EVTDESC_Plus_3361_4
		trigger = {
			event_target:coup_target = {
				has_character_flag = killed_during_coup
				NOT = { has_character_flag = coup_not_in_capital }
			}
		}
	}

	is_triggered_only = yes
	major = yes

	only_capable = yes
	prisoner = no

	major_trigger = {
		OR = {
			character = ROOT
			character = event_target:coup_target
			same_realm = event_target:coup_target
		}
	}

	option = {
		name = EXCELLENT # Coup Leader

		trigger = { character = ROOT }

		prestige = 200

		tooltip = {
			usurp_title_plus_barony_if_unlanded = {
				target = event_target:usurped_title
				type = claim
			}
		}

		hidden_effect = {
			diplomatic_immunity = no
			any_plot_backer = { diplomatic_immunity = no }

			if = {
				limit = { event_target:coup_target = { has_character_flag = captured_during_coup } }
				reverse_imprison = event_target:coup_target
			}
		}

		plot_succeeds = yes
	}

	option = {
		name = EVTOPTB_Plus_3360 # Ruler

		trigger = { character = event_target:coup_target }

		tooltip = {
			usurp_title_plus_barony_if_unlanded = {
				target = event_target:usurped_title
				type = claim
			}
		}

		prestige = -500

		opinion = {
			name = opinion_traitor
			who = ROOT
			years = 10
		}

		if = {
			limit = { has_character_flag = captured_during_coup }
			tooltip = { imprison = ROOT }
		}
		else_if = {
			limit = { has_character_flag = killed_during_coup }
			tooltip = { death = { death_reason = death_battle } }
		}
	}

	option = {
		name = I_SEE # Everyone else

		trigger = {
			NOR = {
				character = ROOT
				character = event_target:coup_target
			}
		}
	}
}

# Usurpation event
character_event = {
	id = Plus.3362

	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:usurped_title = {
			set_global_flag = pf_teardown_lock

			# The claimant has the wrong government type, take care of that first.
			if = {
				limit = {
					higher_real_tier_than = ROOT

					holder_scope = {
						OR = {
							is_feudal = yes
							is_tribal = yes
						}
					}

					ROOT = {
						is_ruler = yes

						OR = {
							is_theocracy = yes
							is_republic = yes
						}
					}
				}

				ROOT = { abdicate = yes }
			}

			event_target:coup_target = {
				# Check to see if title will be destroyed
				any_demesne_title = {
					limit = { can_destroy_title_trigger = yes }

					custom_tooltip = {
						text = TITLE_ENDANGERED_NO_NAME
						set_title_flag = destroy_title
					}
				}

				# Reduce CA & TO
				any_demesne_title = {
					title_reduce_CA_effect = yes
					title_reduce_TO_effect = yes
				}

				# Ssurp primary title
				primary_title = {
					usurp_title_plus_barony_if_unlanded = {
						target = ROOT
						type = claim
					}

					make_primary_title = yes
				}

				# Ruler stays within the realm
				set_defacto_liege = ROOT
			}

			hidden_effect = {
				# Destroy primary title if it has been reduced too much
				if = {
					limit = { has_title_flag = destroy_title }

					ROOT = {
						character_event = {
							id = Plus.1620
							days = 4
						}
					}
				}

				# Check to see if the ruler needs to give the claimant a capital
				if = {
					limit = {
						event_target:coup_target = {
							ROOT = {
								primary_title = {
									NOR = {
										has_law = succ_feudal_elective
										has_law = succ_hre_elective
										has_law = succ_byzantine_elective
									}

									event_target:coup_target = {
										capital_scope = {
											de_jure_liege_or_above = PREVPREV
										}
									}
								}
							}

							OR = {
								num_of_count_titles >= 2
								higher_real_tier_than = COUNT
							}
						}
					}

					event_target:coup_target = {
						capital_scope = {
							county = {
								usurp_title_plus_barony_if_unlanded = {
									target = ROOT
									type = claim
								}
							}
						}
					}
				}

				# Set proper liege statuses
				event_target:coup_target = {
					set_defacto_liege = ROOT

					any_vassal = {
						limit = { NOT = { primary_title = { de_jure_liege_or_above = PREVPREV } } }
						set_defacto_liege = ROOT
					}
				}
			}

			clr_global_flag = pf_teardown_lock
		}

		# Actual death of the former ruler must follow the usurpation
		if = {
			limit = { event_target:coup_target = { has_character_flag = killed_during_coup } }

			event_target:coup_target = {
				save_event_target_as = target_victim

				current_heir = {
					if = {
						limit = { NOT = { character = ROOT } }

						opinion = {
							name = opinion_traitor
							who = ROOT
							years = 10
						}
					}
				}

				death = {
					death_reason = death_murder
					killer = ROOT
				}
			}

			character_event = { id = 10 } # Consequences of discovery
			clear_event_target = target_victim
		}
	}
}

### IMPERIAL COURT EVENTS

# Courtier gets a court trait
character_event = {
	id = Plus.3365

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	min_age = 20
	only_capable = yes
	prisoner = no
	ai = yes

	trigger = {
		is_ruler = no
		religion = liege
		is_dumb_trigger = no

		liege = {
			real_tier = EMPEROR
			is_feudal = yes
		}

		OR = {
			is_female = no
			liege = { has_law = status_of_women_4 }

			trigger_if = {
				limit = { can_be_chancellor_trigger = yes }

				OR = {
					trait = underhanded_rogue
					trait = charismatic_negotiator
					trait = grey_eminence
				}
			}

			trigger_if = {
				limit = { can_be_marshal_trigger = yes }

				OR = {
					trait = tough_soldier
					trait = skilled_tactician
					trait = brilliant_strategist
				}
			}

			trigger_if = {
				limit = { can_be_treasurer_trigger = yes }

				OR = {
					trait = thrifty_clerk
					trait = fortune_builder
					trait = midas_touched
				}
			}

			trigger_if = {
				limit = { can_be_spymaster_trigger = yes }

				OR = {
					trait = flamboyant_schemer
					trait = intricate_webweaver
					trait = elusive_shadow

				}
			}
		}

		NOR = {
			trait = amateurish_plotter
			trait = naive_appeaser
			trait = indulgent_wastrel
			trait = misguided_warrior
			trait = detached_priest
			trait = imperial_bureaucrat
			trait = imperial_courtier
			trait = imperial_guard
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 4
			has_character_flag = serving_empire
		}

		mult_modifier = {
			factor = 2

			OR = {
				is_councillor = yes
				has_minor_title = title_commander
				liege = { has_imperial_government_trigger = yes }
			}
		}

		mult_modifier = {
			factor = 2
			trait = genius
		}

		mult_modifier = {
			factor = 1.33

			OR = {
				trait = quick
				trait = shrewd
			}
		}

		mult_modifier = {
			factor = 1.33
			trait = diligent
		}

		mult_modifier = {
			factor = 0.67
			trait = slothful
		}

		mult_modifier = {
			factor = 0.67
			has_2nd_tier_education_trait_trigger = yes
		}

		mult_modifier = {
			factor = 0.67
			has_top_tier_education_trait_trigger = yes
		}
	}

	immediate = {
		if = {
			limit = {
				can_be_marshal_trigger = yes
				OR = {
					trait = tough_soldier
					trait = skilled_tactician
					trait = brilliant_strategist
				}
			}

			add_trait = imperial_guard
			set_character_flag = is_imperial_guard
		}
		else_if = {
			limit = {
				OR = {
					trait = thrifty_clerk
					trait = fortune_builder
					trait = midas_touched
					trait = dutiful_cleric
					trait = scholarly_theologian
					trait = mastermind_theologian
				}
			}

			add_trait = imperial_bureaucrat
			set_character_flag = is_imperial_bureaucrat
		}
		else = {
			add_trait = imperial_courtier
			set_character_flag = is_imperial_courtier
		}
	}
}

# Imperial Bureaucrat seeks employment in the empire
character_event = {
	id = Plus.3366

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = is_imperial_bureaucrat
	min_age = 20
	only_capable = yes
	prisoner = no
	ai = yes
	is_sick = no

	trigger = {
		can_be_treasurer_trigger = yes
		health >= 4
		stewardship >= 8
		is_ruler = no
		is_voter = no

		liege = {
			real_tier = EMPEROR
			is_feudal = yes
			num_of_courtiers >= 30
			NOT = { dynasty = ROOT }
			war = no
		}

		NOR = {
			trait = stressed
			trait = depressed
			has_minor_title = title_appointed_regent
			has_minor_title = title_commander
			has_character_flag = serving_empire
		}
	}

	immediate = {
		liege = {
			random_realm_lord = {
				limit = {
					higher_real_tier_than = COUNT
					religion = ROOT
					has_regent = no

					reverse_opinion = {
						who = ROOT
						value >= 0
					}

					NOR = {
						reverse_has_opinion_modifier = {
							name = opinion_disappointed
							who = ROOT
						}

						job_treasurer = {
							OR = {
								stewardship >= ROOT
								among_most_powerful_vassals = 4
							}
						}
					}
				}

				preferred_limit = {
					culture = ROOT
				}

				if = {
					limit = { ai = no }
					letter_event = { id = Plus.3369 }
				}
				else = {
					ROOT = {
						move_character = PREV
						clr_character_flag = is_imperial_bureaucrat
					}
				}
			}
		}
	}
}

# Imperial Courtier seeks employment in the empire
character_event = {
	id = Plus.3367

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	has_character_flag = is_imperial_courtier
	min_age = 20
	only_capable = yes
	prisoner = no
	ai = yes
	is_sick = no

	trigger = {
		trigger_if = {
			limit = { can_be_chancellor_trigger = yes }
			diplomacy >= 8
		}
		trigger_else = {
			can_be_spymaster_trigger = yes
			intrigue >= 8
		}

		health >= 4
		is_ruler = no
		is_voter = no

		liege = {
			real_tier = EMPEROR
			is_feudal = yes
			num_of_courtiers >= 30
			war = no
			NOT = { dynasty = ROOT }
		}

		NOR = {
			trait = stressed
			trait = depressed
			has_minor_title = title_appointed_regent
			has_minor_title = title_commander
			has_character_flag = serving_empire
		}
	}

	immediate = {
		if = {
			limit = { can_be_spymaster_trigger = yes }

			liege = {
				random_realm_lord = {
					limit = {
						higher_real_tier_than = COUNT
						religion = ROOT
						has_regent = no

						reverse_opinion = {
							who = ROOT
							value >= 0
						}

						NOR = {
							reverse_has_opinion_modifier = {
								name = opinion_disappointed
								who = ROOT
							}

							job_spymaster = {
								OR = {
									intrigue >= ROOT
									among_most_powerful_vassals = 4
								}
							}
						}
					}

					preferred_limit = {
						culture = ROOT
					}

					if = {
						limit = { ai = no }
						letter_event = { id = Plus.3369 }
					}
					else = {
						ROOT = {
							move_character = PREV
							clr_character_flag = is_imperial_courtier
						}
					}
				}
			}
		}
		else_if = {
			limit = { can_be_chancellor_trigger = yes }

			liege = {
				random_realm_lord = {
					limit = {
						higher_real_tier_than = COUNT
						religion = ROOT
						culture = ROOT
						has_regent = no

						reverse_opinion = {
							who = ROOT
							value >= 0
						}

						NOR = {
							reverse_has_opinion_modifier = {
								name = opinion_disappointed
								who = ROOT
							}

							job_chancellor = {
								OR = {
									diplomacy >= ROOT
									among_most_powerful_vassals = 4
								}
							}
						}
					}

					preferred_limit = {
						culture = ROOT
					}

					if = {
						limit = { ai = no }
						letter_event = { id = Plus.3369 }
					}
					else = {
						ROOT = {
							move_character = PREV
							clr_character_flag = is_imperial_courtier
						}
					}
				}
			}
		}
	}
}

# Imperial Guard seeks employment in the empire
character_event = {
	id = Plus.3368

	is_triggered_only = yes # on_yearly_pulse, random_events
	hide_window = yes

	min_age = 20
	only_capable = yes
	prisoner = no
	ai = yes
	has_character_flag = is_imperial_guard
	is_sick = no

	trigger = {
		can_be_marshal_trigger = yes
		martial >= 8
		health >= 4
		is_ruler = no
		is_voter = no

		liege = {
			real_tier = EMPEROR
			is_feudal = yes
			num_of_courtiers >= 30
			war = no
			NOT = { dynasty = ROOT }
		}

		NOR = {
			trait = stressed
			trait = depressed
			has_minor_title = title_appointed_regent
			has_minor_title = title_commander
			has_character_flag = serving_empire
		}
	}

	immediate = {
		liege = {
			random_realm_lord = {
				limit = {
					higher_real_tier_than = COUNT
					religion = ROOT
					has_regent = no

					reverse_opinion = {
						who = ROOT
						value >= 0
					}

					NOR = {
						reverse_has_opinion_modifier = {
							name = opinion_disappointed
							who = ROOT
						}

						job_marshal = {
							OR = {
								martial >= ROOT
								among_most_powerful_vassals = 4
							}
						}
					}
				}

				preferred_limit = {
					culture = ROOT
				}

				if = {
					limit = { ai = no }
					letter_event = { id = Plus.3369 }
				}
				else = {
					ROOT = {
						move_character = PREV
						clr_character_flag = is_imperial_guard
					}
				}
			}
		}
	}
}

# Letter of introduction to the new liege
letter_event = {
	id = Plus.3369
	desc = EVTDESC_Plus_3369

	is_triggered_only = yes

	option = {
		name = EVTOPTA_Plus_3369 # You are welcome

		FROM = {
			show_scope_change = no

			move_character = ROOT
			clr_character_flag = is_imperial_bureaucrat
			clr_character_flag = is_imperial_courtier
			clr_character_flag = is_imperial_guard
		}
	}

	option = {
		name = EVTOPTB_Plus_3369 # Refuse

		reverse_opinion = {
			name = opinion_disappointed
			who = FROM
		}
	}
}

# Bureaucrat proposes lowering imperial decadence
character_event = {
	id = Plus.3375
	desc = EVTDESC_Plus_3375
	picture = GFX_evt_imperial_court

	is_triggered_only = yes # yearly_pulse, random_events

	only_independent = yes
	only_capable = yes
	min_age = 16
	prisoner = no
	war = no

	trigger = {
		uses_imperial_decadence_trigger = yes

		primary_title = {
			check_variable = {
				which = imperial_decadence
				value >= 5.0
			}

			trigger_if = {
				limit = { has_title_flag = imperial_court_event }

				had_title_flag = {
					flag = imperial_court_event
					years >= 5
				}
			}
		}

		any_courtier = {
			trait = imperial_bureaucrat
			is_councillor = no
			is_ruler = no
			prisoner = no
			is_incapable = no
		}
	}

	immediate = {
		primary_title = { set_title_flag = imperial_court_event }

		random_courtier = {
			limit = {
				trait = imperial_bureaucrat
				is_councillor = no
				is_ruler = no
				prisoner = no
				is_incapable = no
			}

			save_event_target_as = bureaucrat
		}
	}

	option = {
		name = EVTOPTA_Plus_3375 # Do it

		reverse_opinion = {
			name = opinion_approves
			who = event_target:bureaucrat
			years = 5
			multiplier = 4
		}

		random_list = {
			10 = {
				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 10 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 12 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 14 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 16 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 18 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 20 }
				}

				imperial_decadence_minus_2_effect = yes
			}

			35 = {
				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 10 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 12 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 14 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 16 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 18 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 20 }
				}

				imperial_decadence_minus_1_effect = yes
			}

			25 = {
				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship < 8 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship < 6 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship < 4 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship < 2 }
				}

				imperial_decadence_plus_1_effect = yes
			}

			5 = {
				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship < 8 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship < 6 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship < 4 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship < 2 }
				}

				add_character_modifier = {
					name = bureaucratic_chaos
					years = 1
				}
			}
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 2
				event_target:bureaucrat = { stewardship >= 12 }
			}
		}
	}

	option = {
		name = EVTOPTB_Plus_3375 # Not now

		add_character_modifier = {
			name = bureaucratic_anger
			years = 1
		}

		any_courtier = {
			show_scope_change = no

			limit = {
				trait = imperial_bureaucrat
				prisoner = no
				is_incapable = no
			}

			opinion = {
				name = opinion_disapprove
				who = ROOT
				years = 3
			}
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 2
				event_target:bureaucrat = { stewardship < 8 }
			}
		}
	}
}

# Bureaucrat proposes revisions to tax laws
character_event = {
	id = Plus.3376
	desc = EVTDESC_Plus_3376
	picture = GFX_evt_imperial_court

	is_triggered_only = yes # yearly_pulse, random_events

	only_independent = yes
	only_capable = yes
	min_age = 16
	prisoner = no
	war = no

	trigger = {
		real_tier = EMPEROR
		is_tribal = no
		is_nomadic = no

		primary_title = {
			trigger_if = {
				limit = { has_title_flag = imperial_court_event }

				had_title_flag = {
					flag = imperial_court_event
					years >= 5
				}
			}
		}

		any_courtier = {
			trait = imperial_bureaucrat
			is_councillor = no
			is_ruler = no
			prisoner = no
			is_incapable = no
		}
	}

	immediate = {
		primary_title = { set_title_flag = imperial_court_event }

		random_courtier = {
			limit = {
				trait = imperial_bureaucrat
				is_councillor = no
				is_ruler = no
				prisoner = no
				is_incapable = no
			}

			save_event_target_as = bureaucrat
		}
	}

	option = {
		name = EVTOPTA_Plus_3375 # Do it

		reverse_opinion = {
			name = opinion_approves
			who = event_target:bureaucrat
			years = 5
			multiplier = 4
		}

		random_list = {
			15 = {
				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 10 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 12 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 14 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 16 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 18 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 20 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:bureaucrat = { stewardship < 8 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:bureaucrat = { stewardship < 6 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:bureaucrat = { stewardship < 4 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:bureaucrat = { stewardship < 2 }
				}

				add_character_modifier = {
					name = bureaucratic_reform_2
					years = 3
				}
			}

			30 = {
				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 10 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 12 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 14 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 16 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 18 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:bureaucrat = { stewardship >= 20 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:bureaucrat = { stewardship < 8 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:bureaucrat = { stewardship < 6 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:bureaucrat = { stewardship < 4 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:bureaucrat = { stewardship < 2 }
				}

				add_character_modifier = {
					name = bureaucratic_reform_1
					years = 3
				}
			}

			15 = {
				add_character_modifier = {
					name = bureaucratic_chaos
					years = 1
				}
			}

			5 = {
				imperial_decadence_plus_1_effect = yes
			}
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 2
				event_target:bureaucrat = { stewardship >= 12 }
			}
		}
	}

	option = {
		name = EVTOPTB_Plus_3375 # Not now

		add_character_modifier = {
			name = bureaucratic_anger
			years = 1
		}

		any_courtier = {
			show_scope_change = no

			limit = {
				trait = imperial_bureaucrat
				prisoner = no
				is_incapable = no
			}

			opinion = {
				name = opinion_disapprove
				who = ROOT
				years = 3
			}
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 2
				event_target:bureaucrat = { stewardship < 8 }
			}
		}
	}
}

# Imperial coffers shrink
character_event = {
	id = Plus.3377
	desc = EVTDESC_Plus_3377
	picture = GFX_evt_imperial_court

	is_triggered_only = yes # yearly_pulse, random_events

	only_independent = yes
	only_capable = yes
	min_age = 16
	prisoner = no

	trigger = {
		real_tier = EMPEROR
		wealth >= 100
		is_tribal = no
		is_nomadic = no

		primary_title = {
			trigger_if = {
				limit = { has_title_flag = imperial_court_event }

				had_title_flag = {
					flag = imperial_court_event
					years >= 5
				}
			}
		}

		any_courtier = {
			trait = imperial_bureaucrat
			is_councillor = no
			is_ruler = no
			prisoner = no
			is_incapable = no
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 0.67
			war = yes
		}
	}

	immediate = {
		primary_title = { set_title_flag = imperial_court_event }
	}

	option = {
		name = EVTOPTA_Plus_3377

		scaled_wealth = {
			value = -0.5
			min = -100
		}

		hidden_effect = {
			any_courtier = {
				limit = {
					trait = imperial_bureaucrat
					is_councillor = no
					is_ruler = no
					prisoner = no
					is_incapable = no
				}

				if = {
					limit = { trait = deceitful }
					wealth = 25
				}
				else_if = {
					limit = { trait = honest }
					random = {
						chance = 50
						remove_trait_honest_effect = yes
					}
				}
				else = {
					wealth = 10
					random = {
						chance = 50
						add_trait_deceitful_effect = yes
					}
				}
			}
		}
	}
}

# Too many imperial bureaucrats!
character_event = {
	id = Plus.3378
	desc = EVTDESC_Plus_3378
	picture = GFX_evt_imperial_court

	is_triggered_only = yes # yearly_pulse, random_events

	only_independent = yes
	only_capable = yes
	min_age = 16
	prisoner = no

	trigger = {
		uses_imperial_decadence_trigger = yes
		NOT = { trait = imperial_bureaucrat }

		primary_title = {
			trigger_if = {
				limit = { has_title_flag = imperial_court_event }

				had_title_flag = {
					flag = imperial_court_event
					years >= 5
				}
			}
		}

		any_courtier = {
			count = 3
			trait = imperial_bureaucrat
			is_councillor = no
			is_ruler = no
			prisoner = no
			is_incapable = no
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 0.67
			war = yes
		}
	}

	immediate = {
		primary_title = { set_title_flag = imperial_court_event }
	}

	option = {
		name = CURSES

		imperial_decadence_plus_1_effect = yes
	}
}

# Imperial courtier offers to help emperor with problem vassal
character_event = {
	id = Plus.3379
	desc = EVTDESC_Plus_3379
	picture = GFX_evt_imperial_court

	is_triggered_only = yes # yearly_pulse, random_events

	only_independent = yes
	only_capable = yes
	min_age = 16
	prisoner = no
	war = no

	trigger = {
		real_tier = EMPEROR
		is_tribal = no
		is_nomadic = no

		primary_title = {
			trigger_if = {
				limit = { has_title_flag = imperial_court_event }

				had_title_flag = {
					flag = imperial_court_event
					years >= 5
				}
			}
		}

		any_courtier = {
			trait = imperial_courtier
			is_councillor = no
			is_ruler = no
			prisoner = no
			is_incapable = no
			religion = ROOT

			opinion = {
				who = ROOT
				value >= 0
			}
		}

		any_vassal = {
			is_playable = yes
			religion = ROOT
			ai = yes

			opinion = {
				who = ROOT
				value < -25
			}

			OR = {
				in_faction = faction_court
				in_faction = faction_prosperity
				in_faction = faction_glory
				in_faction = faction_tradition
			}

			NOT = {
				has_opinion_modifier = {
					name = opinion_coerced_into_leaving_faction
					who = ROOT
				}
			}
		}
	}

	immediate = {
		primary_title = { set_title_flag = imperial_court_event }

		random_courtier = {
			limit = {
				trait = imperial_courtier
				religion = ROOT
				is_councillor = no
				is_ruler = no
				prisoner = no
				is_incapable = no

				opinion = {
					who = ROOT
					value >= 0
				}
			}

			save_event_target_as = courtier
		}

		random_vassal = {
			limit = {
				is_playable = yes
				religion = ROOT
				ai = yes

				OR = {
					in_faction = faction_court
					in_faction = faction_prosperity
					in_faction = faction_glory
					in_faction = faction_tradition
				}

				opinion = {
					who = ROOT
					value < -25
				}

				NOT = {
					has_opinion_modifier = {
						name = opinion_coerced_into_leaving_faction
						who = ROOT
					}
				}
			}

			save_event_target_as = problem_vassal
		}
	}

	option = {
		name = EVTOPTA_Plus_3379 # Do what you can

		if = {
			limit = { num_of_friends = 5 }

			opinion = {
				name = opinion_very_grateful
				who = event_target:courtier
				years = 5
			}

			reverse_opinion = {
				name = opinion_very_grateful
				who = event_target:courtier
				years = 5
			}
		}
		else = {
			add_friend = event_target:courtier
		}

		random_list = {
			25 = {
				mult_modifier = {
					factor = 0.9
					event_target:courtier = { intrigue < 8 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:courtier = { intrigue < 6 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:courtier = { intrigue < 4 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:courtier = { intrigue < 2 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:courtier = { intrigue >= 12 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:courtier = { intrigue >= 14 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:courtier = { intrigue >= 16 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:courtier = { intrigue >= 18 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:courtier = { intrigue >= 20 }
				}

				reverse_opinion = {
					name = opinion_coerced_into_leaving_faction
					who = event_target:problem_vassal
					years = 5
				}
			}

			10 = {
				reverse_opinion = {
					name = opinion_outraged
					who = event_target:problem_vassal
					years = 5
				}
			}

			5 = {
				trigger = {
					num_of_rivals < 5
					NOT = { is_rival = event_target:problem_vassal }
				}

				add_rival = event_target:problem_vassal
			}
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 2
				event_target:courtier = { intrigue >= 12 }
			}
		}
	}

	option = {
		name = EVTOPTB_Plus_3379 # I don't need your help

		random_list = {
			50 = {
				reverse_opinion = {
					name = opinion_outraged
					who = event_target:courtier
					years = 5
				}
			}

			25 = {
				trigger = {
					num_of_rivals < 5
					NOT = { is_rival = event_target:courtier }
				}

				add_rival = event_target:courtier
			}

			15 = {
				add_character_modifier = {
					name = courtier_anger
					years = 1
				}
			}
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 2
				event_target:courtier = { intrigue < 8 }
			}
		}
	}
}

# Incident during the imperial court
character_event = {
	id = Plus.3380
	desc = EVTDESC_Plus_3380
	picture = GFX_evt_imperial_court

	is_triggered_only = yes # yearly_pulse, random_events

	only_independent = yes
	only_capable = yes
	min_age = 16
	prisoner = no

	trigger = {
		real_tier = EMPEROR
		is_tribal = no
		is_nomadic = no

		primary_title = {
			trigger_if = {
				limit = { has_title_flag = imperial_court_event }

				had_title_flag = {
					flag = imperial_court_event
					years >= 5
				}
			}
		}

		any_courtier = {
			count = 2
			trait = imperial_courtier
			is_councillor = no
			is_ruler = no
			prisoner = no
			is_incapable = no

			OR = {
				ROOT = { war = no }
				in_command = no
			}
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 0.67
			war = yes
		}
	}

	immediate = {
		primary_title = { set_title_flag = imperial_court_event }

		random_courtier = {
			limit = {
				trait = imperial_courtier
				is_councillor = no
				is_ruler = no
				prisoner = no
				is_incapable = no

				OR = {
					ROOT = { war = no }
					in_command = no
				}
			}

			preferred_limit = {
				any_rival = {
					same_liege = PREV

					OR = {
						trait = imperial_courtier
						trait = imperial_bureaucrat
						trait = imperial_guard
					}

					is_ruler = no
					is_councillor = no
					prisoner = no
					is_incapable = no
					NOT = { character = event_target:first_courtier }

					OR = {
						ROOT = { war = no }
						in_command = no
					}
				}
			}

			save_event_target_as = first_courtier
		}

		random_courtier = {
			limit = {
				OR = {
					trait = imperial_courtier
					trait = imperial_bureaucrat
					trait = imperial_guard
				}

				is_ruler = no
				is_councillor = no
				prisoner = no
				is_incapable = no
				NOT = { character = event_target:first_courtier }

				OR = {
					ROOT = { war = no }
					in_command = no
				}
			}

			# First look for disliked courtier
			preferred_limit = {
				reverse_opinion = {
					who = event_target:first_courtier
					value < -25
				}

				is_rival = event_target:first_courtier
			}

			preferred_limit = {
				is_rival = event_target:first_courtier
			}

			preferred_limit = {
				reverse_opinion = {
					who = event_target:first_courtier
					value < -25
				}

				NOT = { is_friend = event_target:first_courtier }
			}

			save_event_target_as = second_courtier

			if = {
				limit = { is_friend = event_target:first_courtier }
				remove_friend = event_target:second_courtier
			}

			add_rival = event_target:first_courtier
		}
	}

	option = {
		name = EVTOPTA_Plus_3380 # Support first courtier

		if = {
			limit = {
				OR = {
					num_of_friends >= 5
					is_friend = event_target:first_courtier
				}
			}

			opinion = {
				name = opinion_very_grateful
				who = event_target:first_courtier
				years = 5
			}

			reverse_opinion = {
				name = opinion_very_grateful
				who = event_target:first_courtier
				years = 5
			}
		}
		else = {
			add_friend = event_target:first_courtier
		}

		if = {
			limit = {
				OR = {
					num_of_rivals >= 5
					is_rival = event_target:second_courtier
				}
			}

			reverse_opinion = {
				name = opinion_hatred
				who = event_target:second_courtier
				years = 5
			}
		}
		else = {
			add_rival = event_target:second_courtier
		}
	}

	option = {
		name = EVTOPTB_Plus_3380 # Support second courtier

		if = {
			limit = {
				OR = {
					num_of_friends >= 5
					is_friend = event_target:second_courtier
				}
			}

			opinion = {
				name = opinion_very_grateful
				who = event_target:second_courtier
				years = 5
			}

			reverse_opinion = {
				name = opinion_very_grateful
				who = event_target:second_courtier
				years = 5
			}
		}
		else = {
			add_friend = event_target:second_courtier
		}

		if = {
			limit = {
				OR = {
					num_of_rivals >= 5
					is_rival = event_target:first_courtier
				}
			}

			reverse_opinion = {
				name = opinion_hatred
				who = event_target:first_courtier
				years = 5
			}
		}
		else = {
			add_rival = event_target:first_courtier
		}
	}

	option = {
		name = EVTOPTC_Plus_3380 # Take neither side

		trigger = { diplomacy < 15 }

		reverse_opinion = {
			name = opinion_furious
			who = event_target:first_courtier
			years = 5
		}

		reverse_opinion = {
			name = opinion_furious
			who = event_target:second_courtier
			years = 5
		}

		add_character_modifier = {
			name = courtier_anger
			years = 1
		}
	}

	option = {
		name = EVTOPTD_Plus_3380 # Help them work it out
		tooltip_info = diplomacy

		trigger = { diplomacy >= 15 }

		prestige = 50

		event_target:first_courtier = {
			show_scope_change = no

			remove_rival = event_target:second_courtier
		}
	}
}

# Too many imperial courtiers!
character_event = {
	id = Plus.3381
	desc = EVTDESC_Plus_3381
	picture = GFX_evt_imperial_court

	is_triggered_only = yes # yearly_pulse, random_events

	only_independent = yes
	only_capable = yes
	min_age = 16
	prisoner = no

	trigger = {
		uses_imperial_decadence_trigger = yes

		primary_title = {
			trigger_if = {
				limit = { has_title_flag = imperial_court_event }

				had_title_flag = {
					flag = imperial_court_event
					years >= 5
				}
			}
		}

		any_courtier = {
			count = 3
			trait = imperial_courtier
			is_councillor = no
			is_ruler = no
			prisoner = no
			is_incapable = no
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 0.67
			war = yes
		}
	}

	immediate = {
		primary_title = { set_title_flag = imperial_court_event }
	}

	option = {
		name = CURSES

		imperial_decadence_plus_1_effect = yes
	}
}

# Imperial guard proposes revisions to military training
character_event = {
	id = Plus.3382
	desc = EVTDESC_Plus_3382
	picture = GFX_evt_imperial_court

	is_triggered_only = yes # yearly_pulse, random_events

	only_independent = yes
	only_capable = yes
	min_age = 16
	prisoner = no
	war = no

	trigger = {
		real_tier = EMPEROR
		is_tribal = no
		is_nomadic = no

		primary_title = {
			trigger_if = {
				limit = { has_title_flag = imperial_court_event }

				had_title_flag = {
					flag = imperial_court_event
					years >= 5
				}
			}
		}

		any_courtier = {
			trait = imperial_guard
			is_councillor = no
			is_ruler = no
			prisoner = no
			is_incapable = no
		}
	}

	immediate = {
		primary_title = { set_title_flag = imperial_court_event }

		random_courtier = {
			limit = {
				trait = imperial_guard
				is_councillor = no
				is_ruler = no
				prisoner = no
				is_incapable = no
			}

			save_event_target_as = guard
		}
	}

	option = {
		name = EVTOPTA_Plus_3375 # Do it

		reverse_opinion = {
			name = opinion_approves
			who = event_target:guard
			years = 5
			multiplier = 4
		}

		random_list = {
			15 = {
				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 10 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 12 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 14 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 16 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 18 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 20 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:guard = { martial < 8 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:guard = { martial < 6 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:guard = { martial < 4 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:guard = { martial < 2 }
				}

				add_character_modifier = {
					name = military_reform_2
					days = 900
				}
			}

			30 = {
				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 10 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 12 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 14 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 16 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 18 }
				}

				mult_modifier = {
					factor = 1.1
					event_target:guard = { martial >= 20 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:guard = { martial < 8 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:guard = { martial < 6 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:guard = { martial < 4 }
				}

				mult_modifier = {
					factor = 0.9
					event_target:guard = { martial < 2 }
				}

				add_character_modifier = {
					name = military_reform_1
					days = 900
				}
			}

			15 = {
				add_character_modifier = {
					name = military_chaos
					years = 1
				}
			}

			5 = {
				imperial_decadence_plus_1_effect = yes
			}
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 2
				event_target:guard = { martial >= 12 }
			}
		}
	}

	option = {
		name = EVTOPTB_Plus_3375 # Not now

		add_character_modifier = {
			name = bureaucratic_anger
			years = 1
		}

		any_courtier = {
			show_scope_change = no

			limit = {
				trait = imperial_guard
				prisoner = no
				is_incapable = no
			}

			opinion = {
				name = opinion_disapprove
				who = ROOT
				years = 3
			}
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 2
				event_target:guard = { martial < 8 }
			}
		}
	}
}

# The imperial bodyguards
character_event = {
	id = Plus.3383
	desc = EVTDESC_Plus_3383
	picture = GFX_evt_imperial_court

	is_triggered_only = yes # yearly_pulse, random_events

	only_independent = yes
	only_capable = yes
	min_age = 16
	prisoner = no
	war = no

	trigger = {
		real_tier = EMPEROR
		is_tribal = no
		is_nomadic = no

		primary_title = {
			trigger_if = {
				limit = { has_title_flag = imperial_court_event }

				had_title_flag = {
					flag = imperial_court_event
					years >= 5
				}
			}
		}

		any_courtier = {
			trait = imperial_guard
			practical_age < 50
			is_councillor = no
			is_ruler = no
			prisoner = no
			is_incapable = no

			opinion = {
				who = ROOT
				value >= 25
			}
		}
	}

	immediate = {
		primary_title = { set_title_flag = imperial_court_event }

		random_courtier = {
			limit = {
				trait = imperial_guard
				practical_age < 50
				is_councillor = no
				is_ruler = no
				prisoner = no
				is_incapable = no

				opinion = {
					who = ROOT
					value >= 25
				}
			}

			save_event_target_as = guard
		}
	}

	option = {
		name = EVTOPTA_Plus_3383

		reverse_opinion = {
			name = opinion_loyal_servant
			who = event_target:guard
			years = 5
		}

		add_character_modifier = {
			name = imperial_bodyguards
			years = 5
		}
	}
}

# Capable commander becomes popular
character_event = {
	id = Plus.3384

	is_triggered_only = yes # on_major_battle_won
	hide_window = yes

	only_capable = yes

	trigger = {
		martial >= 12
		practical_age < 60
		is_ruler = no
		is_maimed_trigger = no

		NOR = {
			trait = imbecile
			trait = infirm
			trait = inbred
			trait = weak
			trait = dwarf
			trait = imperial_courtier
			trait = imperial_bureaucrat
		}

		liege = {
			real_tier = EMPEROR
			has_imperial_government_trigger = yes
			is_tribal = no
			is_nomadic = no

			primary_title = {
				NOT = { claimed_by = ROOT }
			}
		}
	}

	immediate = {
		if = {
			limit = { trait = imperial_guard }

			random = {
				chance = 25

				mult_modifier = {
					factor = 1.5
					is_strong_trigger = yes
				}

				mult_modifier = {
					factor = 1.5
					trait = tall
				}

				mult_modifier = {
					factor = 1.5
					trait = imposing
				}

				mult_modifier = {
					factor = 1.5
					trait = ambitious
				}

				mult_modifier = {
					factor = 0.5
					trait = content
				}

				mult_modifier = {
					factor = 0.5
					trait = humble
				}

				mult_modifier = {
					factor = 0.5
					diplomacy < 4
				}

				mult_modifier = {
					factor = 0.5
					diplomacy < 8
				}

				mult_modifier = {
					factor = 0.5
					martial < 12
				}

				mult_modifier = {
					factor = 0.5
					martial < 10
				}

				mult_modifier = {
					factor = 1.2
					martial >= 14
				}

				mult_modifier = {
					factor = 1.2
					martial >= 16
				}

				mult_modifier = {
					factor = 1.2
					martial >= 18
				}

				mult_modifier = {
					factor = 1.2
					martial >= 20
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 12
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 14
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 16
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 18
				}

				prestige = 500

				add_claim = liege

				liege = {
					opinion = {
						name = opinion_war_hero
						who = ROOT
						years = 10
					}

					any_realm_character = {
						opinion = {
							name = opinion_war_hero
							who = ROOT
							years = 10
						}
					}

					character_event = {
						id = Plus.3385
						days = 1
					}
				}
			}
		}
		else = {
			add_trait = imperial_guard
		}
	}
}

character_event = {
	id = Plus.3385
	title = EVTNAME_Plus_3385
	desc = EVTDESC_Plus_3385
	picture = GFX_evt_battle
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
	major = yes

	major_trigger = {
		OR = {
			character = FROM
			character = ROOT
			same_realm = ROOT
		}
	}

	option = {
		name = EVTOPTA_Plus_3385

		trigger = { character = ROOT }

		tooltip = {
			primary_title = {
				show_scope_change = no

				add_claim = FROM
			}
		}
	}

	option = {
		name = EVTOPTB_Plus_3385

		trigger = { NOT = { character = ROOT } }
	}
}

# Capable imperial guard is better than the emperor
character_event = {
	id = Plus.3386
	desc = EVTDESC_Plus_3386
	picture = GFX_evt_imperial_court

	is_triggered_only = yes # yearly_pulse, random_events

	only_independent = yes
	only_capable = yes
	min_age = 16
	prisoner = no
	war = no

	trigger = {
		real_tier = EMPEROR
		has_imperial_government_trigger = yes
		is_tribal = no
		is_nomadic = no

		primary_title = {
			trigger_if = {
				limit = { has_title_flag = imperial_court_event }

				had_title_flag = {
					flag = imperial_court_event
					years >= 5
				}
			}
		}

		any_courtier = {
			trait = imperial_guard
			martial >= 12
			prisoner = no
			is_ill = no
			is_incapable = no
			is_dumb_trigger = no
			is_maimed_trigger = no

			attribute_diff = {
				character = ROOT
				attribute = martial
				value >= 3
			}

			opinion = {
				who = ROOT
				value < 0
			}

			NOR = {
				trait = content
				trait = humble
				trait = stressed
				trait = depressed

				any_claim = {
					is_primary_holder_title = yes
					holder = ROOT
				}
			}
		}
	}

	immediate = {
		primary_title = { set_title_flag = imperial_court_event }

		any_courtier = {
			limit = {
				trait = imperial_guard
				martial >= 12
				prisoner = no
				is_ill = no
				is_incapable = no
				is_dumb_trigger = no
				is_maimed_trigger = no

				attribute_diff = {
					character = ROOT
					attribute = martial
					value >= 3
				}

				opinion = {
					who = ROOT
					value < 0
				}

				NOR = {
					trait = content
					trait = humble
					trait = stressed
					trait = depressed

					any_claim = {
						is_primary_holder_title = yes
						holder = ROOT
					}
				}
			}

			# Select Imperial Guard with highest martial attribute
			score_value = {
				value = 1
				martial_score = yes
			}

			save_event_target_as = guard
		}
	}

	option = {
		name = EVTOPTA_Plus_3386

		event_target:guard = {
			show_scope_change = no

			add_claim = ROOT
			add_trait_fully_silently_ambitious_effect = yes
		}
	}
}