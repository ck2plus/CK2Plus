namespace = Plus

#reserved: Plus.2000 to Plus.2099

#######################################
# CHRISTIAN HERESY EVENTS
# Adapted from Heretic Pride by Rylock
#######################################

### CATHAR EVENTS

# Cathar child gains chaste
character_event = {
	id = Plus.2000
	desc = EVTDESC_Plus_2000
	picture = GFX_evt_child_talking
	
	is_triggered_only = yes
	
	min_age = 6
	max_age = 16

	trigger = {
		religion = cathar
		has_guardian = yes
		NOT = { personality_traits = 5 }
		NOT = { trait = lustful }
		NOT = { trait = chaste }
	}
	
	weight_multiplier = {
		days = 1
	}
	
	option = {
		name = EVTOPTA_Plus_2000
		add_trait = chaste
	}
}

# Cathar male child becomes homosexual
character_event = {
	id = Plus.2001
	desc = EVTDESC_Plus_2001
	picture = GFX_evt_brothel
	
	min_age = 13
	max_age = 18
	only_men = yes
	
	trigger = {
		religion = cathar
		is_married = no
		NOT = {
			trait = homosexual
			trait = celibate
		}
	}

	mean_time_to_happen = {
		months = 960
		modifier = {
			factor = 1.25
			trait = chaste
		}
		modifier = {
			factor = 0.75
			martial = 10
			trait = fair
		}
		modifier = {
			factor = 0.75
			trait = shy
			learning = 10
		}
		modifier = {
			factor = 0.75
			trait = trusting
			any_courtier = {
				age = 13
				NOT = { age = 18 }
				trait = homosexual
				reverse_opinion = { who = ROOT value = 25 }
			}
		}
	}
	
	option = {
		name = EVTOPTA_Plus_2001
		add_trait = homosexual
	}
}

# Child female child becomes homosexual
character_event = {
	id = Plus.2002
	desc = EVTDESC_Plus_2002
	picture = GFX_evt_garden
	
	min_age = 12
	max_age = 17
	only_women = yes
	
	trigger = {
		religion = cathar
		is_married = no
		NOT = {
			trait = homosexual
			trait = celibate
		}		
	}

	mean_time_to_happen = {
		months = 960
		modifier = {
			factor = 0.5
			trait = zealous
		}
		modifier = {
			factor = 0.5
			trait = chaste
		}
	}
	
	option = {
		name = EVTOPTA_Plus_2001
		add_trait = homosexual
	}
}

# Adult Cathar becomes celibate
character_event = {
	id = Plus.2003
	desc = EVTDESC_Plus_2003
	picture = GFX_evt_brothel
	
	min_age = 25
	
	is_triggered_only = yes
	
	trigger = {
		religion = cathar
		trait = zealous
		NOT = {
			trait = celibate
			trait = hedonist
		}
	}
	
	weight_multiplier = {
		days = 1
		modifier = {
			factor = 2
			trait = chaste
		}
		modifier = {
			factor = 0.5
			trait = lustful
		}
	}
	
	option = {
		name = EVTOPTA_Plus_2003
		add_trait = celibate
	}
}

#[on_birth] Cathar child malus
character_event = {
	id = Plus.2004
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		OR = {
			father = { religion = cathar }
			mother = { religion = cathar }
		}
	}
	
	immediate = {
		if = {
			limit = {
				father = { religion = cathar }
			}
			father = {
				character_event = {
					id = Plus.2005
					days = 2
				}
			}
		}
		if = {
			limit = {
				mother = { religion = cathar }
			}
			mother = {
				character_event = {
					id = Plus.2005
					days = 2
				}
			}
		}
	}
}

# Cathars lose piety and prestige for having children
character_event = {
	id = Plus.2005
	desc = EVTDESC_Plus_2005
	picture = GFX_evt_lovers
	
	is_triggered_only = yes
	
	trigger = {
		religion = cathar
	}
	
	option = {
		name = EVTOPTA_Plus_2005
		piety = -50
		prestige = -50
	}
}

# Cathar ruler adopts a child (fired from decision)
character_event = {
	id = Plus.2006
	desc = EVTDESC_Plus_2006
	picture = GFX_evt_child_talking
	
	is_triggered_only = yes
	
	immediate = {
		random_realm_province = {
			limit = { religion = cathar }
			save_event_target_as = adopted_province
		}
	}

	option = {
		name = EVTOPTA_Plus_2006
		piety = 20
		create_character = {
			dynasty = ROOT
			religion = cathar
			culture = ROOT
			female = no
			age = 5
			health = 6.5
			fertility = 0.4
			attributes = {
				learning = 2
				diplomacy = 2
				martial = 2
				stewardship = 2
				intrigue = 2
			}
		}
		new_character = {
			if = {
				limit = { ROOT = { is_female = no } }
				set_father = ROOT
			}
			if = {
				limit = { ROOT = { is_female = yes } }
				set_mother = ROOT
			}
			random_list = {
				1 = { add_trait = genius }
				3 = { add_trait = quick }
				3 = { add_trait = strong }
				3 = { add_trait = tall }
				4 = { change_diplomacy = 2 }
				4 = { change_learning = 2 }
				4 = { change_martial = 2 }
				4 = { change_stewardship = 2 }
				4 = { change_intrigue = 2 }
				10 = { }
			}
			add_trait = adopted
			add_trait = shy
		}
		recalc_succession = yes
	}
}

# Council of Saint-Félix
narrative_event = {
	id = Plus.2010
	title = EVTTITLE_Plus_2010
	desc = EVTDESC_Plus_2010
	picture = GFX_evt_mary_magdalene

	major = yes
	only_rulers = yes
	
	trigger = {
		war = no
		year = 1165
		has_landed_title = c_carcassonne
		religion = catholic
		213 = { religion = catholic }
		NOT = {
			any_independent_ruler = { religion = cathar }
			has_global_flag = rise_cathar
		}
	}
	
	major_trigger = {
		OR = {
			has_landed_title = c_carcassonne
			has_landed_title = c_toulouse
			has_landed_title = c_foix
			has_landed_title = c_narbonne
			religion = cathar
			religion = bogomilist
			capital_scope = {
				NOT = {
					distance = {
						where = 213 # Carcassone
						value = 600	# Same part of the world
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		months = 24
		modifier = {
			factor = 0.5
			year = 1167
		}
	}
	
	immediate = {
		set_global_flag = rise_cathar
		213 = { #Carcassone
			religion = cathar
			add_province_modifier = {
				name = heretic_stronghold
				duration = 3650
			}
		}
		214 = { #Toulouse
			if = {
				limit = { religion = catholic }
				religion = cathar
				add_province_modifier = {
					name = heretic_stronghold
					duration = 3650
				}
			}
		}
		210 = { #Foix
			if = {
				limit = { religion = catholic }
				religion = cathar
				add_province_modifier = {
					name = heretic_stronghold
					duration = 3650
				}
			}
		}
		212 = { #Narbonne
			if = {
				limit = { religion = catholic }
				religion = cathar
				add_province_modifier = {
					name = heretic_stronghold
					duration = 3650
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_Plus_2010
		trigger = {
			religion = catholic
			OR = {
				has_landed_title = c_carcassonne
				has_landed_title = c_toulouse
				has_landed_title = c_foix
				has_landed_title = c_narbonne
			}
		}
		piety = -100
		hidden_tooltip = {
			create_character = {
				random_traits = yes
				dynasty = random
				religion = cathar
				culture = ROOT
				female = no
				age = 35
				trait = mastermind_theologian
				trait = perfecti
				trait = zealous
				trait = gregarious
				trait = scholar
				attributes = {
					learning = 5
					diplomacy = 5
				}
			}
		}
	}
	option = {
		name = EVTOPTB_Plus_2010
		trigger = {
			religion = catholic
			NOT = {
				has_landed_title = c_carcassonne
				has_landed_title = c_toulouse
				has_landed_title = c_foix
				has_landed_title = c_narbonne
			}
		}
	}
	option = {
		name = I_SEE
		trigger = {
			NOT = {
				religion = catholic
				religion = bogomilist
			}
		}
	}
	option = {
		name = EVTOPTC_Plus_2010
		trigger = {
			religion = bogomilist
		}
#		hidden_tooltip = {
#			character_event = { id = HPbogomilist.10210 days = 2 }
#		}
	}
}

# Cathars are allowed to use holy wars once Catholic holy war is used against them
character_event = {
	id = Plus.2011
	title = EVTTITLE_Plus_2011
	desc = EVTDESC_Plus_2011
	picture = GFX_evt_heresy_defeated
	border = GFX_event_normal_frame_war
	
	major = yes
	only_rulers = yes
	
	trigger = {
		religion = cathar
		is_heretic = yes
		war = yes
		is_primary_war_defender = yes
		any_war = {
			attacker = { is_parent_religion = ROOT }
			defender = { character = ROOT }
			OR = {
				using_cb = crusade
				using_cb = holy_war
			}
		}
		NOT = { has_global_flag = cathar_war }
	}
	
	major_trigger = {
		religion = cathar
	}
	
	mean_time_to_happen = {
		days = 10
    }

	immediate = {
		set_global_flag = cathar_war
	}
	
	option = {
		name = EVTOPTA_Plus_2011
	}
}

# A Cathar Pope is elected (fired from decision)
character_event = {
	id = Plus.2012
	
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		activate_title = { title = d_cathar status = yes }
		if = {
			limit = {
				any_realm_lord = {
					religion = cathar
					capital_holding = { holding_type = temple }
					prisoner = no
					trait = perfecti
					NOT = { trait = incapable }
				}
			}
			random_realm_lord = {
				limit = {
					religion = cathar
					capital_holding = { holding_type = temple }
					prisoner = no
					trait = perfecti
					NOT = { trait = incapable }
				}
				d_cathar = { grant_title = PREV }
				set_defacto_liege = ROOT
				save_event_target_as = new_cathar_pope
			}
		}
		if = {
			limit = {
				NOT = {
					any_realm_lord = {
						religion = cathar
						capital_holding = { holding_type = temple }
						prisoner = no
						trait = perfecti
						NOT = { trait = incapable }
					}
				}
			}
			create_random_priest = {
				random_traits = yes
				dynasty = random
				religion = cathar
				culture = ROOT
				age = 40
				health = 7
				trait = quick
				trait = zealous
				trait = perfecti
				trait = scholar
				trait = mastermind_theologian
				attributes = {
					learning = 5
					diplomacy = 5
					martial = 2
					stewardship = 5
					intrigue = 5
				}
			}
			new_character = {
				d_cathar = { grant_title = PREV }
				set_defacto_liege = ROOT
				save_event_target_as = new_cathar_pope
				ROOT = {
					random_realm_title = {
						limit = { is_holy_site = ROOT }
						gain_title = PREVPREV
					}
				}
			}
		}
		narrative_event = { id = Plus.2013 }
	}
}

# The rest of the world is told about the new Cathar Pope
narrative_event = {
	id = Plus.2013
	title = EVTTITLE_Plus_2013
	desc = EVTDESC_Plus_2013
	picture = GFX_evt_pope
	border = GFX_event_narrative_frame_religion
	sound = church_bells

	major = yes

	is_triggered_only = yes

	option = {
		name = EVTOPTA_Plus_2013
		trigger = {
			NOT = { religion = cathar }
			religion_group = christian
		}
	}
	option = {
		name = EVTOPTB_Plus_2013
		trigger = { NOT = { religion_group = christian } }
	}
	option = {
		name = EVTOPTC_Plus_2013
		trigger = { religion = cathar }
	}
}

