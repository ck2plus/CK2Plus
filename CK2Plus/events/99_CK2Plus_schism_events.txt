namespace = schismPlus

# Pick a setup based on selected game rule and world state
character_event = {
	id = schismPlus.001 # setup

	hide_window = yes
	is_triggered_only = yes # on_startup

	only_playable = yes

	trigger = {
		owns = event_target:pulse_province
		is_save_game = no
	}

	immediate = {
		log = "BEGINNING GREAT SCHISM SETUP"

		if = {
			limit = {
				has_game_rule = {
					name = great_schism
					value = historical
				}
			}

			log = "Great Schism: Historical"

			if = {
				limit = { has_global_flag = great_schism_happened }

				# set_to_post_schism = yes # Failsafe. Usually no changes unless something was missed in histories
				break = yes
			}
			else = {
				set_to_pre_schism = yes # Fixes titles and makes sure no characters were missed
				start_schism_tracker = yes
			}
		}
		else_if = {
			limit = {
				has_game_rule = {
					name = great_schism
					value = joined
				}
			}

			log = "Great Schism: Joined"

			set_to_pre_schism = yes
			start_schism_tracker = yes
		}
		else_if = {
			limit = {
				has_game_rule = {
					name = great_schism
					value = split
				}
			}
			log = "Great Schism: Split"

			if = {
				limit = { has_global_flag = great_schism_happened }

				break = yes
			}
			else = {
				set_to_post_schism = yes
			}
		}
		else_if = {
			limit = {
				has_game_rule = {
					name = great_schism
					value = disabled
				}
			}

			log = "Great Schism: Disabled"

			set_to_pre_schism = yes
			set_global_flag = great_schism_disabled
		}
		else = {
			log = "Great Schism: An error has occurred. Falling back to Default (Historical)"

			if = {
				limit = { has_global_flag = great_schism_happened }

				set_to_post_schism = yes # Failsafe. Usually no changes unless something was missed in histories
			}
			else = {
				set_to_pre_schism = yes # Fixes titles and makes sure no characters were missed
				start_schism_tracker = yes
			}
		}
	}
}
